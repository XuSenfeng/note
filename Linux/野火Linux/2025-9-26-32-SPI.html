<!DOCTYPE html>

<html lang="zh-CN"  class="">


<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="keywords" content="">
    
    
    <meta name="description" content="">
    
    <meta name="generator" content="teedoc">
    <meta name="theme" content="teedoc-plugin-theme-default">
    
        
        <meta name="markdown-generator" content="teedoc-plugin-markdown-parser">
        
        <script>
MathJax = {"loader": {"load": ["output/svg"]}, "tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]]}, "svg": {"fontCache": "global"}};
</script>
        
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        
        <meta name="html-generator" content="teedoc-plugin-jupyter-notebook-parser">
        
        <script src="/note/static/js/theme_default/pre_main.js"></script>
        
        <link rel="stylesheet" href="/note/static/css/theme_default/prism.min.css" type="text/css"/>
        
        <link rel="stylesheet" href="/note/static/css/theme_default/viewer.min.css" type="text/css"/>
        
        <link rel="stylesheet" href="/note/static/css/theme_default/dark.css" type="text/css"/>
        
        <link rel="stylesheet" href="/note/static/css/theme_default/light.css" type="text/css"/>
        
        <script src="/note/static/js/theme_default/jquery.min.js"></script>
        
        <script src="/note/static/js/theme_default/split.js"></script>
        
        <link rel="stylesheet" href="/note/static/css/search/style.css" type="text/css"/>
        
        <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?4d52982572d5512e9762879ebf063c86";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
        
        <meta name="blog-generator" content="teedoc-plugin-blog">
        
        <link rel="stylesheet" href="/note/static/css/gitalk/gitalk.css" type="text/css"/>
        
        <link rel="stylesheet" href="/note/static/css/gitalk/custom_gitalk.css" type="text/css"/>
        
        <link rel="stylesheet" href="/note/static/css/custom.css" type="text/css"/>
        
    
    
    <title>XvSenfeng's Note</title>
    
    <script type="text/javascript">js_vars = {"teedoc-plugin-ad-hint": {"type": "hint", "label": "☆", "content": "这是一个支持国际化的消息示例</br>喜欢项目请<a target=\"_blank\" href=\"https://github.com/teedoc/teedoc\">点下 ☆ star </a>哦~🦀🦀", "show_times": 2, "show_after_s": 432000, "date": "2021-11-16 14:40", "color": "#a0421d", "link_color": "#e53935", "link_bg_color": "#e6ae5c", "bg_color": "#ffcf89", "color_hover": "white", "bg_color_hover": "#f57c00", "close_color": "#eab971"}}</script>
    <script type="text/javascript">metadata = {"tags": [], "date": null, "update": [], "ts": 0, "author": "", "brief": "", "cover": ""}</script>
</head>


<body class="type_doc">
    
    <div id="navbar">
        <div id="navbar_menu">
            <a class="site_title" href="/note/">
                
                    <img class="site_logo" src="/note/static/image/logo.png" alt="XvSenfeng logo">
                
                
                    <h2>XvSenfeng</h2>
                
        </a>
            <a id="navbar_menu_btn"></a>
        </div>
        <div id="navbar_items">
            <div>
                <ul id="nav_left">
<li class=""><a  href="/note/blog/">博客</a></li>
<li class="active"><a  href="/note/Linux/">Linux</a></li>
<li class=""><a  href="/note/代码分析/">代码分析</a></li>
<li class=""><a  href="/note/使用软件/">使用软件</a></li>
<li class=""><a  href="/note/嵌入式/">嵌入式</a></li>
<li class=""><a  href="/note/手机安卓/">手机安卓</a></li>
<li class=""><a  href="/note/机器学习/">机器学习</a></li>
<li class=""><a  href="/note/编程基础/">编程基础</a></li>
<li class=""><a  href="/note/网络/">网络</a></li>
</ul>

            </div>
            <div>
                <ul id="nav_right">
<li class=""><a target="_blank" href="https://github.com/XuSenfeng/note/">github</a></li>
</ul>

                <ul class="nav_plugins"><li><a id="google_translate_element"><img class="icon" src="/note/static/image/google_translate/translate.svg"/>Translate</a></li></ul><ul class="nav_plugins"><li><a id="themes" class="light"></a></li></ul><ul class="nav_plugins"><li><a id="search"><span class="icon"></span><span class="placeholder">搜索</span>
                            <div id="search_hints">
                                <span id="search_input_hint">输入关键词，多关键词空格隔开</span>
                                <span id="search_loading_hint">正在加载，请稍候。。。</span>
                                <span id="search_download_err_hint">下载文件失败，请刷新重试或检查网络</span>
                                <span id="search_other_docs_result_hint">来自其它文档的结果</span>
                                <span id="search_curr_doc_result_hint">当前文档搜索结果</span>
                            </div></a></li></ul>
            </div>
        </div>
    </div>
    
    <div id="wrapper">
        <div id="sidebar_wrapper">
            <div id="sidebar">
                <div id="sidebar_title">
                    
                </div>
                <ul class="show">
<li class="not_active with_link"><a href="/note/Linux/index.html"><span class="label">README</span><span class=""></span></a></li>
<li class="not_active no_link"><a><span class="label">Linux命令行与shell脚本编程大全</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-1-初认识Linux_shell.html"><span class="label">2022-8-1-初认识Linux_shell</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-1-基本bashshell命令.html"><span class="label">2022-8-1-基本bashshell命令</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-1-走进shell.html"><span class="label">2022-8-1-走进shell</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-10-sed进阶.html"><span class="label">2022-8-10-sed进阶</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-11-gawk进阶.html"><span class="label">2022-8-11-gawk进阶</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-11-使用其他shell.html"><span class="label">2022-8-11-使用其他shell</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-11-实例.html"><span class="label">2022-8-11-实例</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-12-邮件相关.html"><span class="label">2022-8-12-邮件相关</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-2-更多命令.html"><span class="label">2022-8-2-更多命令</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-2-理解shell.html"><span class="label">2022-8-2-理解shell</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-3-使用Linux环境变量.html"><span class="label">2022-8-3-使用Linux环境变量</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-3-理解Linux的文件权限.html"><span class="label">2022-8-3-理解Linux的文件权限</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-4-安装软件程序.html"><span class="label">2022-8-4-安装软件程序</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-4-管理文件系统.html"><span class="label">2022-8-4-管理文件系统</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-5-使用编辑器.html"><span class="label">2022-8-5-使用编辑器</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-5-构建基本脚本.html"><span class="label">2022-8-5-构建基本脚本</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-6-使用结构初始化.html"><span class="label">2022-8-6-使用结构初始化</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-6-处理用户输入.html"><span class="label">2022-8-6-处理用户输入</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-6-更多结构化命令.html"><span class="label">2022-8-6-更多结构化命令</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-7-呈现数据.html"><span class="label">2022-8-7-呈现数据</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-7-控制脚本.html"><span class="label">2022-8-7-控制脚本</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-8-创建函数.html"><span class="label">2022-8-8-创建函数</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-9-图形化桌面环境中的脚本编程.html"><span class="label">2022-8-9-图形化桌面环境中的脚本编程</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-9-正则表达式.html"><span class="label">2022-8-9-正则表达式</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux命令行与shell脚本编程大全/2022-8-9-认识sed和gawk.html"><span class="label">2022-8-9-认识sed和gawk</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">Linux就该这么学</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/note/Linux/Linux就该这么学/2022-8-23-.html"><span class="label">2022-8-23-</span><span class=""></span></a></li>
<li class="not_active no_link"><a><span class="label">鸟哥的linux私房菜</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/note/Linux/Linux就该这么学/鸟哥的linux私房菜/2022-9-10-计算机概论.html"><span class="label">2022-9-10-计算机概论</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux就该这么学/鸟哥的linux私房菜/2022-9-20-主机规划与磁盘分区.html"><span class="label">2022-9-20-主机规划与磁盘分区</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux就该这么学/鸟哥的linux私房菜/2022-9-20-安装CentOS.html"><span class="label">2022-9-20-安装CentOS</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux就该这么学/鸟哥的linux私房菜/2022-9-20-首次登录.html"><span class="label">2022-9-20-首次登录</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux就该这么学/鸟哥的linux私房菜/2022-9-25-文件权限以及目录.html"><span class="label">2022-9-25-文件权限以及目录</span><span class=""></span></a></li>
</ul>
</li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">Linux源码趣读</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/note/Linux/Linux源码趣读/2024-1-26-01最开始的代码.html"><span class="label">2024-1-26-01最开始的代码</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">Linux系统编程</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/note/Linux/Linux系统编程/2024-2-14-01文件IO.html"><span class="label">2024-2-14-01文件IO</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux系统编程/2024-3-19-02文件系统.html"><span class="label">2024-3-19-02文件系统</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux系统编程/2024-3-21-03程序和进程.html"><span class="label">2024-3-21-03程序和进程</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux系统编程/2024-3-23-04进程间通信.html"><span class="label">2024-3-23-04进程间通信</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux系统编程/2024-3-25-05信号.html"><span class="label">2024-3-25-05信号</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux系统编程/2024-3-28-06守护进程、线程.html"><span class="label">2024-3-28-06守护进程、线程</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux系统编程/2024-3-31-07线程同步.html"><span class="label">2024-3-31-07线程同步</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">Linux网络编程</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/note/Linux/Linux网络编程/2024-4-10-04线程池.html"><span class="label">2024-4-10-04线程池</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux网络编程/2024-4-13-05本地套接字.html"><span class="label">2024-4-13-05本地套接字</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux网络编程/2024-4-14-06libevent库.html"><span class="label">2024-4-14-06libevent库</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux网络编程/2024-4-16-07简单的Web服务器.html"><span class="label">2024-4-16-07简单的Web服务器</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux网络编程/2024-4-16-08html入门.html"><span class="label">2024-4-16-08html入门</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux网络编程/2024-4-17-09CSS.html"><span class="label">2024-4-17-09CSS</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux网络编程/2024-4-17-09HTTP协议.html"><span class="label">2024-4-17-09HTTP协议</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux网络编程/2024-4-2-01网络基础.html"><span class="label">2024-4-2-01网络基础</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux网络编程/2024-4-20-10telnet调试.html"><span class="label">2024-4-20-10telnet调试</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux网络编程/2024-4-20-11服务器.html"><span class="label">2024-4-20-11服务器</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux网络编程/2024-4-3-02Socket编程.html"><span class="label">2024-4-3-02Socket编程</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/Linux网络编程/2024-4-6-03高并发服务器.html"><span class="label">2024-4-6-03高并发服务器</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">原子Linux</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-10-Linux常用命令.html"><span class="label">2022-8-10-Linux常用命令</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-11-压缩解压缩.html"><span class="label">2022-8-11-压缩解压缩</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-11-文件系统结构.html"><span class="label">2022-8-11-文件系统结构</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-11-磁盘管理.html"><span class="label">2022-8-11-磁盘管理</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-12-LinuxC.html"><span class="label">2022-8-12-LinuxC</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-12-Makefile书.html"><span class="label">2022-8-12-Makefile书</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-12-make和Makefile.html"><span class="label">2022-8-12-make和Makefile</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-12-开发环境搭建.html"><span class="label">2022-8-12-开发环境搭建</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-12-用户和用户组.html"><span class="label">2022-8-12-用户和用户组</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-12-链接文件.html"><span class="label">2022-8-12-链接文件</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-13-IMX启动方式.html"><span class="label">2022-8-13-IMX启动方式</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-13-vscode.html"><span class="label">2022-8-13-vscode</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-13-开发板简介.html"><span class="label">2022-8-13-开发板简介</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-13-汇编LED驱动.html"><span class="label">2022-8-13-汇编LED驱动</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-14-C语言点灯.html"><span class="label">2022-8-14-C语言点灯</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-14-按键检测.html"><span class="label">2022-8-14-按键检测</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-14-模仿stm32编程.html"><span class="label">2022-8-14-模仿stm32编程</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-15-中断.html"><span class="label">2022-8-15-中断</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-15-主频时钟配置.html"><span class="label">2022-8-15-主频时钟配置</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-16-EPIT定时器.html"><span class="label">2022-8-16-EPIT定时器</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-16-GPT时钟.html"><span class="label">2022-8-16-GPT时钟</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-17-DDR3.html"><span class="label">2022-8-17-DDR3</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-17-RGBLED.html"><span class="label">2022-8-17-RGBLED</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-17-串口.html"><span class="label">2022-8-17-串口</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-18-I2C.html"><span class="label">2022-8-18-I2C</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-18-RTC.html"><span class="label">2022-8-18-RTC</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-19-PWM.html"><span class="label">2022-8-19-PWM</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-19-SPI.html"><span class="label">2022-8-19-SPI</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-19-多点电容触摸屏.html"><span class="label">2022-8-19-多点电容触摸屏</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-20-uBoot.html"><span class="label">2022-8-20-uBoot</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-20-系统烧写.html"><span class="label">2022-8-20-系统烧写</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-22-源码目录分析.html"><span class="label">2022-8-22-源码目录分析</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-22-顶层Makefile.html"><span class="label">2022-8-22-顶层Makefile</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-23-Linux内核.html"><span class="label">2022-8-23-Linux内核</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-23-uboot图形化配置界面.html"><span class="label">2022-8-23-uboot图形化配置界面</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-23-启动流程.html"><span class="label">2022-8-23-启动流程</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-23-移植.html"><span class="label">2022-8-23-移植</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-24-驱动开发.html"><span class="label">2022-8-24-驱动开发</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-26-linux点灯.html"><span class="label">2022-8-26-linux点灯</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-27-设备树.html"><span class="label">2022-8-27-设备树</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-28-led设备树.html"><span class="label">2022-8-28-led设备树</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-29-Linux的并发与竞争.html"><span class="label">2022-8-29-Linux的并发与竞争</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-29-pinclt和gpio.html"><span class="label">2022-8-29-pinclt和gpio</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-30-Linux中断.html"><span class="label">2022-8-30-Linux中断</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-30-Linux内核定时器.html"><span class="label">2022-8-30-Linux内核定时器</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-31-异步通知.html"><span class="label">2022-8-31-异步通知</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-8-31-阻塞非阻塞.html"><span class="label">2022-8-31-阻塞非阻塞</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-9-1-platform设备驱动.html"><span class="label">2022-9-1-platform设备驱动</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-9-10-WIFI.html"><span class="label">2022-9-10-WIFI</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-9-10-网络驱动.html"><span class="label">2022-9-10-网络驱动</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-9-11-4G.html"><span class="label">2022-9-11-4G</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-9-11-IIO.html"><span class="label">2022-9-11-IIO</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-9-11-PWM.html"><span class="label">2022-9-11-PWM</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-9-11-RGBtoHDMI.html"><span class="label">2022-9-11-RGBtoHDMI</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-9-11-Regmap.html"><span class="label">2022-9-11-Regmap</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-9-2-INPUT子系统.html"><span class="label">2022-9-2-INPUT子系统</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-9-2-LCD屏幕.html"><span class="label">2022-9-2-LCD屏幕</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-9-2-Linux自带的led.html"><span class="label">2022-9-2-Linux自带的led</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-9-2-MISC.html"><span class="label">2022-9-2-MISC</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-9-3-I2C.html"><span class="label">2022-9-3-I2C</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-9-3-RTC.html"><span class="label">2022-9-3-RTC</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-9-3-SPI.html"><span class="label">2022-9-3-SPI</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-9-4-串口.html"><span class="label">2022-9-4-串口</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-9-5-触摸屏.html"><span class="label">2022-9-5-触摸屏</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-9-5-音频驱动.html"><span class="label">2022-9-5-音频驱动</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-9-6-CAN协议.html"><span class="label">2022-9-6-CAN协议</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-9-7-USB.html"><span class="label">2022-9-7-USB</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/原子Linux/2022-9-7-块设备驱动.html"><span class="label">2022-9-7-块设备驱动</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">操作系统原理</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/note/Linux/操作系统原理/2023-6-17-1操作系统.html"><span class="label">2023-6-17-1操作系统</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/操作系统原理/2023-6-17-2操作系统目标和作用.html"><span class="label">2023-6-17-2操作系统目标和作用</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/操作系统原理/2023-6-17-3操作系统特征.html"><span class="label">2023-6-17-3操作系统特征</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/操作系统原理/2023-6-17-4操作系统的发展.html"><span class="label">2023-6-17-4操作系统的发展</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/操作系统原理/2023-6-17-5运行机制.html"><span class="label">2023-6-17-5运行机制</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/操作系统原理/2023-6-18-6中断异常.html"><span class="label">2023-6-18-6中断异常</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/操作系统原理/2023-6-18-7系统调用.html"><span class="label">2023-6-18-7系统调用</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/操作系统原理/2023-6-19-8体系结构.html"><span class="label">2023-6-19-8体系结构</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/操作系统原理/2023-6-20-10虚拟机.html"><span class="label">2023-6-20-10虚拟机</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/操作系统原理/2023-6-20-11进程.html"><span class="label">2023-6-20-11进程</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/操作系统原理/2023-6-20-9操作系统的引导.html"><span class="label">2023-6-20-9操作系统的引导</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/操作系统原理/2023-6-22-12线程.html"><span class="label">2023-6-22-12线程</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/操作系统原理/2023-6-23-13调度.html"><span class="label">2023-6-23-13调度</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/操作系统原理/2023-6-27-14进程同步进程互斥.html"><span class="label">2023-6-27-14进程同步进程互斥</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/操作系统原理/2023-6-28-15锁.html"><span class="label">2023-6-28-15锁</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/操作系统原理/2023-6-28-16信号量机制.html"><span class="label">2023-6-28-16信号量机制</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">服务器</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/note/Linux/服务器/2023-6-12-代理.html"><span class="label">2023-6-12-代理</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/服务器/2023-6-12-新服务器搭建.html"><span class="label">2023-6-12-新服务器搭建</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">李述铜手写操作系统</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/note/Linux/李述铜手写操作系统/2023-10-26-05中断和异常处理.html"><span class="label">2023-10-26-05中断和异常处理</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/李述铜手写操作系统/2023-11-10-06日志与printf输出.html"><span class="label">2023-11-10-06日志与printf输出</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/李述铜手写操作系统/2023-9-23-03引导程序接管控制权.html"><span class="label">2023-9-23-03引导程序接管控制权</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/李述铜手写操作系统/2023-9-28-04加载器loader的实现.html"><span class="label">2023-9-28-04加载器loader的实现</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/李述铜手写操作系统/2023-9-6-01补充知识2.html"><span class="label">2023-9-6-01补充知识2</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/李述铜手写操作系统/2023-9-6-0补充知识.html"><span class="label">2023-9-6-0补充知识</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/李述铜手写操作系统/2023-9-6-1操作系统准备.html"><span class="label">2023-9-6-1操作系统准备</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/李述铜手写操作系统/2023-9-7-2x86保护模式下的编程.html"><span class="label">2023-9-7-2x86保护模式下的编程</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/李述铜手写操作系统/2024-2-17-07进程切换.html"><span class="label">2024-2-17-07进程切换</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/李述铜手写操作系统/2024-2-17-08链表.html"><span class="label">2024-2-17-08链表</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/李述铜手写操作系统/2024-2-17添加任务管理器.html"><span class="label">2024-2-17添加任务管理器</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/李述铜手写操作系统/2024-2-18-内存管理.html"><span class="label">2024-2-18-内存管理</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/李述铜手写操作系统/2024-2-24-系统调用.html"><span class="label">2024-2-24-系统调用</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/李述铜手写操作系统/2024-2-26-移植Newlib库.html"><span class="label">2024-2-26-移植Newlib库</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/李述铜手写操作系统/2024-2-27-屏幕显示信息.html"><span class="label">2024-2-27-屏幕显示信息</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/李述铜手写操作系统/2024-2-29-键盘初始化.html"><span class="label">2024-2-29-键盘初始化</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/李述铜手写操作系统/2024-3-1-设备管理.html"><span class="label">2024-3-1-设备管理</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/李述铜手写操作系统/2024-3-3-Shell.html"><span class="label">2024-3-3-Shell</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/李述铜手写操作系统/2024-3-4-文件系统.html"><span class="label">2024-3-4-文件系统</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/李述铜手写操作系统/2024-3-5-磁盘.html"><span class="label">2024-3-5-磁盘</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/李述铜手写操作系统/2024-3-7-Fat16.html"><span class="label">2024-3-7-Fat16</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">树莓派</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/note/Linux/树莓派/2024-2-1-01开始使用.html"><span class="label">2024-2-1-01开始使用</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/树莓派/2024-2-1-02-使用命令了解树莓派.html"><span class="label">2024-2-1-02-使用命令了解树莓派</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/树莓派/2024-2-1-03-安装mysql.html"><span class="label">2024-2-1-03-安装mysql</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/树莓派/2024-2-3-04网络连接.html"><span class="label">2024-2-3-04网络连接</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/树莓派/2024-2-8-时钟设置.html"><span class="label">2024-2-8-时钟设置</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">泰山派</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/note/Linux/泰山派/2025-12-20-05-lvgl程序.html"><span class="label">2025-12-20-05-lvgl程序</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/泰山派/2025-12-24-06-二维码识别.html"><span class="label">2025-12-24-06-二维码识别</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/泰山派/2025-12-24-07-yolo部署.html"><span class="label">2025-12-24-07-yolo部署</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/泰山派/2025-12-25-08-OpenCV.html"><span class="label">2025-12-25-08-OpenCV</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/泰山派/2025-12-26-09-拍照.html"><span class="label">2025-12-26-09-拍照</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/泰山派/2025-12-26-10-Qt.html"><span class="label">2025-12-26-10-Qt</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/泰山派/2025-5-11-01环境搭建.html"><span class="label">2025-5-11-01环境搭建</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/泰山派/2025-5-11-02设备树.html"><span class="label">2025-5-11-02设备树</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/泰山派/2025-5-14-03屏幕驱动.html"><span class="label">2025-5-14-03屏幕驱动</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/泰山派/2025-5-17-04触摸驱动.html"><span class="label">2025-5-17-04触摸驱动</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/泰山派/2026-1-27-ROS.html"><span class="label">2026-1-27-ROS</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/泰山派/2026-1-30-Ubuntu22.html"><span class="label">2026-1-30-Ubuntu22</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">瑞芯微Linux</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/note/Linux/瑞芯微Linux/2025-12-10-Cpp提供C接口.html"><span class="label">2025-12-10-Cpp提供C接口</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/瑞芯微Linux/2025-12-5-01-EchoAI编译代码.html"><span class="label">2025-12-5-01-EchoAI编译代码</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/瑞芯微Linux/2025-12-5-02-EchoAI代码.html"><span class="label">2025-12-5-02-EchoAI代码</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/瑞芯微Linux/2025-12-7-03-添加板子.html"><span class="label">2025-12-7-03-添加板子</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/瑞芯微Linux/2025-12-8-04-内核.html"><span class="label">2025-12-8-04-内核</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/瑞芯微Linux/2025-12-9-05-模型.html"><span class="label">2025-12-9-05-模型</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/瑞芯微Linux/配置网络.html"><span class="label">配置网络</span><span class=""></span></a></li>
</ul>
</li>
<li class="active_parent no_link"><a><span class="label">野火Linux</span><span class="sub_indicator"></span></a><ul class="show">
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-10-11-55-buildroot.html"><span class="label">2025-10-11-55-buildroot</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-10-11-56-裸机汇编开发.html"><span class="label">2025-10-11-56-裸机汇编开发</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-10-12-57-Uboot编译脚本.html"><span class="label">2025-10-12-57-Uboot编译脚本</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-10-2-47-镜像构建.html"><span class="label">2025-10-2-47-镜像构建</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-10-2-48-systemd.html"><span class="label">2025-10-2-48-systemd</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-10-2-49-deb包.html"><span class="label">2025-10-2-49-deb包</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-10-2-50-修改img文件.html"><span class="label">2025-10-2-50-修改img文件</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-10-2-51-备份量产.html"><span class="label">2025-10-2-51-备份量产</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-10-2-52-Uboot启动.html"><span class="label">2025-10-2-52-Uboot启动</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-10-28-58-Uboot移植.html"><span class="label">2025-10-28-58-Uboot移植</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-10-30-59-Uboot图形配置界面语法.html"><span class="label">2025-10-30-59-Uboot图形配置界面语法</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-10-30-60-Linux编译脚本.html"><span class="label">2025-10-30-60-Linux编译脚本</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-10-31-61-Linux启动流程.html"><span class="label">2025-10-31-61-Linux启动流程</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-10-9-53-Uboot启动(二).html"><span class="label">2025-10-9-53-Uboot启动(二)</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-10-9-54-Uboot启动(三).html"><span class="label">2025-10-9-54-Uboot启动(三)</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-11-1-62-linux移植.html"><span class="label">2025-11-1-62-linux移植</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-11-1-63-Busybox.html"><span class="label">2025-11-1-63-Busybox</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-11-10-65-定时器.html"><span class="label">2025-11-10-65-定时器</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-11-12-66-信号.html"><span class="label">2025-11-12-66-信号</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-11-14-67-MISC设备.html"><span class="label">2025-11-14-67-MISC设备</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-11-15-68-RTC.html"><span class="label">2025-11-15-68-RTC</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-11-16-69-串口.html"><span class="label">2025-11-16-69-串口</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-11-18-70-中断线程化.html"><span class="label">2025-11-18-70-中断线程化</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-11-18-71-音频.html"><span class="label">2025-11-18-71-音频</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-11-19-72-CAN.html"><span class="label">2025-11-19-72-CAN</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-11-19-73-USB.html"><span class="label">2025-11-19-73-USB</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-11-2-64-mfgtool.html"><span class="label">2025-11-2-64-mfgtool</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-11-20-74-块设备.html"><span class="label">2025-11-20-74-块设备</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-11-21-75-网络设备.html"><span class="label">2025-11-21-75-网络设备</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-11-22-76-Wifi.html"><span class="label">2025-11-22-76-Wifi</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-11-22-77-PWM.html"><span class="label">2025-11-22-77-PWM</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-11-22-78-Regmap通用寄存器.html"><span class="label">2025-11-22-78-Regmap通用寄存器</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-11-22-79-IIO驱动框架.html"><span class="label">2025-11-22-79-IIO驱动框架</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-11-25-80-ADC驱动.html"><span class="label">2025-11-25-80-ADC驱动</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-12-6-81-音频驱动.html"><span class="label">2025-12-6-81-音频驱动</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-12-8-82-DRM显示设备.html"><span class="label">2025-12-8-82-DRM显示设备</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-6-11-01-入门.html"><span class="label">2025-6-11-01-入门</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-6-22-02-开发板下载启动.html"><span class="label">2025-6-22-02-开发板下载启动</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-7-12-04-镜像文件.html"><span class="label">2025-7-12-04-镜像文件</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-7-13-06-GPIO.html"><span class="label">2025-7-13-06-GPIO</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-7-13-07-中断.html"><span class="label">2025-7-13-07-中断</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-7-14-05-ARMv7汇编.html"><span class="label">2025-7-14-05-ARMv7汇编</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-7-14-08-时钟控制模块.html"><span class="label">2025-7-14-08-时钟控制模块</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-7-14-09-串口.html"><span class="label">2025-7-14-09-串口</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-7-15-10-内核模块.html"><span class="label">2025-7-15-10-内核模块</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-7-15-11-字符设备.html"><span class="label">2025-7-15-11-字符设备</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-7-15-12-驱动设备模型.html"><span class="label">2025-7-15-12-驱动设备模型</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-7-19-13-Kset.html"><span class="label">2025-7-19-13-Kset</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-7-19-14-uevent消息.html"><span class="label">2025-7-19-14-uevent消息</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-7-19-15-class设备管理.html"><span class="label">2025-7-19-15-class设备管理</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-7-19-16-17-总结.html"><span class="label">2025-7-19-16-17-总结</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-7-19-16-xbus和platform.html"><span class="label">2025-7-19-16-xbus和platform</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-7-2-03-控制设备.html"><span class="label">2025-7-2-03-控制设备</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-7-20-18-DTS设备树.html"><span class="label">2025-7-20-18-DTS设备树</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-7-20-19-DeviceTreeOverlay.html"><span class="label">2025-7-20-19-DeviceTreeOverlay</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-16-21-iomux节点(中).html"><span class="label">2025-9-16-21-iomux节点(中)</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-16-22-iomux节点(下).html"><span class="label">2025-9-16-22-iomux节点(下)</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-17-23-iomux节点(应用).html"><span class="label">2025-9-17-23-iomux节点(应用)</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-17-24-GPIO子系统.html"><span class="label">2025-9-17-24-GPIO子系统</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-17-25-并发硬件同步原语.html"><span class="label">2025-9-17-25-并发硬件同步原语</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-18-26-IIC驱动框架.html"><span class="label">2025-9-18-26-IIC驱动框架</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-20-27-IIC驱动框架使用.html"><span class="label">2025-9-20-27-IIC驱动框架使用</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-25-28-阻塞和非阻塞IO.html"><span class="label">2025-9-25-28-阻塞和非阻塞IO</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-25-29-POLL机制.html"><span class="label">2025-9-25-29-POLL机制</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-25-30-Completion.html"><span class="label">2025-9-25-30-Completion</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-25-31-kthread_worker.html"><span class="label">2025-9-25-31-kthread_worker</span><span class=""></span></a></li>
<li class="active with_link"><a href="/note/Linux/野火Linux/2025-9-26-32-SPI.html"><span class="label">2025-9-26-32-SPI</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-26-33-SPI使用.html"><span class="label">2025-9-26-33-SPI使用</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-27-34-中断.html"><span class="label">2025-9-27-34-中断</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-27-35-软中断和tasklet.html"><span class="label">2025-9-27-35-软中断和tasklet</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-27-36-工作队列.html"><span class="label">2025-9-27-36-工作队列</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-27-37-Input子系统.html"><span class="label">2025-9-27-37-Input子系统</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-28-38-电容触摸屏.html"><span class="label">2025-9-28-38-电容触摸屏</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-28-39-PWM.html"><span class="label">2025-9-28-39-PWM</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-28-40-LCD-FB设备.html"><span class="label">2025-9-28-40-LCD-FB设备</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-29-41-Linux系统构成.html"><span class="label">2025-9-29-41-Linux系统构成</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-29-42-Uboot基础使用.html"><span class="label">2025-9-29-42-Uboot基础使用</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-29-43-Linux.html"><span class="label">2025-9-29-43-Linux</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-29-44-添加驱动(设备树).html"><span class="label">2025-9-29-44-添加驱动(设备树)</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-30-45-图标.html"><span class="label">2025-9-30-45-图标</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-30-46-根文件系统.html"><span class="label">2025-9-30-46-根文件系统</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/2025-9-4-20-iomux节点(上).html"><span class="label">2025-9-4-20-iomux节点(上)</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/野火Linux/Untitled.html"><span class="label">Untitled</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">问题处理</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/note/Linux/问题处理/2022-11-20-Linux图形界面.html"><span class="label">2022-11-20-Linux图形界面</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/问题处理/2022-8-24-tftp下载.html"><span class="label">2022-8-24-tftp下载</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/问题处理/2022-8-26-uboot设置.html"><span class="label">2022-8-26-uboot设置</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/问题处理/2022-8-27-根文件系统被删除.html"><span class="label">2022-8-27-根文件系统被删除</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/问题处理/2022-8-5-没有release文件.html"><span class="label">2022-8-5-没有release文件</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/问题处理/2022-9-7-备份根文件.html"><span class="label">2022-9-7-备份根文件</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/问题处理/2022-9-9-ubuntu移植问题处理.html"><span class="label">2022-9-9-ubuntu移植问题处理</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/问题处理/2023-11-11-树莓派.html"><span class="label">2023-11-11-树莓派</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/问题处理/2023-6-14-打不开gpedit-msc.html"><span class="label">2023-6-14-打不开gpedit-msc</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/问题处理/2023-6-28-vscode配置.html"><span class="label">2023-6-28-vscode配置</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/note/Linux/问题处理/2023-8-27-开发板网络设置.html"><span class="label">2023-8-27-开发板网络设置</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">韦东山Linux</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/note/Linux/韦东山Linux/2025-3-4-基础.html"><span class="label">2025-3-4-基础</span><span class=""></span></a></li>
</ul>
</li>
</ul>

            </div>
        </div>
        <div id="article">
            <div id="menu_wrapper">
                <div id="menu">
                </div>
            </div>
            <div id="content_wrapper">
                <div id="content_body">
                    <div id="article_head">
                        <div id="article_title">
                            
                            <h1></h1>
                            
                        </div>
                        <div id="article_tags">
                            <ul>
                            
                            </ul>
                        </div>
                        <div id="article_info">
                        <div id="article_info_left">
                            <span class="article_author">
                                
                            </span>
                            
                                <span class="article_date" title="最后修改日期： 2025-12-14">
                                    2025-12-14
                                </span>
                            
                        </div>
                        <div id="article_info_right">
                            
                            <div id="source_link">
                                <a href="https://github.com/XuSenfeng/note/tree/master/doc/Linux/野火Linux/2025-9-26-32-SPI.md" target="_blank">
                                    编辑本页
                                </a>
                            </div>
                            
                        </div>
                        </div>
                    </div>
                    <div id="article_tools">
                        <span></span>
                        <span id="toc_btn"></span>
                    </div>
                    <div id="update_history">
                        
                    </div>
                    <div id="article_content">
                        
                            <h2 id="SPI%E7%89%A9%E7%90%86%E6%80%BB%E7%BA%BF">SPI物理总线</h2>
<h2 id="%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86">基础知识</h2>
<h3 id="%E4%BF%A1%E5%8F%B7%E7%BA%BF">信号线</h3>
<ul>
<li><p>SCK：时钟线，数据收发同步</p>
</li>
<li><p>MOSI：数据线，主设备数据发送、从设备数据接收</p>
</li>
<li><p>MISO：数据线，从设备数据发送，主设备数据接收</p>
</li>
<li><p>NSS、CS：片选信号线</p>
</li>
</ul>
<p>支持一主多从，全双工通信，最大速率可达上百MHz</p>
<p><img src="https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202509262016237.png" alt="image-20200912081954858" /></p>
<h3 id="spi%E6%97%B6%E5%BA%8F">spi时序</h3>
<p><img src="https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202509262016148.png" alt="image-20200912083029061" /></p>
<ul>
<li>起始信号：NSS 信号线由高变低</li>
<li>停止信号：NSS 信号由低变高</li>
<li>数据传输：在 SCK的每个时钟周期 MOSI和 MISO同时传输一位数据，高/低位传输没有硬性规定<ul>
<li>传输单位： 8 位或 16 位</li>
<li>单位数量：不受限制</li>
</ul>
</li>
</ul>
<h4 id="spi%E9%80%9A%E4%BF%A1%E6%A8%A1%E5%BC%8F">spi通信模式</h4>
<p>总线空闲时 SCK 的时钟状态以及数据采样时刻</p>
<ul>
<li><p>时钟极性 CPOL：指 SPI 通讯设备处于空闲状态时，SCK信号线的电平信号</p>
<ul>
<li>CPOL=0时， SCK在空闲状态时为低电平</li>
<li>CPOL=1时， SCK在空闲状态时为高电平</li>
</ul>
</li>
<li><p>时钟相位 CPHA：数据的采样的时刻</p>
<ul>
<li>当 CPHA=0 时，数据在 SCK 时钟线的“奇数边沿”被采样</li>
<li>当 CPHA=1时，数据在 SCK 时钟线的“偶数边沿”被采样</li>
</ul>
</li>
</ul>
<h5 id="%E6%A1%88%E4%BE%8B">案例</h5>
<p><img src="https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202509262016794.png" alt="image-20200912084313769" /></p>
<ul>
<li>SCK信号线在空闲状态为低电平时，CPOL=0；空闲状态为高电平时，CPOL=1</li>
<li>CPHA=0，数据在 SCK 时钟线的“奇数边沿”被采样</li>
<li>当 CPOL=0 的时候，时钟的奇数边沿是上升沿</li>
<li>当CPOL=1 的时候，时钟的奇数边沿是下降沿</li>
</ul>
<h5 id="%E5%9B%9B%E5%A4%A7%E6%A8%A1%E5%BC%8F">四大模式</h5>
<p><img src="https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202509262016704.png" alt="image-20200912084116532" /></p>
<h2 id="SPI%E9%A9%B1%E5%8A%A8%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B">SPI驱动框架简介</h2>
<h3 id="SPI%E6%A1%86%E6%9E%B6%E5%9B%BE">SPI框架图</h3>
<p><img src="https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202509271037021.png" alt="image-20200904124712459" /></p>
<ul>
<li><p>SPI核心层</p>
<p>提供SPI控制器驱动和设备驱动的注册方法、注销方法、SPI通信硬件无关接口</p>
</li>
<li><p>SPI主机驱动</p>
<p>主要包含SPI硬件体系结构中适配器(spi控制器)的控制，用于产生SPI 读写时序</p>
<p>主要数据结构：spi_master(spi_controller)</p>
</li>
<li><p>SPI设备驱动</p>
<p>通过SPI主机驱动与CPU交换数据</p>
<p>主要数据结构：spi_device和spi_driver</p>
</li>
</ul>
<h3 id="%E6%A0%B8%E5%BF%83%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">核心数据结构</h3>
<h5 id="spi_master">spi_master</h5>
<p>include/linux/spi/spi.h</p>

<pre class="language-c"><code class="language-c">#define spi_master			spi_controller
</code></pre>
<h5 id="spi_controller">spi_controller</h5>
<p>include/linux/spi/spi.h</p>

<pre class="language-c"><code class="language-c">struct spi_controller {
    struct device	dev; // 设备
    ...
    struct list_head list; // 链表节点, 可能有多个控制器
    s16			bus_num; // 编号
    u16			num_chipselect; // 片选信号的数量
    ...
    struct spi_message		*cur_msg; // 表示需要发送的信息
    ...
    int			(*setup)(struct spi_device *spi); // 初始化使用的函数指针
    int			(*transfer)(struct spi_device *spi, 
    					struct spi_message *mesg); // 传输消息(异步传输)
    void		(*cleanup)(struct spi_device *spi); // 清理工作
    struct kthread_worker		kworker; // 一个处理工人
    struct task_struct		*kworker_task; // 指向实际的处理task
    struct kthread_work		pump_messages; // 具体的工作
    struct list_head		queue; // 一系列的消息
    struct spi_message		*cur_msg;
    
    ...
    int (*transfer_one)(struct spi_controller *ctlr, struct spi_device *spi,struct spi_transfer *transfer);
    int (*prepare_transfer_hardware)(struct spi_controller *ctlr);
    int (*transfer_one_message)(struct spi_controller *ctlr,struct spi_message *mesg);
    void (*set_cs)(struct spi_device *spi, bool enable);
    ...
    int			*cs_gpios; // 具体的片选信号
}
</code></pre>
<ul>
<li><p>list：链表节点，芯片可能有多个spi控制器</p>
</li>
<li><p>bus_num：spi控制器编号</p>
</li>
<li><p>num_chipselect：片选信号的个数</p>
</li>
<li><p>cur_msg：当前正带处理的消息队列</p>
</li>
<li><p>transfer ：用于把数据加入控制器的消息链表中</p>
</li>
<li><p>cleanup：当spi_master被释放的时候，完成清理工作</p>
</li>
<li><p>kworker：内核线程工人，spi可以使用异步传输方式发送数据</p>
</li>
<li><p>pump_messages：具体传输工作</p>
</li>
<li><p>queue：所有等待传输的消息队列挂在该链表下</p>
</li>
<li><p>transfer_one_message：发送一个spi消息，类似IIC适配器里的algo-&gt;master_xfer，产生spi通信时序</p>
</li>
<li><p>相关API</p>
<ul>
<li><p><code>int spi_register_master(struct spi_master *master)</code></p>
<p>注册一个spi_controller</p>
</li>
<li><p><code>void spi_unregister_master(struct spi_master *master)</code></p>
<p>注销一个spi_controller</p>
</li>
</ul>
</li>
</ul>
<h5 id="spi_device">spi_device</h5>
<p>include/linux/spi/spi.h</p>

<pre class="language-c"><code class="language-c">struct spi_device {
    struct device		dev;
    struct spi_controller	*controller; // 控制器
    struct spi_controller	*master;	/* compatibility layer */
    u32			max_speed_hz; // 通信最大频率
    u8			chip_select; // 片选
    u8			bits_per_word; // 传输单位
    u16			mode; // 四种模式
#define	SPI_CPHA	0x01			/* clock phase */
#define	SPI_CPOL	0x02			/* clock polarity */
#define	SPI_MODE_0	(0|0)			/* (original MicroWire) */
#define	SPI_MODE_1	(0|SPI_CPHA)
#define	SPI_MODE_2	(SPI_CPOL|0)
#define	SPI_MODE_3	(SPI_CPOL|SPI_CPHA)
#define	SPI_CS_HIGH	0x04			/* chipselect active high? */
#define	SPI_LSB_FIRST	0x08			/* per-word bits-on-wire */
#define	SPI_3WIRE	0x10			/* SI/SO signals shared */
#define	SPI_LOOP	0x20			/* loopback mode */
#define	SPI_NO_CS	0x40			/* 1 dev/bus, no chipselect */
#define	SPI_READY	0x80			/* slave pulls low to pause */
#define	SPI_TX_DUAL	0x100			/* transmit with 2 wires */
#define	SPI_TX_QUAD	0x200			/* transmit with 4 wires */
#define	SPI_RX_DUAL	0x400			/* receive with 2 wires */
#define	SPI_RX_QUAD	0x800			/* receive with 4 wires */
...
    char			modalias[SPI_NAME_SIZE]; // 名字, 配对使用
...
}
</code></pre>
<h5 id="spi_driver">spi_driver</h5>
<p>include/linux/spi/spi.h</p>

<pre class="language-c"><code class="language-c">struct spi_driver {
    const struct spi_device_id *id_table; // 名字
    int			(*probe)(struct spi_device *spi);
    int			(*remove)(struct spi_device *spi);
    void			(*shutdown)(struct spi_device *spi);
    struct device_driver	driver;
};
</code></pre>
<ul>
<li><p>probe：spi设备和spi驱动匹配后，回调该函数指针</p>
</li>
<li><p>相关API：</p>
<ul>
<li><p><code>int spi_register_driver(struct spi_driver *sdrv)</code></p>
<p>注册一个spi驱动</p>
</li>
<li><p><code>void spi_unregister_driver(struct spi_driver *sdrv)</code></p>
<p>注册一个spi驱动</p>
</li>
</ul>
</li>
</ul>
<h3 id="%E6%80%BB%E7%BA%BF%E6%B3%A8%E5%86%8C">总线注册</h3>
<h4 id="spi_init%E5%87%BD%E6%95%B0">spi_init函数</h4>
<p>drivers/spi/spi.c</p>
<p>这个是自动调用的</p>

<pre class="language-c"><code class="language-c">static int __init spi_init(void)
{
    int	status;
    ...
    status = bus_register(&amp;spi_bus_type); // 生成/sys/bus/spi
    ...
    status = class_register(&amp;spi_master_class); // 生成/sys/class/spi_master
    ...
}
</code></pre>
<h4 id="spi%E6%80%BB%E7%BA%BF%E5%AE%9A%E4%B9%89">spi总线定义</h4>
<p>实际使用的匹配规则</p>

<pre class="language-c"><code class="language-c">struct bus_type spi_bus_type = {
    .name		= &quot;spi&quot;,
    .dev_groups	= spi_dev_groups,
    .match		= spi_match_device,
    .uevent		= spi_uevent,
};
</code></pre>
<h4 id="spi_match_device%28%29%E5%87%BD%E6%95%B0">spi_match_device()函数</h4>
<p>drivers/spi/spi.c 进行匹配的函数</p>

<pre class="language-c"><code class="language-c">static int spi_match_device(struct device *dev, struct device_driver *drv)
{
    const struct spi_device	*spi = to_spi_device(dev);
    const struct spi_driver	*sdrv = to_spi_driver(drv);

    /* Attempt an OF style match */
    if (of_driver_match_device(dev, drv))
    	return 1;

    /* Then try ACPI */
    if (acpi_driver_match_device(dev, drv))
    	return 1;

    if (sdrv-&gt;id_table)
    	return !!spi_match_id(sdrv-&gt;id_table, spi);

    return strcmp(spi-&gt;modalias, drv-&gt;name) == 0;
}
</code></pre>
<h4 id="%E8%AE%BE%E5%A4%87%E6%A0%91%E8%8A%82%E7%82%B9">设备树节点</h4>
<p>arch/arm/boot/dts/imx6ull.dtsi</p>
<p>4个spi控制器节点</p>

<pre class="language-json"><code class="language-json">ecspi3: ecspi@2010000 {
    				#address-cells = &lt;1&gt;;
    				#size-cells = &lt;0&gt;;
    				compatible = &quot;fsl,imx6ul-ecspi&quot;, &quot;fsl,imx51-ecspi&quot;;
    				reg = &lt;0x2010000 0x4000&gt;;
    				interrupts = &lt;GIC_SPI 33 IRQ_TYPE_LEVEL_HIGH&gt;;
    				// 时钟体系
    				clocks = &lt;&amp;clks IMX6UL_CLK_ECSPI3&gt;,
    					 &lt;&amp;clks IMX6UL_CLK_ECSPI3&gt;;
    				clock-names = &quot;ipg&quot;, &quot;per&quot;;
    				// DMA传输
    				dmas = &lt;&amp;sdma 7 7 1&gt;, &lt;&amp;sdma 8 7 2&gt;;
    				dma-names = &quot;rx&quot;, &quot;tx&quot;;
    				status = &quot;disabled&quot;;
    			};
</code></pre>
<h3 id="%E6%80%BB%E7%BA%BF%E9%A9%B1%E5%8A%A8">总线驱动</h3>
<h4 id="module_platform_driver%28%29%E5%AE%8F">module_platform_driver()宏</h4>
<p>include/linux/platform_device.h</p>
<p>spi总线注册的时候调用的函数</p>

<pre class="language-c"><code class="language-c">#define module_platform_driver(__platform_driver) \
    module_driver(__platform_driver, platform_driver_register, \
    		platform_driver_unregister)
</code></pre>
<h6 id="module_driver%28%29%E5%AE%8F">module_driver()宏</h6>
<p>include/linux/device.h</p>
<p>定义一个函数同时定义为模块的入口函数</p>

<pre class="language-c"><code class="language-c">#define module_driver(__driver, __register, __unregister, ...) \
static int __init __driver##_init(void) \
{ \
    return __register(&amp;(__driver) , ##__VA_ARGS__); \
} \
module_init(__driver##_init); \
</code></pre>
<ul>
<li><p>__driver：spi_imx_driver</p>
</li>
<li><p>__register：platform_driver_register</p>
</li>
<li><p>__unregister：platform_driver_unregister</p>
</li>
<li><p>##__VA_ARGS__：可变参数</p>
</li>
</ul>
<h6 id="module_platform_driver%28spi_imx_driver%29">module_platform_driver(spi_imx_driver)</h6>
<p>对这个宏定义进行展开以后得结构</p>

<pre class="language-none"><code class="language-none">static int __init spi_imx_driver_init(void) \
{ \
    return platform_driver_register(&amp;(spi_imx_driver) , ##__VA_ARGS__); \
} \
module_init(spi_imx_driver_init); \
</code></pre>
<h4 id="SPI%E4%B8%BB%E6%8E%A7%E5%88%B6%E5%99%A8%E9%A9%B1%E5%8A%A8">SPI主控制器驱动</h4>
<h5 id="spi_imx_probe%28%29%E5%87%BD%E6%95%B0">spi_imx_probe()函数</h5>
<ul>
<li>获取设备树节点信息，初始化spi时钟、dma...</li>
<li>保存spi寄存器起始地址，填充spi控制器回调函数</li>
</ul>
<p>drivers/spi/spi-imx.c</p>
<p><img src="https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202509271130213.png" alt="image-20250927113042133" /></p>

<pre class="language-c"><code class="language-c">static int spi_imx_probe(struct platform_device *pdev)
{
    struct device_node *np = pdev-&gt;dev.of_node;
    const struct of_device_id *of_id =
    		of_match_device(spi_imx_dt_ids, &amp;pdev-&gt;dev);
    struct spi_imx_master *mxc_platform_info =
    		dev_get_platdata(&amp;pdev-&gt;dev);
    struct spi_master *master;
    struct spi_imx_data *spi_imx;
    struct resource *res;
    const struct spi_imx_devtype_data *devtype_data = of_id ? of_id-&gt;data :
    	(struct spi_imx_devtype_data *)pdev-&gt;id_entry-&gt;driver_data;
    bool slave_mode;
    ...
    slave_mode = devtype_data-&gt;has_slavemode &amp;&amp;
    		of_property_read_bool(np, &quot;spi-slave&quot;); // 获取主从模式
    // 初始化一下结构的driver_data指针
    if (slave_mode)
        // 从模式
    	master = spi_alloc_slave(&amp;pdev-&gt;dev,
    				 sizeof(struct spi_imx_data));
    else
        // 主模式
    	master = spi_alloc_master(&amp;pdev-&gt;dev,
    				  sizeof(struct spi_imx_data));
    if (!master)
    	return -ENOMEM;
    ...
        // 获取到driver_data这个对象
       spi_imx = spi_master_get_devdata(master); 
    ...
        // 片选的数量
    	ret = of_property_read_u32(np, &quot;fsl,spi-num-chipselects&quot;, &amp;num_cs);
        if (ret &lt; 0) {
            if (mxc_platform_info) {
                num_cs = mxc_platform_info-&gt;num_chipselect;
                master-&gt;num_chipselect = num_cs;
            }
        } else {
            master-&gt;num_chipselect = num_cs; // 记录片选信号的数量
        }
    // bitbang用于使用普通的GPIO模拟时序
    spi_imx-&gt;bitbang.master = master;
    spi_imx-&gt;dev = &amp;pdev-&gt;dev;
    spi_imx-&gt;slave_mode = slave_mode;

    spi_imx-&gt;devtype_data = devtype_data;
    // 初始化一个记录GPIO的数组
    master-&gt;cs_gpios = devm_kzalloc(&amp;master-&gt;dev,
    		sizeof(int) * master-&gt;num_chipselect, GFP_KERNEL);
    // 回调函数(模拟SPI)
    spi_imx-&gt;bitbang.chipselect = spi_imx_chipselect;
    spi_imx-&gt;bitbang.setup_transfer = spi_imx_setupxfer;
    spi_imx-&gt;bitbang.txrx_bufs = spi_imx_transfer;
    spi_imx-&gt;bitbang.master-&gt;setup = spi_imx_setup;
    spi_imx-&gt;bitbang.master-&gt;cleanup = spi_imx_cleanup;
    spi_imx-&gt;bitbang.master-&gt;prepare_message = spi_imx_prepare_message;
    spi_imx-&gt;bitbang.master-&gt;unprepare_message = spi_imx_unprepare_message;
    spi_imx-&gt;bitbang.master-&gt;slave_abort = spi_imx_slave_abort;
    spi_imx-&gt;bitbang.master-&gt;mode_bits = SPI_CPOL | SPI_CPHA | SPI_CS_HIGH \
    ...
    init_completion(&amp;spi_imx-&gt;xfer_done);
    // 获取SPI的基地址
    res = platform_get_resource(pdev, IORESOURCE_MEM, 0);
    spi_imx-&gt;base = devm_ioremap_resource(&amp;pdev-&gt;dev, res);
    ...
    // 处理模拟SPI
    ret = spi_bitbang_start(&amp;spi_imx-&gt;bitbang);
    ...
}
</code></pre>
<h5 id="spi_bitbang_start%28%29%E5%87%BD%E6%95%B0">spi_bitbang_start()函数</h5>
<p>drivers/spi/spi-bitbang.c</p>

<pre class="language-c"><code class="language-c">int spi_bitbang_start(struct spi_bitbang *bitbang)
{
    struct spi_master *master = bitbang-&gt;master;
    int ret;

    if (!master || !bitbang-&gt;chipselect)
    	return -EINVAL;

    mutex_init(&amp;bitbang-&gt;lock);

    if (!master-&gt;mode_bits)
    	master-&gt;mode_bits = SPI_CPOL | SPI_CPHA | bitbang-&gt;flags;

    if (master-&gt;transfer || master-&gt;transfer_one_message)
    	return -EINVAL;

    master-&gt;prepare_transfer_hardware = spi_bitbang_prepare_hardware;
    master-&gt;unprepare_transfer_hardware = spi_bitbang_unprepare_hardware;
    master-&gt;transfer_one = spi_bitbang_transfer_one;
    master-&gt;set_cs = spi_bitbang_set_cs;

    if (!bitbang-&gt;txrx_bufs) {
    	bitbang-&gt;use_dma = 0;
    	bitbang-&gt;txrx_bufs = spi_bitbang_bufs;
    	if (!master-&gt;setup) {
    		if (!bitbang-&gt;setup_transfer)
    			bitbang-&gt;setup_transfer =
    				 spi_bitbang_setup_transfer;
    		master-&gt;setup = spi_bitbang_setup;
    		master-&gt;cleanup = spi_bitbang_cleanup;
    	}
    }

    /* driver may get busy before register() returns, especially
     * if someone registered boardinfo for devices
     */
    // 注册到Linux里面
    ret = spi_register_master(spi_master_get(master));
    if (ret)
    	spi_master_put(master);

    return ret;
}
EXPORT_SYMBOL_GPL(spi_bitbang_start);
</code></pre>
<h2 id="%E6%A0%B8%E5%BF%83API">核心API</h2>
<p><img src="https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202509271233908.png" alt="image-20250927123351813" /></p>
<h3 id="%E9%85%8D%E7%BD%AE%E5%87%BD%E6%95%B0%28%E8%AE%BE%E5%A4%87%E6%A0%91%E8%87%AA%E5%8A%A8%E8%AE%BE%E7%BD%AE%29">配置函数(设备树自动设置)</h3>
<h4 id="spi_setup%28%29%E5%87%BD%E6%95%B0">spi_setup()函数</h4>
<p>设置spi设备的片选信号、传输单位、最大传输速率...</p>
<p>drivers/spi/spi.c</p>

<pre class="language-c"><code class="language-c">int spi_setup(struct spi_device *spi)
{
    unsigned	bad_bits, ugly_bits;
    int		status;

    ...
    // 初始化数据的长度
    status = __spi_validate_bits_per_word(spi-&gt;controller,
    				      spi-&gt;bits_per_word);
    ...
    // 初始化一下数据的传输速率
    spi-&gt;max_speed_hz = spi-&gt;controller-&gt;max_speed_hz;
    ...
    if (spi-&gt;controller-&gt;setup)
        // 调用spi_imx_setup函数
    	status = spi-&gt;controller-&gt;setup(spi);
    ...
    return status;
}
</code></pre>
<h4 id="spi_imx_setup%28%29%E5%87%BD%E6%95%B0">spi_imx_setup()函数</h4>
<p>drivers/spi/spi-imx.c</p>

<pre class="language-c"><code class="language-c">static int spi_imx_setup(struct spi_device *spi)
{
    dev_dbg(&amp;spi-&gt;dev, &quot;%s: mode %d, %u bpw, %d hz\n&quot;, __func__,
    	 spi-&gt;mode, spi-&gt;bits_per_word, spi-&gt;max_speed_hz);
    // 看一下是不是使用CS
    if (spi-&gt;mode &amp; SPI_NO_CS)
    	return 0;

    if (gpio_is_valid(spi-&gt;cs_gpio))
        // 设置为输出模式
    	gpio_direction_output(spi-&gt;cs_gpio,
    			      spi-&gt;mode &amp; SPI_CS_HIGH ? 0 : 1);

    spi_imx_chipselect(spi, BITBANG_CS_INACTIVE);

    return 0;
}
</code></pre>
<h4 id="spi_imx_chipselect%28%29%E5%87%BD%E6%95%B0">spi_imx_chipselect()函数</h4>
<p>drivers/spi/spi-imx.c 进行设备的片选</p>

<pre class="language-c"><code class="language-c">static void spi_imx_chipselect(struct spi_device *spi, int is_active)
{
    int active = is_active != BITBANG_CS_INACTIVE;
    int dev_is_lowactive = !(spi-&gt;mode &amp; SPI_CS_HIGH); // 查找一下有效信号的电平

    if (spi-&gt;mode &amp; SPI_NO_CS)
    	return;

    if (!gpio_is_valid(spi-&gt;cs_gpio))
    	return;
    // 设置电平
    gpio_set_value(spi-&gt;cs_gpio, dev_is_lowactive ^ active);
}
</code></pre>
<h3 id="%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%28%E9%87%8D%E8%A6%81%29">数据传输(重要)</h3>
<h5 id="spi_message_init%28%29%E5%87%BD%E6%95%B0">spi_message_init()函数</h5>
<p>include/linux/spi/spi.h</p>

<pre class="language-c"><code class="language-c">static inline void spi_message_init(struct spi_message *m)
{
    memset(m, 0, sizeof *m);
    spi_message_init_no_memset(m); // 初始化两个链表
}

</code></pre>
<h6 id="spi_message_init_no_memset%28%29%E5%87%BD%E6%95%B0">spi_message_init_no_memset()函数</h6>

<pre class="language-c"><code class="language-c">static inline void spi_message_init_no_memset(struct spi_message *m)
{
    INIT_LIST_HEAD(&amp;m-&gt;transfers);
    INIT_LIST_HEAD(&amp;m-&gt;resources);
}
</code></pre>
<h6 id="spi_message%E7%BB%93%E6%9E%84%E4%BD%93">spi_message结构体</h6>
<p>include/linux/spi/spi.h</p>

<pre class="language-c"><code class="language-c">struct spi_message {
    struct list_head	transfers;

    struct spi_device	*spi; // 属于的设备
    ...
    void			(*complete)(void *context); // 传输成功回调
    void			*context;
    unsigned		frame_length;
    unsigned		actual_length;
    int			status;
    ...
    struct list_head	queue; // 内核异步传输使用
    void			*state;

    /* list of spi_res reources when the spi message is processed */
    struct list_head        resources; // 记录相关资源
};
</code></pre>
<h5 id="spi_message_add_tail%28%29%E5%87%BD%E6%95%B0">spi_message_add_tail()函数</h5>
<p>include/linux/spi/spi.h</p>
<p>添加节点到链表</p>

<pre class="language-c"><code class="language-c">spi_message_add_tail(struct spi_transfer *t, struct spi_message *m)
{
    list_add_tail(&amp;t-&gt;transfer_list, &amp;m-&gt;transfers);
}
</code></pre>
<h6 id="spi_transfer%E7%BB%93%E6%9E%84%E4%BD%93">spi_transfer结构体</h6>
<p>include/linux/spi/spi.h</p>
<p>是spi message里面的一个基础元素</p>

<pre class="language-c"><code class="language-c">struct spi_transfer {

    const void	*tx_buf; // 发送的buf
    void		*rx_buf; // 接收的buf
    unsigned	len;
    ...
    u32		speed_hz;
    struct list_head transfer_list;
};
</code></pre>
<h5 id="spi_sync%28%29%E5%87%BD%E6%95%B0">spi_sync()函数</h5>
<p>drivers/spi/spi.c</p>
<p>同步传输数据，阻塞当前线程</p>

<pre class="language-none"><code class="language-none">int spi_sync(struct spi_device *spi, struct spi_message *message)

</code></pre>
<h5 id="spi_async%28%29%E5%87%BD%E6%95%B0">spi_async()函数</h5>
<p>drivers/spi/spi.c</p>
<p>异步传输数据，不会阻塞当前线程</p>

<pre class="language-c"><code class="language-c">int spi_async(struct spi_device *spi, struct spi_message *message)
</code></pre>
<h5 id="spi_read/write">spi_read/write</h5>
<p>上面的函数可以使用这两个内核封装以后得函数进行替代</p>

<pre class="language-c"><code class="language-c">static inline int
spi_read(struct spi_device *spi, void *buf, size_t len);
static inline int
spi_write(struct spi_device *spi, const void *buf, size_t len);
int spi_write_then_read(struct spi_device *spi,
    	const void *txbuf, unsigned n_tx,
    	void *rxbuf, unsigned n_rx);
</code></pre>
<p>这两个函数使用的是sync</p>
<h2 id="SPI%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E5%89%96%E6%9E%90%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E5%BC%82%E6%AD%A5">SPI数据传输剖析：同步、异步</h2>
<h4 id="spi_register_master%28%29%E5%87%BD%E6%95%B0">spi_register_master()函数</h4>
<p>include/linux/spi/spi.h</p>

<pre class="language-c"><code class="language-c">#define spi_register_master(_ctlr)	spi_register_controller(_ctlr)
</code></pre>
<h5 id="spi_register_controller%28%29%E5%87%BD%E6%95%B0">spi_register_controller()函数</h5>
<p>drivers/spi/spi.c</p>

<pre class="language-c"><code class="language-c">int spi_register_controller(struct spi_controller *ctlr)
{
    struct device		*dev = ctlr-&gt;dev.parent;
    struct boardinfo	*bi;
    int			status = -ENODEV;
    int			id, first_dynamic;
    ...
    dev_set_name(&amp;ctlr-&gt;dev, &quot;spi%u&quot;, ctlr-&gt;bus_num); // 初始化一下设备的名字
    status = device_add(&amp;ctlr-&gt;dev); // 进行设备的添加
    ...
    if (ctlr-&gt;transfer) {
    	dev_info(dev, &quot;controller is unqueued, this is deprecated\n&quot;);
    } else if (ctlr-&gt;transfer_one || ctlr-&gt;transfer_one_message) {
        // 这里
    	status = spi_controller_initialize_queue(ctlr);
    	...
    }
    ...
    list_add_tail(&amp;ctlr-&gt;list, &amp;spi_controller_list);
    ...
}
</code></pre>
<h5 id="spi_controller_initialize_queue%28%29%E5%87%BD%E6%95%B0">spi_controller_initialize_queue()函数</h5>
<p>drivers/spi/spi.c</p>

<pre class="language-c"><code class="language-c">static int spi_controller_initialize_queue(struct spi_controller *ctlr)
{
    int ret;
    // 初始化两个指针
    ctlr-&gt;transfer = spi_queued_transfer;
    if (!ctlr-&gt;transfer_one_message)
    	ctlr-&gt;transfer_one_message = spi_transfer_one_message;

    /* Initialize and start queue */
    // 初始化一个内核线程以及具体的工作
    ret = spi_init_queue(ctlr);
    if (ret) {
    	dev_err(&amp;ctlr-&gt;dev, &quot;problem initializing queue\n&quot;);
    	goto err_init_queue;
    }
    ctlr-&gt;queued = true;
    // 启动工作
    ret = spi_start_queue(ctlr);
    if (ret) {
    	dev_err(&amp;ctlr-&gt;dev, &quot;problem starting queue\n&quot;);
    	goto err_start_queue;
    }

    return 0;

err_start_queue:
    spi_destroy_queue(ctlr);
err_init_queue:
    return ret;
}
</code></pre>
<h5 id="spi_init_queue%28%29%E5%87%BD%E6%95%B0">spi_init_queue()函数</h5>
<ul>
<li>初始化内核线程工人</li>
<li>初始化内核具体工作</li>
</ul>
<p>drivers/spi/spi.c</p>

<pre class="language-c"><code class="language-c">static int spi_init_queue(struct spi_controller *ctlr)
{
    struct sched_param param = { .sched_priority = MAX_RT_PRIO - 1 };

    ctlr-&gt;running = false;
    ctlr-&gt;busy = false;
    // 初始化工人以及使用的线程
    kthread_init_worker(&amp;ctlr-&gt;kworker);
    ctlr-&gt;kworker_task = kthread_run(kthread_worker_fn, &amp;ctlr-&gt;kworker,
    				 &quot;%s&quot;, dev_name(&amp;ctlr-&gt;dev));
    if (IS_ERR(ctlr-&gt;kworker_task)) {
    	dev_err(&amp;ctlr-&gt;dev, &quot;failed to create message pump task\n&quot;);
    	return PTR_ERR(ctlr-&gt;kworker_task);
    }
    // 初始化一个具体的工作, 记录在ctlr-&gt;pump_messages里面
    kthread_init_work(&amp;ctlr-&gt;pump_messages, spi_pump_messages);

    ...

    return 0;
}
</code></pre>
<h5 id="spi_start_queue%28%29%E5%87%BD%E6%95%B0">spi_start_queue()函数</h5>
<p>启动内核具体工作</p>
<p>drivers/spi/spi.c</p>

<pre class="language-c"><code class="language-c">static int spi_start_queue(struct spi_controller *ctlr)
{
    unsigned long flags;

    spin_lock_irqsave(&amp;ctlr-&gt;queue_lock, flags);

    if (ctlr-&gt;running || ctlr-&gt;busy) {
    	spin_unlock_irqrestore(&amp;ctlr-&gt;queue_lock, flags);
    	return -EBUSY;
    }

    ctlr-&gt;running = true;
    ctlr-&gt;cur_msg = NULL;
    spin_unlock_irqrestore(&amp;ctlr-&gt;queue_lock, flags);
    // 添加工作
    kthread_queue_work(&amp;ctlr-&gt;kworker, &amp;ctlr-&gt;pump_messages);

    return 0;
}
</code></pre>
<h5 id="spi_pump_messages%28%29%E5%87%BD%E6%95%B0">spi_pump_messages()函数</h5>
<p>内核工作具体处理</p>
<p>drivers/spi/spi.c</p>

<pre class="language-c"><code class="language-c">static void spi_pump_messages(struct kthread_work *work)
{
    // 从message获取到实际的spi控制器
    struct spi_controller *ctlr =
    	container_of(work, struct spi_controller, pump_messages);

    __spi_pump_messages(ctlr, true);
}
</code></pre>
<h5 id="__spi_pump_messages%28%29%E5%87%BD%E6%95%B0">__spi_pump_messages()函数</h5>
<p>drivers/spi/spi.c</p>

<pre class="language-c"><code class="language-c">static void __spi_pump_messages(struct spi_controller *ctlr, bool in_kthread)
{
    unsigned long flags;
    bool was_busy = false;
    int ret;
    ...
    // 获取到第一个spi_message结构体
    ctlr-&gt;cur_msg =
    	list_first_entry(&amp;ctlr-&gt;queue, struct spi_message, queue);

    list_del_init(&amp;ctlr-&gt;cur_msg-&gt;queue);
    ...
    if (ctlr-&gt;prepare_message) {
    	ret = ctlr-&gt;prepare_message(ctlr, ctlr-&gt;cur_msg);
    	...
    	ctlr-&gt;cur_msg_prepared = true;
    }
    ...
    // 传输信息
    ret = ctlr-&gt;transfer_one_message(ctlr, ctlr-&gt;cur_msg);
    ...
}
    
</code></pre>
<h4 id="spi_sync%28%29%E5%87%BD%E6%95%B0">spi_sync()函数</h4>
<p>同步传输数据</p>
<p>drivers/spi/spi.c</p>

<pre class="language-c"><code class="language-c">int spi_sync(struct spi_device *spi, struct spi_message *message)
{
    int ret;

    mutex_lock(&amp;spi-&gt;controller-&gt;bus_lock_mutex);
    ret = __spi_sync(spi, message);
    mutex_unlock(&amp;spi-&gt;controller-&gt;bus_lock_mutex);

    return ret;
}
</code></pre>
<h5 id="__spi_sync%28%29%E5%87%BD%E6%95%B0">__spi_sync()函数</h5>
<p>drivers/spi/spi.c</p>

<pre class="language-c"><code class="language-c">static int __spi_sync(struct spi_device *spi, struct spi_message *message)
{
    int status;
    struct spi_controller *ctlr = spi-&gt;controller;
    unsigned long flags;

    status = __spi_validate(spi, message); // 校验通信参数
    if (status != 0)
    	return status;
    // 注册一个complete用于通知这一次通信的完成
    message-&gt;complete = spi_complete;
    message-&gt;context = &amp;done;
    message-&gt;spi = spi;
    ...
    if (ctlr-&gt;transfer == spi_queued_transfer) {
        // 执行这里
    	spin_lock_irqsave(&amp;ctlr-&gt;bus_lock_spinlock, flags);

    	trace_spi_message_submit(message);

    	status = __spi_queued_transfer(spi, message, false);

    	spin_unlock_irqrestore(&amp;ctlr-&gt;bus_lock_spinlock, flags);
    } else {
    	status = spi_async_locked(spi, message);
    }
    
    
    if (status == 0) {
    	...
         // 等待completion的完成
    	wait_for_completion(&amp;done);
    	status = message-&gt;status;
    }
    message-&gt;context = NULL;
    return status;
}
</code></pre>
<h5 id="__spi_queued_transfer%28%29%E5%87%BD%E6%95%B0">__spi_queued_transfer()函数</h5>
<p>drivers/spi/spi.c</p>

<pre class="language-c"><code class="language-c">static int __spi_queued_transfer(struct spi_device *spi,
    			 struct spi_message *msg,
    			 bool need_pump)
{
    struct spi_controller *ctlr = spi-&gt;controller;
    unsigned long flags;

    spin_lock_irqsave(&amp;ctlr-&gt;queue_lock, flags);
    // 判断一下是不是被占用的
    if (!ctlr-&gt;running) {
    	spin_unlock_irqrestore(&amp;ctlr-&gt;queue_lock, flags);
    	return -ESHUTDOWN;
    }
    msg-&gt;actual_length = 0;
    msg-&gt;status = -EINPROGRESS;

    list_add_tail(&amp;msg-&gt;queue, &amp;ctlr-&gt;queue);
    if (!ctlr-&gt;busy &amp;&amp; need_pump)
        // 添加具体的工资
    	kthread_queue_work(&amp;ctlr-&gt;kworker, &amp;ctlr-&gt;pump_messages);

    spin_unlock_irqrestore(&amp;ctlr-&gt;queue_lock, flags);
    return 0;
}
</code></pre>
<h5 id="spi_transfer_one_message%28%29%E5%87%BD%E6%95%B0">spi_transfer_one_message()函数</h5>
<p>drivers/spi/spi.c</p>

<pre class="language-c"><code class="language-c">static int spi_transfer_one_message(struct spi_controller *ctlr,
    			    struct spi_message *msg)
{
    struct spi_transfer *xfer;
    bool keep_cs = false;
    int ret = 0;
    unsigned long long ms = 1;
    struct spi_statistics *statm = &amp;ctlr-&gt;statistics;
    struct spi_statistics *stats = &amp;msg-&gt;spi-&gt;statistics;
    ...
    list_for_each_entry(xfer, &amp;msg-&gt;transfers, transfer_list) {
    	...
    	if (xfer-&gt;tx_buf || xfer-&gt;rx_buf) {
    		reinit_completion(&amp;ctlr-&gt;xfer_completion);
            // 实际的发送函数
    		ret = ctlr-&gt;transfer_one(ctlr, msg-&gt;spi, xfer);
    		...
    		if (ret &gt; 0) {
    			ret = 0;
    			ms = 8LL * 1000LL * xfer-&gt;len;
    			do_div(ms, xfer-&gt;speed_hz);
    			ms += ms + 200; /* some tolerance */

    			if (ms &gt; UINT_MAX)
    				ms = UINT_MAX;

    			ms = wait_for_completion_timeout(&amp;ctlr-&gt;xfer_completion,
    							 msecs_to_jiffies(ms));
    		}
    	
     	}
    ...
    // 添加新的工作
    spi_finalize_current_message(ctlr);
    ...
}
</code></pre>
<h5 id="spi_finalize_current_message%28%29%E5%87%BD%E6%95%B0">spi_finalize_current_message()函数</h5>
<p>drivers/spi/spi.c</p>

<pre class="language-c"><code class="language-c">void spi_finalize_current_message(struct spi_controller *ctlr)
{
    struct spi_message *mesg;
    unsigned long flags;
    int ret;
    
    ...
    ctlr-&gt;cur_msg = NULL;
    ctlr-&gt;cur_msg_prepared = false;
    // 添加下一个处理任务
    kthread_queue_work(&amp;ctlr-&gt;kworker, &amp;ctlr-&gt;pump_messages);
    ...
    mesg-&gt;state = NULL;
    if (mesg-&gt;complete)
        // 唤醒阻塞的线程
    	mesg-&gt;complete(mesg-&gt;context);
}
</code></pre>
<h4 id="spi_async%28%29%E5%87%BD%E6%95%B0">spi_async()函数</h4>
<p>异步传输数据</p>
<p>drivers/spi/spi.c</p>

<pre class="language-c"><code class="language-c">int spi_async(struct spi_device *spi, struct spi_message *message)
{
    ...
    ret = __spi_async(spi, message);
    ...
}
</code></pre>
<h5 id="__spi_async%28%29%E5%87%BD%E6%95%B0">__spi_async()函数</h5>
<p>drivers/spi/spi.c</p>

<pre class="language-c"><code class="language-c">static int __spi_async(struct spi_device *spi, struct spi_message *message)
{
    struct spi_controller *ctlr = spi-&gt;controller;
    ...
    return ctlr-&gt;transfer(spi, message);
}
</code></pre>
<h5 id="spi_queued_transfer%28%29%E5%87%BD%E6%95%B0">spi_queued_transfer()函数</h5>
<p>drivers/spi/spi.c</p>

<pre class="language-c"><code class="language-c">static int spi_queued_transfer(struct spi_device *spi, struct spi_message *msg)
{
    return __spi_queued_transfer(spi, msg, true);
}
</code></pre>
<h5 id="__spi_queued_transfer%28%29%E5%87%BD%E6%95%B0">__spi_queued_transfer()函数</h5>
<p>drivers/spi/spi.c</p>

<pre class="language-c"><code class="language-c">static int __spi_queued_transfer(struct spi_device *spi,
    			 struct spi_message *msg,
    			 bool need_pump)
{
    struct spi_controller *ctlr = spi-&gt;controller;
    unsigned long flags;

    spin_lock_irqsave(&amp;ctlr-&gt;queue_lock, flags);

    if (!ctlr-&gt;running) {
    	spin_unlock_irqrestore(&amp;ctlr-&gt;queue_lock, flags);
    	return -ESHUTDOWN;
    }
    msg-&gt;actual_length = 0;
    msg-&gt;status = -EINPROGRESS;

    list_add_tail(&amp;msg-&gt;queue, &amp;ctlr-&gt;queue);
    if (!ctlr-&gt;busy &amp;&amp; need_pump)
    	kthread_queue_work(&amp;ctlr-&gt;kworker, &amp;ctlr-&gt;pump_messages);

    spin_unlock_irqrestore(&amp;ctlr-&gt;queue_lock, flags);
    return 0;
}
</code></pre>

                        
                    </div>
                </div>
                <div id="previous_next">
                    <div id="previous">
                        
                        <a href="/note/Linux/野火Linux/2025-9-25-31-kthread_worker.html">
                            <span class="icon"></span>
                            <span class="label">2025-9-25-31-kthread_worker</span>
                        </a>
                        
                    </div>
                    <div id="next">
                        
                        <a href="/note/Linux/野火Linux/2025-9-26-33-SPI使用.html">
                            <span class="label">2025-9-26-33-SPI使用</span>
                            <span class="icon"></span>
                        </a>
                        
                    </div>
                </div>
                <div id="comments-container"></div>
            </div>
            <div id="toc_wrapper">
                <div id="toc">
                    <div id="toc_content">
                            
                    </div>
                </div>
            </div>
        </div>
    </div>
    <a id="to_top" href="#"></a>
    <div id="doc_footer">
        <div id="footer">
            <div id="footer_top">
                <ul>
<li><a>链接</a><ul><li><a target="_blank" href="https://teedoc.neucrack.com">网站使用 teedoc 生成</a></li>
<li><a target="_blank" href="https://neucrack.com">Copyright © 2021 Neucrack</a></li>
<li><a  href="/note/sitemap.xml">网站地图</a></li>
</ul>
</li>
<li><a>源码</a><ul><li><a target="_blank" href="https://github.com/XuSenfeng/note/">github</a></li>
<li><a target="_blank" href="https://github.com/teedoc/teedoc">本网站源文件</a></li>
</ul>
</li>
</ul>

            </div>
            <div id="footer_bottom">
                <ul>
<li><a target="_blank" href="https://beian.miit.gov.cn">渝ICP备19015320号</a></li>
<li><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44030602004109">粤公网安备44030602004109号</a></li>
</ul>

            </div>
        </div>
    </div>
    
        <script src="/note/teedoc-plugin-markdown-parser/mermaid.min.js"></script>
    
        <script>mermaid.initialize({startOnLoad:true});</script>
    
        <script type="text/javascript">
                var transLoaded = false;
                var loading = false;
                var domain = "translate.google.com";
                var domainDefault = domain;
                var storeDomain = localStorage.getItem("googleTransDomain");
                if(storeDomain){
                    domain = storeDomain;
                    console.log("load google translate domain from local storage:" + domain);
                }
                function getUrl(domain){
                    if(domain == "/")
                        return "/static/js/google_translate/element.js?cb=googleTranslateElementInit";
                    else
                        return "https://" + domain + "/translate_a/element.js?cb=googleTranslateElementInit";
                }
                var url = getUrl(domain);
                console.log("google translate domain:" + domain + ", url: " + url);
                function googleTranslateElementInit() {
                    new google.translate.TranslateElement({pageLanguage: "auto", layout: google.translate.TranslateElement.InlineLayout.SIMPLE}, 'google_translate_element');
                }
                function loadJS( url, callback ){
                    var script = document.createElement('script');
                    fn = callback || function(){ };
                    script.type = 'text/javascript';
                    if(script.readyState){
                        script.onreadystatechange = function(){
                            if( script.readyState == 'loaded' || script.readyState == 'complete' ){
                                script.onreadystatechange = null;
                                fn();
                            }
                        };
                    }else{
                        script.onload = function(){
                            fn();
                        };
                    }
                    script.src = url;
                    document.getElementsByTagName('head')[0].appendChild(script);
                }
                function removeHint(){
                    var hint = document.getElementById("loadingTranslate");
                    if(hint){
                        hint.remove();
                    }
                }
                var btn = document.getElementById("google_translate_element");
                btn.onclick = function(){
                    if(transLoaded) return;
                    if(loading){
                        var flag = confirm("loading from " + domain + ", please wait, or change domain?");
                        if(flag){
                            newDomain = prompt("domain, default: " + domainDefault + ", now: " + domain);
                            if(newDomain){
                                domain = newDomain;
                                console.log(domain);
                                url = getUrl(domain);
                                loadJS(url, function(){
                                    localStorage.setItem("googleTransDomain", domain);
                                    removeHint()
                                    transLoaded = true;
                                });
                            }
                        }
                        return;
                    }
                    btn.innerHTML = '<span id="loadingTranslate"><img class="icon" src="/note/static/image/google_translate/translate.svg"/>Loading ...</span>';
                    loading = true;
                    loadJS(url, function(){
                        localStorage.setItem("googleTransDomain", domain);
                        removeHint()
                        transLoaded = true;
                    });
                }
                </script>
            
    
        <script src="/note/static/js/theme_default/tocbot.min.js"></script>
    
        <script src="/note/static/js/theme_default/main.js"></script>
    
        <script src="/note/static/js/theme_default/viewer.min.js"></script>
    
        <script src="/note/static/css/theme_default/prism.min.js"></script>
    
        <script src="/note/static/js/search/search_main.js"></script>
    
        <script src="/note/static/js/plugin_blog/main.js"></script>
    
        <link rel="stylesheet" href="/note/static/js/add_hint/style.css" type="text/css"/>
    
        <script src="/note/static/js/add_hint/main.js"></script>
    
        <script src="/note/static/js/gitalk/gitalk.min.js"></script>
    
        <script src="/note/static/js/gitalk/main.js"></script>
    
        <script src="/note/static/js/custom.js"></script>
    
</body>

</html>