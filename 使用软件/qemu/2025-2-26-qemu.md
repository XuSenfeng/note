# qemu

源的托管虚拟机, 纯软件虚拟化模拟器, 几乎可以模拟任何硬件设备, 电视性能比较低

### 两种运行模式

+ 用户模式(User mode)：利用动态代码翻译机制来执行不同主机架构的代码，例如：在x86平台上模拟执行ARM代码，也就是说：我们写一条ARM指令，传入整个模拟器中，模拟器会把整个指令翻译成x86平台的指令，然后在x86的CPU中执行。
+ 系统模式(System mode)：模拟整个电脑系统，利用其它VMM(Xen, KVM)来使用硬件提供的虚拟化支持，创建接近于主机性能的全功能虚拟机。

计算机的组成

+ 运算器
+ 控制器
+ 存储器
+ 输入设备
+ 输出设备

## 创建存储器

```
qemu-img creat -f qcow2 drive 16G
```

> 这个命令 `qemu-img creat -f qcow2 drive 16G` 是用于创建一个虚拟磁盘镜像文件的命令，具体解释如下：
>
> - `qemu-img`：这是一个用于创建、转换和修改虚拟硬盘镜像的命令行工具，属于 QEMU（一个开源虚拟化软件）的组成部分。
> - `create`：这个参数表示要创建一个新的镜像文件。
> - `-f qcow2`：`-f` 选项指定要创建的镜像格式，而 `qcow2`（QEMU Copy-On-Write version 2）是一种支持快照的高效虚拟硬盘格式，具有动态扩展、压缩和加密等特性。
> - `drive`：这是要创建的镜像文件的名称。在实际使用时，可以自定义为任何合适的文件名，通常可以在后面加上文件扩展名，如 `drive.qcow2`。
> - `16G`：这是创建的镜像文件的大小，这里指定为 16GB（吉字节）。在 `qcow2` 格式中，实际使用的磁盘空间会根据写入的数据量动态变化，而不会一开始就占满指定的大小。
>
> 综上所述，这个命令会创建一个名为 `drive`（或其他自定义名称）的 16GB 大小的 qcow2 格式虚拟磁盘镜像文件。虚拟硬件环境

## 加载

```bash
qemu-system-x86_64.exe -hda .\qcow2 -smp 4 -m 1024 -boot d -cdrom 镜像路径
```

> 1. `qemu-system-x86_64.exe`：这是 QEMU 的一个可执行文件，用于在 x86_64 架构（即 64 位架构）上运行虚拟机。
> 2. `-hda .\qcow2`：这个选项指定了虚拟机的主硬盘驱动器（HDA）。`.\qcow2` 是虚拟硬盘映像文件的路径，可能是一个 QCOW2 格式的映像文件。`QCOW2` 是 QEMU 的一种虚拟磁盘格式，支持动态分配和快照功能。这里 `.\` 表示当前目录。
> 3. `-smp 4`：这个选项指定虚拟机使用的 CPU 核心数。在这个例子中，分配了 4 个 CPU 核心给虚拟机。
> 4. `-m 1024`：这个选项指定虚拟机的内存大小。在这个例子中，虚拟机被分配了 1024 MB（1 GB）的内存。
> 5. `-boot d`：这个选项指定启动顺序。在这里，`d` 表示从光盘（CD-ROM）启动。这个选项通常用于启动安装操作系统。
> 6. `-cdrom 镜像路径`：这个选项指定了虚拟机的 CD-ROM 驱动器中使用的光盘映像文件的路径。您需要将 "镜像路径" 替换为实际的光盘映像文件路径，例如 ISO 文件的路径，这个文件通常包含您要安装的操作系统的安装程序。

在linux下面可以使用`-enable-kvm`进行加速

> KVM（Kernel-based Virtual Machine）是一个开源的虚拟化技术，它是Linux内核的一部分，允许Linux作为虚拟机监控器（hypervisor）运行虚拟机。KVM使得用户可以在完整的虚拟机中运行其他操作系统，这些虚拟机称为客虚拟机（guest）。