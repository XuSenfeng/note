# 上线

1. 购买服务器
2. 安装环境, python, nginx, 安装mysql
3. 编写uwsgi配置文件
4. 上传代码
5. 配置nginx--后端接口--admin管理(http)
6. 配置admin访问后台
7. 购买证书, https访问
8. 域名备案

## nginx

进行请求的转发, 转发给django框架, 同时配置https

```bash
23  2025-08-13 21:25:03 wget http://nginx.org/download/nginx-1.24.0.tar.gz
24  2025-08-13 21:25:53 tar -xf nginx-1.24.0.tar.gz 
27  2025-08-13 21:26:21 cd nginx-1.24.0/
29  2025-08-13 21:29:48 sudo apt-get install libpcre3 libpcre3-dev
31  2025-08-13 21:33:20 sudo apt-get install libssl-dev
32  2025-08-13 21:33:29 ./configure --prefix=/usr/local/nginx --with-http_ssl_module
33  2025-08-13 21:33:56 make && make install
34  2025-08-13 21:35:30 ln -s /usr/local/nginx/sbin/nginx /usr/bin/nginx
35  2025-08-13 21:35:37 cd
36  2025-08-13 21:35:40 nginx
```

这时候已经可以访问80端口了, 可以使用`nginx -s stop`停止服务

### 代理静态资源

在django里面加入一个配置选项, 创建这个文件夹

`STATIC_ROOT = BASE_DIR / "static"`

使用命令`python manage.py collectstatic`

加入nginx代理

### 端口转发

`vim /usr/local/nginx/conf/nginx.conf`

```json
events {

    worker_connections 1024;
}
http {
    include mime.types;
    default_type application/octet-stream;
    sendfile on;
    server {
        listen 80;
        server_name 127.0.0.1;
        charset utf-8;
        client_max_body_size 10M;
        location / {
            include uwsgi_params;
            uwsgi_pass 127.0.0.1:8000;
            uwsgi_param UWSGI_SCRIPT ElectronicServer.wsgi;
            uwsgi_param UWSGI_CHDIR /root/ElectronicServer;
        }
        location /static {
                alias /root/ElectronicServer/static;
        }
     
    }
}
```

`nginx -s reload`

## python环境

```
pip freeze > requirements.txt
```

```bash
9  2025-08-13 21:10:58 wget https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/Miniconda3-py39_25.5.1-0-Linux-x86_64.sh
10  2025-08-13 21:11:17 ls
11  2025-08-13 21:11:28 chmod 777 Miniconda3-py39_25.5.1-0-Linux-x86_64.sh 
12  2025-08-13 21:11:30 ./Miniconda3-py39_25.5.1-0-Linux-x86_64.sh 
13  2025-08-13 21:14:19 conda create -n ElectronicPetServer python=3.10
15  2025-08-13 21:17:37 conda activate ElectronicPetServer
18  2025-08-13 21:19:28 vim requests.txt 
19  2025-08-13 21:19:39 pip install -r requests.txt 
```

## mysql

### 下载

```bash
39  2025-08-13 21:40:45 sudo apt install -y mysql-server
40  2025-08-13 21:41:20 sudo systemctl start mysql
41  2025-08-13 21:41:32 sudo systemctl enable mysql
42  2025-08-13 21:41:41 sudo systemctl status mysql
43  2025-08-13 21:42:00 sudo mysql -uroot -p
```



### 远程连接

[远程连接hy-CSDN博客](https://blog.csdn.net/qq_34988204/article/details/134830202)

编辑 MySQL 配置文件：打开 MySQL 的配置文件（通常位于 /etc/mysql/mysql.conf.d/mysqld.cnf），找到 bind-address 参数，并将其值设置为 MySQL 服务器的 IP 地址或 0.0.0.0（允许所有 IP 访问）。

`bind-address = 0.0.0.0`

重启 MySQL 服务器：保存并关闭配置文件后，重新启动 MySQL 服务器。

`sudo service mysql restart`

检查主机访问权限：登录到 MySQL 服务器，执行以下命令查看主机访问权限。

`USE mysql;`
`SELECT user, host FROM user;`

使用以下命令为你的主机添加访问权限。

`UPDATE user SET host = '%' WHERE user = 'root';`
刷新权限：执行以下命令刷新 MySQL 的权限表。
`FLUSH PRIVILEGES;`
重新尝试连接：现在应该可以使用你的 MySQL 客户端连接到 MySQL 服务器了。

![image-20250813220205359](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202508132202572.png)

### 创建数据库

```
create database school charset=utf8mb4;
```

```bash
python manage.py makemigrations
python manage.py migrate
```

## uwsgi

```
<uwsgi>
    <socket>127.0.0.1:8000</socket>
    <chdir>/root/ElectronicServer</chdir>
    <module>ElectronicServer.wsgi</module>
    <processes>4</processes>
    <daemonize>ElectronicServer.log</daemonize>
</uwsgi>
```

![image-20250813221631246](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202508132216548.png)

django配置

```python
DEBUG = False

ALLOWED_HOSTS = ['*']

BACKEND_URL = 'https://www.xvsenfeng.top'
```

### 安装

```
pip install uwsgi
ln -s /root/miniconda3/envs/ElectronicPetServer/bin/uwsgi /usr/bin/uwsgi
uwsgi -x smart.xml
```

uwsgi不可以代理静态资源, 需要使用nginx代理

文件传输

```
scp .\ElectronicServer.zip 用户名@你的ip:路径
```

## SSL证书

需要购买, 可以在https://app.zerossl.com/获取免费

申请以后创建证书

![image-20250815094613102](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202508150946343.png)

```
events {

    worker_connections 1024;
}
http {
    include mime.types;
    default_type application/octet-stream;
    sendfile on;
    client_max_body_size 20M;
    server {
        listen 443 ssl;
        ssl_certificate /usr/local/nginx/cert/xvsenfeng.top.pem;
        ssl_certificate_key /usr/local/nginx/cert/xvsenfeng.top.key;
        server_name xvsenfeng.top;
        location / {
            include uwsgi_params;
            uwsgi_pass 127.0.0.1:8000;
            uwsgi_param UWSGI_SCRIPT ElectronicServer.wsgi;
            uwsgi_param UWSGI_CHDIR /home/ElectronicServer;
        }
        location /static {
            alias /home/ElectronicServer/static/;
        }
    }
}
```

## 代码上传

![image-20250815105409094](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202508151054212.png)
