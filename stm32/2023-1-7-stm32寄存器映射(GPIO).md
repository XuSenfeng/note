---
layout: post
title: "stm32寄存器映射(GPIO实现)" 
date:   2022-8-23 15:39:08 +0800
tags: stm32
---

# stm32寄存器映射

## 新建工程

创建工程->选择文件夹->选择使用的芯片(stm32f103ve)

新建的文件需要一个启动文件, 这时会弹出界面, 选择是否使用自带的文件

```
E:\a学习\1.stm\A盘（资料盘）\1-程序源码_教程文档\1-[野火]《STM32库开发实战指南》(标准库源码)【优先学习】\0.书籍源码\0【固件库】STM32F10x_StdPeriph_Lib_V3.5.0\【固件库】STM32F10x_StdPeriph_Lib_V3.5.0\Libraries\CMSIS\CM3\DeviceSupport\ST\STM32F10x\startup\arm
```

选用文件`startup_stm32f10x_hd.s`复制到目录下面, 双击kiel5里面的文件夹, 添加文件

配置对应的下载相关的选项

### 编译产生的文件

+   可以在output选项中对产生的文件的名字进行更改

hex文件: 串口下载的文件

axf文件: keil里面的下载使用的文件

......

## 示例(LED)

使用的寄存器

+   端口输出寄存器(GPIO_ODR(0:15)): 可读可写, 每一个位对应一个IO, 可以对没一个位进行单独的读写, 偏移0xch, 初始值为0x0000, 挂载在APB2的GPIOB, 0x4001 0c00 

![QQ图片20230119161950](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1082/202301191620728.png)

+   端口配置低位寄存器(GPIOx_CRL): 每四个位控制一个端口的, 低两位控制输入输出的速度模式, 高两位控制输入输出的电气模式, 默认为输入模式

![QQ图片20230119161827](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1082/202301191619003.png)

+   RCC_APB2ENR: 使能RPB2的时钟, 初始值设置为零, 起始地址为40021000

![QQ图片20230119162702](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1082/202301191627567.png)

```c
#include "stm32f10x.h"
int main (void)
{
	//设置时钟
	*( unsigned int *) 0x40021018 |= ((1)<<3);
	//配置IO的模式, 设置为推挽输出
	*( unsigned int *) 0x40010c00 |= ((1)<<(0*4));
	//控制ODR
	*( unsigned int *) 0x40010c0c &= ~(1<<0);
	return 0;
	
}
```

