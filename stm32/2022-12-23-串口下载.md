---
layout: post
title: "串口下载" 
date:   2022-8-23 15:39:08 +0800
tags: stm32
---

# 串口下载

## ISP-在系统可编程

在空白的芯片上写入用户的代码, 不需要从电路板上面取下芯片, 也可以使用这种方式进行擦除

使用自举程序, 厂家烧写不能修改, 烧写在内部的FLASH

在常用的就是串口进行下载, 优点, 成本低, 但是只能进行下载, 不能进行仿真

+   普通ISP: 在下载的时候手动选择BOOT启动的方式
+   一键ISP: 硬件配合上位机一键下载

| BOOT0 | BOOT1 | 启动方式             |
| ----- | ----- | -------------------- |
| 0     | X     | 内部的FLASH          |
| 1     | 0     | 系统存储器(串口使用) |
| 1     | 1     | 内部的SRAM           |

~开发板的都是接地~

## 硬件电路

使用的是PA9-TX, PA10-RX

通过USB转串口, CH340

USART1才有串口下载的功能

使用软件: MCUISP



![QQ图片20221223212110](https://blog-1308522872.cos.ap-beijing.myqcloud.com/jhy/202212312352535.png)

![QQ图片20221223212444](https://blog-1308522872.cos.ap-beijing.myqcloud.com/jhy/202212312352536.png)



### 电路



![QQ图片20221223212645](https://blog-1308522872.cos.ap-beijing.myqcloud.com/jhy/202212312352537.png)

DTR和RTS可以通过软件进行控制, 在上面的软件图片左下角

![QQ图片20221223212728](https://blog-1308522872.cos.ap-beijing.myqcloud.com/jhy/202212312352538.png)

RTS低电平的时候, 三级管导通, BOOT被拉高

复位引脚默认为拉高的, 链接一个10K电阻, 想要拉低, U18的1,2引脚是连接的, 把DTR设置为高电平, 就会接通低电平的RTS

在进行下载的时候会进行检测, 一段时间后进入程序的下载, 进入模式之后两个引脚的电平可以更改

模拟开关的作用: 防止复位引脚的电平不稳定, 一般为几百毫秒, EN为使能引脚, 高电平使能

总结: RTS低电平进入模式, DTR高电平复位(软件设置相反, 因为电平的标准不同, 使用232标准, 完全相反)

![QQ图片20221223213422](https://blog-1308522872.cos.ap-beijing.myqcloud.com/jhy/202212312352539.png)

在使用的时候需要修改BOOT0为1就行了

![QQ图片20221223212931](https://blog-1308522872.cos.ap-beijing.myqcloud.com/jhy/202212312352540.png)



