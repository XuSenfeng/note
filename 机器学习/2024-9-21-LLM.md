---
layout: post
title: "LLM" 
date:   2024-8-5 15:39:08 +0800
tags: AI 机器学习
---

# LLM

[什么是LLM大语言模型？Large Language Model，从量变到质变 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/622518771)

Large Language ModelLLM的特点是**规模庞大，包含数十亿的参数**，帮助它们学习语言数据中的复杂模式。这些模型通常基于深度学习架构，如转化器

当数据达到一定的数量的时候, 模型产生明显的性能提升, 以及出现小模型里面不存在的性能，比如上下文学习（in-context learning）

1. 上下文学习。GPT-3 正式引入了上下文学习能力：假设语言模型已经提供了自然语言指令和多个任务描述，它可以通过完成输入文本的词序列来生成测试实例的预期输出，而无需额外的训练或梯度更新。
2. 指令遵循。通过对自然语言描述（即指令）格式化的[多任务](https://zhida.zhihu.com/search?q=多任务&zhida_source=entity&is_preview=1)数据集的混合进行微调，LLM 在微小的任务上表现良好，这些任务也以指令的形式所描述。这种能力下，指令调优使 LLM 能够在不使用显式样本的情况下通过理解任务指令来执行新任务，这可以大大提高泛化能力。
3. 循序渐进的推理。对于小语言模型，通常很难解决涉及多个推理步骤的复杂任务，例如数学学科单词问题。同时，通过思维链推理策略，LLM 可以通过利用涉及中间推理步骤的 prompt 机制来解决此类任务得出最终答案。据推测，这种能力可能是通过代码训练获得的。

### 训练方式

训练语言模型需要向其提供大量的文本数据，模型利用这些数据来学习人类语言的结构、语法和语义。这个过程通常是通过无监督学习完成的，使用一种叫做自我监督学习的技术。在自我监督学习中，模型通过预测序列中的下一个词或标记，为输入的数据生成自己的标签，并给出之前的词。

[2303.18223 (arxiv.org)](https://arxiv.org/pdf/2303.18223)

### 发展历程

![image-20240921101930636](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/image/202409211019711.png)

经历了从语言处理到任务处理, 可以细分为统计语言模型Statistical Language Model=>神经语言模型Neural Language Model=>预训练语言模型Pre-trained Language Model, PLM=> 大语言模型

现在面临的问题有不清楚为什么大语言模型会出现一些不同的特性, 研究团体比较难去训练一些大模型, 由于训练数据不能公开, 训练出来的模型不能顺应人类的道德观以及数据可能造假

## 资料

[RUCAIBox/LLMSurvey: The official GitHub page for the survey paper "A Survey of Large Language Models".](https://github.com/RUCAIBox/LLMSurvey)

[LLMBook.pdf (llmbook-zh.github.io)](https://llmbook-zh.github.io/LLMBook.pdf)

## 构建

1. 预训练, 使用与下游任务无关的大规模数据进行模型参数的初 始训练，可以认为是为模型参数找到一个较好的“初值点”。本质上 是在做一个世界知识的压缩

> 在进行这一个步骤的时候, 需要对数据进行严格的清洗, 去除有害的信息, 提高数据的质量
>
> 最后将清洗后的数据进行词元化（Tokenization） 流，并且切分成批次（Batch）

2. 指令微调与人类对齐

但是由于预训练任务形式所限，这些模型更擅长于文本补全，并 不适合直接解决具体的任务。

通过使用任务输入与输出的配对数据进行模型训练， 可以使得语言模型较好地掌握通过问答形式进行任务求解的能力。它主要起到了对于模型能力的激发作用，而不是 知识注入作用。

首次建立了神经语言模型性能与三 个主要因素——模型规模（𝑁）、数据规模（𝐷）和计算算力（𝐶）之间的幂律关系

![image-20240921120422758](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/image/202409211204806.png)

> GPT使用的有代码数据训练, 人类对齐
>
> （1）使用人类反馈、（2）协助人类评估和（3）进行对齐研究。
>
> 员引入了“红队攻击”（Red Teaming）机制减少生成有害或有毒的内容。

## 资源

[RUCAIBox/LLMSurvey: The official GitHub page for the survey paper "A Survey of Large Language Models".](https://github.com/RUCAIBox/LLMSurvey/)

### 开源模型

经过预训练的公开模型检查点（Model Checkpoint）用户可以根据自身研究或开发需求，灵活选择 并下载使用这些检查点。

> 在机器学习和深度学习领域，检查点是指在训练模型时定期保存模型的参数和优化器状态到磁盘上的文件。这样，在训练过程中可以随时将模型的状态保存下来，以便在需要的时候恢复模型的状态，继续训练或进行推理。

+ LLaMA 和 LLaMA-2. LLaMA [34] 是 Meta AI 在 2023 年 2 月发布的一系列 大语言模型，有 7B、13B、30B 和 65B 四种参数规模版本，是当时性能非常优异 的开源模型之一

![image-20240921225323134](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/image/202409212253202.png)

+ ChatGLM. ChatGLM [59, 60] 是智谱 AI 和清华大学联合开发的中英双语对 话式模型，最早发布于 2023 年 5 月，并一直进行迭代优化，目前已经更新到了 ChatGLM-3。
+ InternLM 和 InternLM-2. InternLM [64] 是上海人工智能实验室开发的多语 言开源大模型, 并且支持数十类插件，有较强的工具调用能力。
+ Falcon. Falcon [61] 是阿布扎比的技术创新研究院（TII）发布的一系列语言 模型
+ Baichuan 和 Baichuan-2. Baichuan [62] 是百川智能公司于 2023 年 6 月发布的开源可商用大语言模型，参数规模为 7B，支持中英双语
+ Qwen. Qwen [66] 是阿里巴巴公司开源的多语大模型系列，首次公开发布 于 2023 年 8 月，且仍在继续更新。在语言理解、推理、数学等方面均展现出了优秀的模型能力
+ Mistral. Mistral [67] 是 Mistral AI 在 2023 年 9 月公开发布的具有 7B 参数的 大语言模型, 并且在代码生成方面的 表现接近于专门为代码任务微调的 Code LLaMA (7B)。在解码效率上，Mistral 采 用了分组查询注意力技术

### 公开API

语言模型 API. 目前最常用的 GPT 系列模型 API 包括 GPT-3.5 Turbo、GPT-4 和 GPT-4 Turbo。开发者可以使用自己的数据来微调 GPT-3.5 Turbo， 以便更好地适用于个性化的应用场景，例如提高模型的指令遵循能力、定制化输 出格式以及定制化语气等

### 数据集

#### 网页

![image-20240921230515571](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/image/202409221007241.png)

#### 书籍

使用小说, 诗歌戏曲等

#### 维基百科

#### 代码

#### 微调数据集

在预训练之后，指令微调（也称为有监督微调）是增强或激活大语言模型特 定能力的重要方法之一（例如指令遵循能力）。

它们分为三种主要类型，即自然语 言处理任务数据集、日常对话数据集和合成数据集。

![image-20240921232110679](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/image/202409212321730.png)

## 预训练

预训练是研发大语言模型的第一个训练阶段，也是最为重要的一个阶段。有 效的预训练能够为大语言模型的能力奠定坚实的基础

通过在大规模语料上进行 预训练，大语言模型可以获得通用的语言理解与生成能力，掌握较为广泛的世界 知识，具备解决众多下游任务的性能潜力。

![image-20240922091613766](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/image/202409220916808.png)

在实际的数据过滤的时候, 需要根据不同的数据种类选择不同的过滤规则, 首先需要过滤低质量的数据比如广告, 之后使用不同语言的高质量数据

> 英语的高质量开源数据比较多, 所以在使用非英语的时候也会使用大量英语数据

还可以使用语言里面的标点符号的数量, 单词的比例之类的数值进行筛选, 以及关键词筛选, 过滤掉个人信息等

也可以训练一个文本质量分类器

> 在实际训练的时候可以同时使用多种不同的方法

在处理有用户数据的资料的时候可以把出现次数比较少的资料里面的信息替换, 比较多的不进行使用, 以及在数据输出的时候对数据再次进行过滤

### 数据去重

对预训练数据进行去重处理是一个重要步骤。由于大语言模型具有较强的数 据拟合与记忆能力，很容易习得训练数据中的重复模式，可能导致对于这些模式 的过度学习。

+ 计算粒度

可以删除包含重复单词和短语的低质量句子，因为它们可能会在 语言建模中引入重复的表达模式

在文档级别上，现有方法主要依靠单词或 𝑛 元词组的重叠这类表层特征，来衡量文档的重叠比率，进而检测和删除包含相似 内容的重复文档

+ 用于去重的匹配方法

计算出字符串的相似度, 一般来说这一个算法的消耗比较大(可以使用MinHash算法)

> MinHash 是一种估计两个集合之间相似度的技术，最初被引入到信息检索领域，旨 在迅速判断文档间的相似性。其核心思想在于，通过哈希处理集合元素，并选择最 小的哈希值作为集合的表示。随后，通过比较两个集合的最小哈希值，便能大致估 算出它们的相似度。

### 数据影响

+ 数量

语言模型的性能会随着训练数据数量的增加而提 升，符合扩展法则。

+ 数据的质量

使用低质量的数据会导致模型训练过程不稳定, 容易造成模型训练不收敛等问题

大语言模型所掌握的知识信息也来源于预 训练数据，这意味着如果模型在包含事实性错误的、过时的数据上进行训练，那 么它在处理相关主题时可能会产生不准确或虚假的信息

在现有的文献中，普遍认为重复数据对于模型训练及最终性能会 带来不良影响。

数据是大语言模型掌握知识与建立能力的基础，而 语言模型是对于训练数据语义的压缩。一旦数据中包含有偏、有毒、隐私的内容， 将会对于模型造成严重的不良影响。

+ 数据集污染

为了有效评估模型性能，通常需要构建相应的评测基准，来衡量大语言模型 在不同方面的能力, 在进行模型评测时，可能会发现某些评估基准所包含的数据，实 际上已出现在预训练数据或者微调数据中

数据集污染问题可能导致模型在与测试 数据集相关甚至高度重合的语料上进行训练，从而原本用于衡量模型在少样本或 零样本场景下的性能评测，转变为了领域内的测试任务。

## 名词记录

**词元:** 在大模型训练中，词元是指文本数据中的最小单位，通常是单词、短语或者符号。词元的作用是构建模型的输入数据，通过将文本数据转换为词元的形式，模型可以更好地理解和处理文本信息。词元可以帮助模型捕捉文本数据中的语义和结构特征，从而提高模型的性能和准确性。在训练过程中，词元也可以通过向量化表示，使得模型能够更好地学习文本数据中的语义信息。因此，词元在大模型训练中起着非常重要的作用。

**参数: **在进行大模型训练时，通常需要设置和调整的参数包括但不限于以下内容：

1. 学习率（learning rate）：控制模型在训练过程中更新参数的速率，以避免过拟合或欠拟合。
2. 批大小（batch size）：指定每次迭代训练时所使用的样本数量，影响模型的收敛速度和训练效果。
3. 优化算法（optimizer）：选择用于调整模型参数的优化算法，如随机梯度下降（SGD）、Adam等。
4. 损失函数（loss function）：定义用于评估模型输出与真实标签之间差异的函数，用于优化模型的训练过程。
5. 正则化参数（regularization）：控制模型的复杂度，防止过拟合，包括L1正则化、L2正则化等。
6. 学习率衰减（learning rate decay）：设置学习率随训练轮次递减的策略，帮助模型更好地收敛。
7. 训练轮次（epochs）：指定模型进行训练的轮次数量，通常通过交叉验证等技术确定合适的训练轮次。
8. 数据增强参数（data augmentation）：用于增加训练数据样本的多样性，提高模型的泛化能力。
9. GPU/CPU使用设备参数：指定模型训练时使用的计算设备，如GPU或CPU。
10. 模型保存与加载参数：设置模型在训练过程中的保存与加载策略，以便后续模型调用和部署。

以上是一些在大模型训练中常见的参数内容，具体的设置和调整可根据实际情况和任务需求进行进一步的定制。

**泛化能力: ** 

**迁移学习:** 类比调动