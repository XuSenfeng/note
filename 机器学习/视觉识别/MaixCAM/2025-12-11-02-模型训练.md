# 模型训练

[MaixHub](https://maixhub.com/)可以在这个界面进行线上的模型训练

## 基础使用

![image-20251211210232571](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202512112102710.png)

有两种, 一种是分类一种是位置检测

![image-20251211210353836](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202512112103996.png)

![image-20251211210409936](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202512112104015.png)

![image-20251211210433138](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202512112104266.png)

![image-20251211210522292](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202512112105441.png)

![image-20251211211124974](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202512112111232.png)

自动标注使用的是视频里面的标注, 使用其中一帧自动标注之后的数据

![image-20251211211703426](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202512112117733.png)

![image-20251211211939002](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202512112119161.png)

可以适当提高分辨率, 实际部署的时候图片的处理需要和训练的时候是一样的, 标准化是为了对像素进行预处理, 一般是变为0-1之间的数字

![image-20251211212007445](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202512112120508.png)

![image-20251211212058391](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202512112120571.png)

![image-20251211212414774](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202512112124916.png)

## 部署

### 自动部署

使用开发板上面的MaicHub Client扫码就可以进行部署

### 代码部署

![image-20251211215345449](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202512112153538.png)

```python

from maix import camera, display, image, nn, app, comm
import struct, os

report_on = True
APP_CMD_DETECT_RES = 0x02

def encode_objs(objs):
    '''
        encode objs info to bytes body for protocol
        2B x(LE) + 2B y(LE) + 2B w(LE) + 2B h(LE) + 2B idx + 4B score(float) ...
    '''
    body = b''
    for obj in objs:
        body += struct.pack("<hhHHHf", obj.x, obj.y, obj.w, obj.h, obj.class_id, obj.score)
    return body

model_path = "model_245391.mud"
if not os.path.exists(model_path):
    model_path = "/root/models/maixhub/245391/model_245391.mud"
detector = nn.YOLOv5(model=model_path)

cam = camera.Camera(detector.input_width(), detector.input_height(), detector.input_format())
dis = display.Display()

p = comm.CommProtocol(buff_size = 1024)

while not app.need_exit():
    # msg = p.get_msg()

    img = cam.read()
    objs = detector.detect(img, conf_th = 0.5, iou_th = 0.45)

    if len(objs) > 0 and report_on:
        body = encode_objs(objs)
        p.report(APP_CMD_DETECT_RES, body)

    for obj in objs:
        img.draw_rect(obj.x, obj.y, obj.w, obj.h, color = image.COLOR_RED)
        msg = f'frog: {obj.score:.2f}'
        img.draw_string(obj.x, obj.y, msg, color = image.COLOR_RED)
    dis.show(img)
```

