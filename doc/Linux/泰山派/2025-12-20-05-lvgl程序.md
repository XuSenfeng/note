# lvgl程序

```txt
============================================
TARGET_ARCH=arm64
TARGET_PLATFORM=rk356x
TARGET_UBOOT_CONFIG=rk3566
TARGET_SPL_CONFIG=
TARGET_KERNEL_CONFIG=rockchip_linux_defconfig
TARGET_KERNEL_DTS=tspi-rk3566-user-v10-linux
TARGET_TOOLCHAIN_CONFIG=
TARGET_BUILDROOT_CONFIG=rockchip_rk3566
TARGET_RECOVERY_CONFIG=rockchip_rk356x_recovery
TARGET_PCBA_CONFIG=
TARGET_RAMBOOT_CONFIG=
============================================
============Start building uboot============
TARGET_UBOOT_CONFIG=rk3566
=========================================
```

## 编译器

```bash
set(CMAKE_C_COMPILER /home/jiao/Taishan/rope/prebuilts/gcc/linux-x86/aarch64/gcc-linaro-6.3.1-2017.05-x86_64_aarch64-linux-gnu/bin/aarch64-linux-gnu-gcc)
set(CMAKE_CXX_COMPILER /home/jiao/Taishan/rope/prebuilts/gcc/linux-x86/aarch64/gcc-linaro-6.3.1-2017.05-x86_64_aarch64-linux-gnu/bin/aarch64-linux-gnu-g++)

# Specify the sysroot (if available)
set(CMAKE_SYSROOT /home/jiao/Taishan/rope/buildroot/output/rockchip_rk3566/host/aarch64-buildroot-linux-gnu/sysroot)
```

### 添加组件

[立创·泰山派：Buildroot开启libcurl+OpenSSL教程_buildroot openssl-CSDN博客](https://blog.csdn.net/m0_64657422/article/details/146468551)

在编译的时候需要一些使用到的组件需要从buildroot里面编译进去

```bash
make menuconfig

# 保存配置文件
make savedefconfig
# 手动将生成在 buildroot/defconfig 文件内容复制到 ./configs/rockchip_rk3566_defconfig 文件里面

# 全量编译（首次）
./build.sh all
# 只编译buildroot
./build.sh rootfs

./mkfirmware.sh
./build.sh updateimg
```

### 添加curl

```bash
Target packages
  -> Libraries
  	->Networking
    	-> libcurl [*]  # y 选择
	      SSL/TLS library to use (OpenSSL)  ---> 
	      # 可进去以选择ssl类型，如果没有，则需要开启openssl

# 若找不到，可以使用 ‘/’ 进行搜索
# 按下 ‘/’ 进入，打上 libcurl 搜索，打上 openssl 搜索
Target packages
  -> Libraries
    -> Crypto
      -> openssl [*]  # 选中OpenSSL

# 确保zlib启用（libcurl需要）
Target packages
  -> Libraries
    -> Compression
      -> zlib [*]
```

#### 验证

```bash
ls /usr/lib/libcurl.so*    # 应看到.so文件
ls /usr/lib/libssl.so*     # 检查OpenSSL
curl -v https://httpbin.org/get
```

### json-c

```bash
Target packages
  -> Libraries
  	-> JSON/XML
  	  -> json-c
```

###  libdrm

```
-> Target packages
 -> Libraries
  -> Graphics
   -> libdrm (BR2_PACKAGE_LIBDRM [=y])
```

这个库是新加进来的所以需要指定链接一下

```cmake
find_package(PkgConfig REQUIRED)
pkg_check_modules(LIBDRM REQUIRED libdrm)
target_include_directories(lvgl PRIVATE ${LIBDRM_INCLUDE_DIRS})
target_compile_options(lvgl PRIVATE ${LIBDRM_CFLAGS_OTHER})
```

## Wifi

```bash
# 在这个文件里面添加需要连接的Wifi的地址
vi /data/cfg/wpa_supplicant.conf
wpa_supplicant -B -i wlan0 -c /data/cfg/wpa_supplicant.conf
```

## 关闭原有桌面

```bash
chmod -x /etc/init.d/Sxxweston
```

## 开机自启动

```bash
root@RK356X:/# cat /etc/init.d/S49lvgl
#!/bin/sh

case "$1" in
        start|"")
                #while true
                #do
                #       list-iodomain.sh
                #       sleep $(( 60 * 2 ))
                #done &
                cd /root/bin
                ./main &
                ;;
        restart|reload|force-reload)
                echo "Error: argument '$1' not supported" >&2
                exit 3
                ;;
        stop|status)
                # No-op
                ;;
        *)
                echo "Usage: [start|stop]" >&2
                exit 3
                ;;
esac
root@RK356X:/# chmod +x /etc/init.d/S49lvgl
```

## 屏幕

```bash
screen height: 480
screen width: 800
```

## ffmpeg移植

### 下载x264

```bash
git clone https://code.videolan.org/videolan/x264.git
cd x264/
mkdir x264build
vim autoConfig.sh
```

```bash
#!/bin/bash

# 定义变量
# 设置x264的安装位置
PREFIX="./x264build"

# 交叉编译器bin路径
TOOLCHAIN_DIR="/home/jiao/Taishan/rope/prebuilts/gcc/linux-x86/aarch64/gcc-linaro-6.3.1-2017.05-x86_64_aarch64-linux-gnu/bin"

# 工具链前缀，用于指定交叉编译工具的路径
TOOLCHAIN="$TOOLCHAIN_DIR/aarch64-linux-gnu-"

# 运行 configure 脚本
echo "正在配置 x264..."
./configure \
  --prefix=$PREFIX \
  --disable-asm \
  --enable-shared \
  --enable-static \
  --host=aarch64-linux-gnu \
  --cross-prefix=$TOOLCHAIN \
  --enable-pic

# 检查 configure 的返回状态
if [ $? -ne 0 ]; then
  echo "错误：配置 x264 失败。"
  exit 1
else
  echo "配置成功。"
fi

# 编译 x264
echo "正在编译 x264..."
# 使用 nproc 获取处理器核心数，以确定并行编译的进程数
make -j$(nproc)

# 检查编译的返回状态
if [ $? -ne 0 ]; then
  echo "错误：编译 x264 失败。"
  exit 1
else
  echo "编译成功。"
fi

# 安装 x264
echo "正在安装 x264..."
make install

# 检查安装的返回状态
if [ $? -ne 0 ]; then
  echo "错误：安装 x264 失败。"
  exit 1
else
  echo "安装成功。"
fi

# 清理构建目录
echo "正在清理..."
make clean

# 检查清理的返回状态
if [ $? -ne 0 ]; then
  echo "警告：清理构建目录失败。"
else
  echo "构建过程完成。"
fi

# 脚本正常退出
exit 0
```

### 编译ffmpeg

```bash
git clone https://gitclone.com/github.com/nyanmisaka/ffmpeg-rockchip.git
cd ffmpeg-rockchip
mkdir ffmpeg_rk_build
vim autoConfig.sh
```

```bash
# 定义前缀目录
PREFIX="./ffmpeg_rk_build"

# x264安装目录的绝对路径
X264_BUILD_DIR="/home/jiao/app/x264/x264build"

# x264安装目录中include目录绝对路径
X264_INCLUDE_DIR="$X264_BUILD_DIR/include"
# x264安装目录中lib目录绝对路径
X264_LIB_DIR="$X264_BUILD_DIR/lib"

# 设置 PKG_CONFIG_PATH 环境变量
export PKG_CONFIG_PATH=$X264_LIB_DIR/pkgconfig:$PKG_CONFIG_PATH

echo "配置环境变量："
echo "export PKG_CONFIG_PATH=$X264_LIB_DIR/pkgconfig:$PKG_CONFIG_PATH"

echo "正在配置./configure..."

./configure \
        --prefix=$PREFIX \
        --enable-shared \
        --disable-static \
        --enable-cross-compile \
        --arch=arm64 \
        --disable-stripping \
        --target-os=linux \
        --cc= /home/jiao/Taishan/rope/prebuilts/gcc/linux-x86/aarch64/gcc-linaro-6.3.1-2017.05-x86_64_aarch64-linux-gnu/bin/aarch64-linux-gnu-gcc \
        --enable-libx264 \
        --extra-cflags=-I$X264_INCLUDE_DIR \
        --extra-ldflags=-L$X264_LIB_DIR \
        --pkg-config-flags="--static" \
        --extra-libs="-lpthread -lm" \
        --enable-gpl \
        --enable-pic \
        --enable-nonfree \
        --enable-pthreads

# 检查 ./configure 是否成功
if [ $? -eq 0 ]; then
    echo "./configure配置成功！"
else
    echo "./configure配置失败！请检查您的环境！！！"
fi


# 运行 make
echo "正在编译 ffmpeg-rockchip..."
# 使用 nproc 获取处理器核心数，以确定并行编译的进程数
make -j$(nproc)

if [ $? -eq 0 ]; then
    echo "Make成功！！！"
else
    echo "Make失败！！请检查错误信息，清除错误之后再次尝试！！"
    exit 1
fi

# 运行 make install
echo "正在安装 ffmpeg-rockchip..."

make install

if [ $? -eq 0 ]; then
    echo "Make intall 安装成功！！！！"
        echo "============================================="
        echo "ffmpeg_rk 被安装在$PREFIX!"
        echo "============================================="
else
    echo "Make install 安装失败！！请检查错误信息，清除错误之后再次尝试！！"
    exit 1
fi

# 清理构建目录
echo "正在清理..."
make clean

# 检查清理的返回状态
if [ $? -ne 0 ]; then
  echo "警告：清理构建目录失败。"
else
  echo "构建过程完成。"
fi

# 脚本正常退出
exit 0
```

将 **/x264/x264build/bin** 文件夹中的所有内容全部复制到开发板的 **/usr/bin/** 目录下

**/x264/x264build/lib** 文件夹中的所有内容全部复制到开发板的 **/usr/lib/** 目录下

将 **/ffmpeg-rockchip/ffmpeg_rk_build/bin** 文件夹中的所有内容全部复制到开发板的 **/usr/bin/** 目录下

**/ffmpeg-rockchip/ffmpeg_rk_build/lib** 文件夹中的所有内容全部复制到开发板的 **/usr/lib/** 目录下