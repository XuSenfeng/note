# ROS

![image-20260128095835281](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202601280958349.png)

泰山派默认的使用的是linux4.19的版本, 需要源码下载的文件在[这里](https://github.com/ros2/ros2/archive/refs/tags/release-humble-20230724.tar.gz)

在文件buildroot/configs/rockchip/ros2_dep.config 

```bash
BR2_PACKAGE_LTTNG_TOOLS=y
BR2_PACKAGE_LTTNG_LIBUST=y
```

在文件buildroot/configs/rockchip_rk356x_robot_defconfig 

添加`#include "ros2_dep.config"`

修改使用的库的版本号

```bash
cd 你的SDK根目录/buildroot/package/
# 检查 lttng-tools 版本
cat lttng-tools/lttng-tools.mk | grep VERSION
# 检查 lttng-libust 版本
cat lttng-libust/lttng-libust.mk | grep VERSION
# 检查 liburcu 版本
cat liburcu/liburcu.mk | grep VERSION
```

lttng-tools：`PKG_VERSION = 2.12.3`

lttng-libust：`PKG_VERSION = 2.12.3`

liburcu：`PKG_VERSION = 0.13.0`

如果版本不符，需要修改对应 `.mk` 文件中的 `PKG_VERSION` 数值，同时确认文件中的 `PKG_SOURCE`（下载链接）也对应该版本（避免下载错误的源码包）。

下载包出错, 手动下载

```bash
wget https://sourceware.org/pub/bzip2/bzip2-1.0.6.tar.gz -O /home/lckfb/rope/buildroot/dl/bzip2-1.0.6.tar.gz
```

编译buildroot

```bash
```



## 编译

使用镜像

```bash
gunzip jammy-ros2-build.tar.gz
docker image load -i jammy-ros2-build.tar
docker run -it --mount type=bind,source=/home/jiao/Taishan/rope/buildroot/output/rockchip_rk3566/,target=/buildroot focal-ros2-build
```

把两个文件复制到docker里面, 分别是源码以及编译脚本

```bash
(base) jiao@jiao-virtual-machine:~/Taishan/rope/buildroot/output/rockchip_rk356x_recovery$ docker container ls
CONTAINER ID   IMAGE              COMMAND       CREATED          STATUS          PORTS     NAMES
3dc7725ce204   focal-ros2-build   "/bin/bash"   20 seconds ago   Up 19 seconds             trusting_elgamal
827a46042c12   taishan_build      "/bin/bash"   5 weeks ago      Up 19 minutes             taishan
(base) jiao@jiao-virtual-machine:~/Taishan/app/ROS$ docker container cp ros2-sources.tar.gz 3dc7725ce204:/tmp/
(base) jiao@jiao-virtual-machine:~/Taishan/app/ROS$ docker container cp ros2-build-scripts.tar.gz 3dc7725ce204:/tmp/
```

在容器里面解压缩

```bash
sudo tar zxf /tmp/ros2-build-scripts.tar.gz -C /
sudo tar zxf /tmp/ros2-sources.tar.gz -C /
```

替换脚本里面的python版本

```bash
vim /opt/ros/cross-compile/cross-compile.mixin
vim /opt/ros/foxy/build_ros2.sh
# 里面的3.10 => 3.8
# 里面的310 => 38
```

```bash
ls /opt/ros
cross-compile  foxy  galactic  humble  iron
cd /opt/ros/iron
./prepare-source.sh
./build-ros2.sh
# 编译成功后，应有类似提示:
...
Summary: 317 packages finished [15min 37s]
...
build ros quit & cleanup
```



编译的时候出现错误

在buildroot配置添加`BR2_PACKAGE_TINYXML2=y`

