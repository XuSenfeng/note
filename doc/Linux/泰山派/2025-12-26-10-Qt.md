# Qt

## 手动编译

下载到/opt文件夹里面

```bash
wget https://download.qt.io/archive/qt/5.12/5.12.10/single/qt-everywhere-src-5.12.10.tar.xz
```

```bash
sudo vim ./qtbase/mkspecs/linux-aarch64-gnu-g++/qmake.conf
```

这个文件是配置交叉编译的, 改为

```
#
# qmake configuration for building with aarch64-linux-gnu-g++
#

MAKEFILE_GENERATOR      = UNIX
CONFIG                 += incremental
QMAKE_INCREMENTAL_STYLE = sublib

QT_QPA_DEFAULT_PLATFORM = linuxfb
QMAKE_CFLAGS_RELEASE += -O2 -march=armv8-a -lts
QMAKE_CXXFLAGS_RELEASE += -O2 -march=armv8-a -lts

include(../common/linux.conf)
include(../common/gcc-base-unix.conf)
include(../common/g++-unix.conf)

# modifications to g++.conf
QMAKE_CC                = aarch64-linux-gnu-gcc
QMAKE_CXX               = aarch64-linux-gnu-g++
QMAKE_LINK              = aarch64-linux-gnu-g++
QMAKE_LINK_SHLIB        = aarch64-linux-gnu-g++

# modifications to linux.conf
QMAKE_AR                = aarch64-linux-gnu-ar cqs
QMAKE_OBJCOPY           = aarch64-linux-gnu-objcopy
QMAKE_NM                = aarch64-linux-gnu-nm -P
QMAKE_STRIP             = aarch64-linux-gnu-strip
load(qt_config)
```

> - **QT_QPA_DEFAULT_PLATFORM = linuxfb**：
>
>     这一行设置了 Qt Quick/QML 应用程序的默认平台插件。`linuxfb` 是 Linux Framebuffer 的缩写，它是一种在嵌入式系统上直接控制显示设备的方法。设置为 `linuxfb` 表明 Qt 应用程序将使用 Linux Framebuffer 作为默认的图形平台，这适用于一些嵌入式系统。
>
> - **QMAKE_CFLAGS_RELEASE += -O2 -march=armv8-a -lts**：
>
>     这一行设置了在 Release 模式下编译 C 代码时的编译标志。 `-O2` 表示启用优化级别 2，这会使编译器对代码进行更多的优化，以提高执行效率。 `-march=armv8-a` 表示生成适用于 ARMv8-A 架构的代码。ARMv8-A 是支持 64 位指令集的 ARM 架构的一种实现，常见于现代的 ARM 处理器。
>
> - **QMAKE_CXXFLAGS_RELEASE += -O2 -march=armv8-a -lts**：
>
>     这一行设置了在 Release 模式下编译 C++ 代码时的编译标志，与上一行类似。它也会将相同的优化级别和目标架构应用于 C++ 代码。

创建一个编译脚本

```bash
#!/bin/sh
mkdir install
./configure \
-prefix /home/jiao/Taishan/app/qt/install \
-confirm-license \
-opensource \
-release \
-make libs \
-xplatform linux-aarch64-gnu-g++ \
-pch \
-qt-libjpeg \
-qt-libpng \
-qt-zlib \
-no-opengl \
-no-sse2 \
-no-openssl \
-no-cups \
-no-glib \
-no-dbus \
-no-separate-debug-info \


sudo make -j12
sudo make install
```

> - `-prefix /opt/qt5.12.10-arm`：指定 Qt 的安装路径为 `/opt/qt5.12.10-arm`。这意味着编译完成后 Qt 库和工具将安装到这个目录下。
> - `-confirm-license`：确认接受 Qt 的许可协议。
> - `-opensource`：使用开源许可证编译 Qt。
> - `-release`：编译 Qt 为发布版本，而非调试版本。
> - `-make libs`：只编译 Qt 库，而不编译示例程序等。
> - `-xplatform linux-aarch64-gnu-g++`：指定目标平台为 Linux，并使用 `aarch64` 架构进行编译。`gnu-g++` 表示使用 GNU 工具链进行编译。
> - `-pch`：启用预编译头文件功能，以加快编译速度。
> - `-qt-libjpeg`、`-qt-libpng`、`-qt-zlib`：指定 Qt 在编译时使用系统中已安装的 libjpeg、libpng 和 zlib 库。
> - `-no-opengl`：不编译 Qt 的 OpenGL 模块。
> - `-no-sse2`：禁用 SSE2 指令集优化。
> - `-no-openssl`：不编译 Qt 的 OpenSSL 模块。
> - `-no-cups`：不编译 Qt 的 CUPS 模块（用于打印支持）。
> - `-no-glib`：不编译 Qt 的 GLib 模块。
> - `-no-dbus`：不编译 Qt 的 D-Bus 模块。
> - `-no-separate-debug-info`：不生成单独的调试信息文件。

这些产物是**专门针对 ARM64（aarch64）架构 Linux 嵌入式设备的 Qt 5.12.10 核心开发 / 运行文件**（不是可直接用的 Qt Creator 编辑器，也不是示例程序）

之后可以使用`/home/jiao/Taishan/app/qt/install/bin/qmake`进行编译

### 手动移植库

可以吧install这个文件里面的文件转移到开发板的/opt目录下

```bash
sudo vi /etc/profile

export QTEDIR=/opt/qt5.12.10-arm/
export LD_LIBRARY_PATH=/opt/qt5.12.10-arm/lib:$LD_LIBRARY_PATH
export QT_QPA_PLATFORM_PLUGIN_PATH=$QTEDIR/plugins
export QT_QPA_PLATFORM=linuxfb
export QT_QPA_FONTDIR=/usr/share/fonts/truetype/ubuntu
```

### buildroot添加

- **1. 基础版本（必选）**：`Toolchain gcc version` → 选择 ≥5.0 的版本（如`gcc 8.x`/`gcc 9.x`，避免选 4.x）；
- **2. C++ 支持（必选）**：勾选 `C++ support`（Qt5 是 C++ 库，无此选项直接屏蔽）；
- **3. wchar 支持（必选）**：勾选 `WCHAR support`（老版本 Buildroot 可能显示为`Enable WCHAR support`）；
- **4. NPTL 线程支持（必选）**：找到 `thread support` → 选择 `NPTL`（不要选`linuxthreads`，Qt5 不兼容）；

- Qt5：选择编译 Qt5 库。
    - gui module：选择编译 Qt5 的 GUI 模块。
        - widgets module：选择编译 Qt5 的 Widgets 模块。
    - fontconfig support：Fontconfig 是一个用于配置和自定义字体的库，它提供了一种统一的方式来管理系统上安装的字体。启用这个选项可以让 Qt5 库在运行时使用 Fontconfig 来管理字体，这样可以更好地支持字体的配置和渲染。
    - GIF support：启用对 GIF 图像格式的支持。
    - JPEG support：启用对 JPEG 图像格式的支持。
    - PNG support：启用对 PNG 图像格式的支持。
    - syslog support：启用系统日志支持。
    - Enable Tslib support：启用对 Tslib 的支持，Tslib 是一个用于触摸屏设备的抽象库。
    - qt5serialport：选择编译 Qt5 的串口通信模块。
    - qt5virtualkeyboard：选择编译 Qt5 的虚拟键盘模块。
        - (en_GB) language layouts：选择英国英语作为默认语言布局。

bash

BR2_TOOLCHAIN_BUILDROOT_WCHAR=y
BR2_TOOLCHAIN_BUILDROOT_CXX=y
BR2_PACKAGE_QT5=y
BR2_PACKAGE_QT5BASE_WIDGETS=y
BR2_PACKAGE_QT5BASE_FONTCONFIG=y
BR2_PACKAGE_QT5BASE_GIF=y
BR2_PACKAGE_QT5BASE_JPEG=y
BR2_PACKAGE_QT5BASE_PNG=y
BR2_PACKAGE_QT5BASE_SYSLOG=y
BR2_PACKAGE_QT5BASE_TSLIB=y
BR2_PACKAGE_QT5SERIALPORT=y
BR2_PACKAGE_QT5VIRTUALKEYBOARD=y
BR2_PACKAGE_LIBDRM=y

可以使用的qmake在/buildroot/output/rockchip_rk3566/build/qt5base-5.15.2/bin/qmake

## windows

[【保姆级图文教程】最新Windows系统QT下载、安装、入门、配置VS Qt环境，图文详细、内容充实-CSDN博客](https://blog.csdn.net/qq_62888264/article/details/132645054)

[Download Qt OSS: Get Qt Online Installer](https://www.qt.io/development/download-qt-installer-oss)

下载安装器

下载以后使用下面的命令设置镜像启动

```bash
.\qt-online-installer-windows-x64-4.8.0.exe --mirror https://mirrors.ustc.edu.cn/qtproject/  
```

一直下一步

## 编译代码

创建一个qt项目, 使用qmake编译

```bash
~/Taishan/app/qt/install/bin/qmake  ./untitled.pro
make
```

在开发板运行, 需要基于weston 

```bash
export QT_QPA_PLATFORM=wayland-egl && export QT_WAYLAND_DISPLAY=wayland-0 && ./untitled
```

