# EchoAI编译代码

## 下载

在下载的时候需要个vmware关了!!!

## 编译程序

修改Cmake文件添加ARM平台的库文件

```c
if(TARGET_ARM)
    if(NOT DEFINED CMAKE_TOOLCHAIN_FILE)
        set(CMAKE_TOOLCHAIN_FILE "${CMAKE_CURRENT_SOURCE_DIR}/toolchain.cmake" CACHE FILEPATH "Default toolchain file for ARM builds")
        message(STATUS "No toolchain file specified; using default: ${CMAKE_TOOLCHAIN_FILE}")
    endif()
    message(STATUS "Building for ARM using toolchain file: ${CMAKE_TOOLCHAIN_FILE}")

    # 设置自定义库路径
    set(ARM_LIBS_PATH "/opt/rv1106-libs" CACHE PATH "Path to ARM libraries")
    set(ARM_BOOST_PATH "/opt/arm-boost" CACHE PATH "Path to ARM Boost libraries")
    
    # 设置库查找路径
    set(CMAKE_PREFIX_PATH "${ARM_LIBS_PATH};${ARM_BOOST_PATH};${CMAKE_PREFIX_PATH}")
    set(CMAKE_MODULE_PATH "${ARM_LIBS_PATH}/cmake;${CMAKE_MODULE_PATH}")
    
    # 设置 pkg-config 路径
    set(ENV{PKG_CONFIG_PATH} "${ARM_LIBS_PATH}/lib/pkgconfig:$ENV{PKG_CONFIG_PATH}")
    set(ENV{PKG_CONFIG_LIBDIR} "${ARM_LIBS_PATH}/lib/pkgconfig")

else()
    message(STATUS "Building for x86 native architecture.")
endif()
    
    
...
    
# 修改 SDL2 查找部分
if(TARGET_ARM)
    # 对于 ARM 交叉编译，手动设置 SDL2 路径
    set(SDL2_DIR "${ARM_LIBS_PATH}/cmake/SDL2")
    set(SDL2_INCLUDE_DIR "${ARM_LIBS_PATH}/include")
    set(SDL2_LIBRARY "${ARM_LIBS_PATH}/lib/libSDL2.so")
    
    # 手动设置 SDL2_image 路径
    set(SDL2_IMAGE_INCLUDE_DIR "${ARM_LIBS_PATH}/include")
    set(SDL2_IMAGE_LIBRARY "${ARM_LIBS_PATH}/lib/libSDL2_image.so")
    
    # 设置库变量
    set(SDL2_INCLUDE_DIRS ${SDL2_INCLUDE_DIR})
    set(SDL2_LIBRARIES ${SDL2_LIBRARY})
    set(SDL2_IMAGE_INCLUDE_DIRS ${SDL2_IMAGE_INCLUDE_DIR})
    set(SDL2_IMAGE_LIBRARIES ${SDL2_IMAGE_LIBRARY})
    
    message(STATUS "SDL2 include dir: ${SDL2_INCLUDE_DIR}")
    message(STATUS "SDL2 library: ${SDL2_LIBRARY}")
else()
    # 原生编译使用 find_package
    find_package(SDL2 REQUIRED)
    find_package(SDL2_image REQUIRED)
endif()
```

编译SDL2使之可以在ARM平台使用

```bash
cd /tmp
wget https://www.libsdl.org/release/SDL2-2.26.5.tar.gz
tar -xzf SDL2-2.26.5.tar.gz
cd /tmp/SDL2-2.26.5

# 方法一：使用环境变量（推荐）
export CC="/home/jiao/rv/echo-mate/Echo-Mate/SDK/rv1106-sdk/tools/linux/toolchain/arm-rockchip830-linux-uclibcgnueabihf/bin/arm-rockchip830-linux-uclibcgnueabihf-gcc"
export CXX="/home/jiao/rv/echo-mate/Echo-Mate/SDK/rv1106-sdk/tools/linux/toolchain/arm-rockchip830-linux-uclibcgnueabihf/bin/arm-rockchip830-linux-uclibcgnueabihf-g++"
export AR="/home/jiao/rv/echo-mate/Echo-Mate/SDK/rv1106-sdk/tools/linux/toolchain/arm-rockchip830-linux-uclibcgnueabihf/bin/arm-rockchip830-linux-uclibcgnueabihf-ar"
export LD="/home/jiao/rv/echo-mate/Echo-Mate/SDK/rv1106-sdk/tools/linux/toolchain/arm-rockchip830-linux-uclibcgnueabihf/bin/arm-rockchip830-linux-uclibcgnueabihf-ld"

# 创建构建目录
mkdir build-arm && cd build-arm

# 配置（注意：--host 只需要前缀，不是完整路径）
../configure \
    --host=arm-rockchip830-linux-uclibcgnueabihf \
    --prefix=/opt/arm-libs \
    --disable-video-x11 \
    --disable-video-wayland \
    --enable-video-kmsdrm \
    --enable-video-opengles \
    --disable-alsa \
    --disable-pulseaudio

# 编译和安装
make -j$(nproc)
sudo make install
```

需要自己编译一个SDL2_image在ram平台里面使用

```c
wget https://www.libsdl.org/projects/SDL_image/release/SDL2_image-2.6.3.tar.gz
tar -xzf SDL2_image-2.6.3.tar.gz
cd SDL2_image-2.6.3

# 2. 设置环境变量
export PATH="/home/jiao/rv/echo-mate/Echo-Mate/SDK/rv1106-sdk/tools/linux/toolchain/arm-rockchip830-linux-uclibcgnueabihf/bin:$PATH"
export CC=arm-rockchip830-linux-uclibcgnueabihf-gcc
export CXX=arm-rockchip830-linux-uclibcgnueabihf-g++
export SDL2_CONFIG=/opt/rv1106-libs/bin/sdl2-config

# 3. 配置
./configure \
    --host=arm-rockchip830-linux-uclibcgnueabihf \
    --prefix=/opt/rv1106-libs \
    --with-sdl-prefix=/opt/rv1106-libs \
    --enable-static=no \
    --enable-shared=yes \
    --disable-jpg \
    --disable-png \
    --disable-tif \
    --disable-webp \
    --disable-imageio

# 4. 编译并安装
make -j$(nproc)
sudo make install

# 5. 验证安装
ls -la /opt/rv1106-libs/lib/libSDL2_image*
file /opt/rv1106-libs/lib/libSDL2_image.so
```

实际使用的库在

```bash
ls /opt/rv1106-libs/lib/
```

