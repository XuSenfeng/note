# 图形化配置界面

## Makefile文件

```makefile
%config: scripts_basic outputmakefile FORCE
	$(Q)$(MAKE) $(build)=scripts/kconfig $@
```

> 实际匹配的命令和加载config命令的是同一个

```makefile
@ make -f ./scripts/Makefile.build obj=scripts/kconfig menuconfig
```

实际是使用这个命令进行处理的

```c
menuconfig: $(obj)/mconf  
	$< $(silent) $(Kconfig)
```

实际运行的命令如下

```makefile
menuconfig: scripts/kconfig/mconf 
	scripts/kconfig/mconf Kconfig
```

目标menuconfig 依赖 scripts/kconfig/mconf，因此 scripts/kconfig/mconf.c 这个文件会被编 译，生成mconf这个可执行文件

默认使用的是根文件下面的Kconfig文件

## Kconfig语法

+ `mainmenu`主菜单, 默认打开的界面, `mainmenu "U-Boot $UBOOTVERSION Configuration" `
+ 调用其他目录下的Kconfig, `source "xxx/Kconfig"  //xxx为具体的目录名，相对路径`
+ `menu/endmenu`: 生成以及结束一个菜单
+ `config`条目: 具体配置项

```c
config CC_OPTIMIZE_FOR_SIZE
	bool "Optimize for size"
	default y
	help
	  Enabling this option will pass "-Os" instead of "-O2" to gcc
	  resulting in a smaller U-Boot image.

	  This option is enabled by default for U-Boot.
```

**类型**: bool、tristate、string、hex 和 int，一共 5 种。最常用的是bool、tristate 和 string 这三种，b ool 类型有两种值：y和n，当为y的时候表示使能这个配置项，当为n的时候就禁止这个配置 项。tristate 类型有三种值：y、m和n，其中y和n的涵义与bool类型一样，m表示将这个配置 项编译为模块。string 为字符串类型，所以 LOCALVERSION 是个字符串变量，用来存储本地字符串

**依赖**: 可以使用`depend on`选一下依赖的文件, 也可以使用`select`选择在这个配置以后自动选择的项

+ `choice/endchoice `

```
choice
	prompt "Architecture select"
	default SANDBOX

config ARC
	bool "ARC architecture"
	select HAVE_PRIVATE_LIBGCC
	select HAVE_GENERIC_BOARD
	select SYS_GENERIC_BOARD
	select SUPPORT_OF_CONTROL

config ARM
	bool "ARM architecture"
	select CREATE_ARCH_SYMLINK
	select HAVE_PRIVATE_LIBGCC if !ARM64
	select HAVE_GENERIC_BOARD
	select SYS_GENERIC_BOARD
	select SUPPORT_OF_CONTROL
...

endchoice
```

将多个类似的配置项组合在一起，供用户单 选或者多选

+ `menuconfig`带选项的菜单

```
menuconfig EXPERT
	bool "Configure standard U-Boot features (expert users)"
	default y
	help
	  This option allows certain base U-Boot options and settings
	  to be disabled or tweaked. This is for specialized
	  environments which can tolerate a "non-standard" U-Boot.
	  Only use this if you really know what you are doing.

if EXPERT
	config SYS_MALLOC_CLEAR_ON_INIT
	bool "Init with zeros the memory reserved for malloc (slow)"
	default y
	help
	  This setting is enabled by default. The reserved malloc
	  memory is initialized with zeros, so first malloc calls
	  will return the pointer to the zeroed memory. But this
	  slows the boot time.

	  It is recommended to disable it, when CONFIG_SYS_MALLOC_LEN
	  value, has more than few MiB, e.g. when uses bzip2 or bmp logo.
	  Then the boot time can be significantly reduced.
	  Warning:
	  When disabling this, please check if malloc calls, maybe
	  should be replaced by calloc - if expects zeroed memory.
endif
endmenu		# General setup
```

选择了EXPERT以后会出现下面的配置

+ `comment`注释

