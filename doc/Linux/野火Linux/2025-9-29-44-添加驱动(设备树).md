# 添加驱动

是对于驱动的修改或者是对于设备树的修改，其中设备 树目录在arch/arm/boot/dts目录下，设备树插件目录在arch/arm/boot/dts/overlays目录下, 驱动目 录在ebf_linux_kernel/drivers每个不同的驱动占用一个子目录，如char、block、net、mtd、i2c 等

这里的驱动实际使用的是添加模块的形式进行的

## 示例

在drivers/ebf_module目录的下面添加一个hello_module

```c
#include <linux/module.h>
#include <linux/init.h>
#include <linux/kernel.h>

static int __init hello_init(void){
    printk(KERN_EMERG "Hello world init\n");
    printk("[default] Hello ModuleInit\n");
    return 0;
}

static void __exit hello_exit(void){
     printk("[ default ] Hello ModuleExit\n");
}

module_init(hello_init);
module_exit(hello_exit);

MODULE_LICENSE("GPL2");
MODULE_AUTHOR("jiao");
MODULE_DESCRIPTION("helloworldmodule");
MODULE_ALIAS("test_module");

```

这个文件夹下面的配置文件

```makefile
 obj-$(CONFIG_HELLO_MODULE) := hello_module.o
```

上一层的配置文件

```makefile
obj-y += hello_module/
```

上一层的Kconfig文件

```c
config HELLO_MODULE
	tristate "hello_module"
```

之后再编译之前进行选择

## 设备树编译

在编写完设备树后，假设取名为（mmc：imx6ull-mmc-npi.dtsnand:imx6ull-nand-npi.dts） 在./ebf_linux_kernel/arch/arm/boot/dts/Makefile 文件中添加

```
 imx6ull-mmc-npi.dtb \
 imx6ull-nand-npi.dtb \
```

`make dtbs ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf-`全部编译

`make imx6ull-mmc-npi.dtb ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf-`单独编译

把编译出的设备树imx6ull-mmc-npi.dtb/imx6ull-nand-npi.dtb 下载到板子中的/usr/lib/linux-image-4.19.35-imx6 即可