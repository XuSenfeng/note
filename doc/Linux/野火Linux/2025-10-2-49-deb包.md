# deb包

为了方便管理一些程序或脚本，可以将这些程序以及脚本都制作在一个deb包中

制作deb的方式很多，如使用dpkg-deb方式、使用checkinstall方式、使用 dh_make 方式及修改原有的deb包

它是基于tar包的，所以同样会记录着文件的权限信息（读、写、可执行）、所有 者、用户组等, `dpkg -l`来查看系统以及安装了哪些deb包

## 组成

+ 安装的内容，这部分类似linux的根目录，表示需要将软件安装到linux系统上的文件目录
+ 控制信息（放在DEBIAN目录下），通常DEBIAN目录下有如下几个文件
+ + **changelog**: 文件记录了deb包的作者、版本以及最后一次更新日期等信息
    + **control**: 文件记录了包名、版本号、架构、维护者及描述等信息
    + **copyright**: 文件记录了一些版权信息
    + **postinst**: 软件在进行正常目录文件拷贝到系统后需要执行的脚本。
    + **postrm**: 软件卸载后需要执行的脚本。

> 其中control、postinst、postrm 为必要文件

## 示例

```
hello_deb/
 ├── DEBIAN
 │ ├── control
 │ ├── postinst
 │ └── postrm
 └── opt
 └── hello_deb
 └── hello_deb.sh
```

+ control文件

```
Package: hello-deb
Version: 1.0.0
Section: free
Priority: optional
Essential: no
Architecture: armhf
Maintainer: embedfire <embedfire@embedfire.com>
Provides: hell_deb
Description: deb test
 
```

+ postinst文件

```bash
#!/bin/bash
if [ "$1" = "upgrade" ] || [ "$1" = "install" ];then
	echo "hello_deb installing"
fi
```

+ postrm文件

```bash
# !/bin/bash
if [ "$1" = "upgrade" ] ; then
	echo "upgrade"
elif [ "$1" = "remove" ] || [ "$1" = "purge" ] ; then
	echo "remove"
fi
```

+ hello_deb.sh

```bash
#! /bin/bash
echo Hello deb!
echo This is a test script!!
```

+ 打包

`sudo dpkg-deb-b ../hello_deb ../hello_deb_1.0.0_armhf.deb`创建deb包, 可以使用命令` dpkg -c hello_deb_1.0.0_armhf.deb`查看包的文件信息, 也可以使用``dpkg--info hello_deb_1.0.0_armhf.deb`查看配置信息

+ 安装

`sudo dpkg -i hello_deb_1.0.0_armhf.deb`并且在安装完软件之后可以输入`dpkg -s hello-dev`命令查看是否安装了软件

## 修改现有的包

`dpkg -X`命令对deb包进行解压

` pkg-X hello_deb_1.0.0_armhf.deb update_deb/`

进入update_deb 目录下可看到并没DEBIAN相关目录，在update_deb目录下使用dpkg-e解压出 控制相关信息`dpkg-e ../hello_deb_1.0.0_armhf.deb`