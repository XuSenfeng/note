---
layout: post
title: "虚拟环境" 
date:   2024-4-23 15:39:08 +0800
tags: python基础
---

# 虚拟环境

建立一个虚拟环境

```bash
python -m venv 环境名
```

> 会在这一个路径下面创建一个虚拟环境

之后可以在这一个路径下面的执行Script/activate启动这一个环境

## 使用anaconda

```python
conda create -n 名字 python=3.12
```

## 包管理问题

在使用pip进行安装的时候, 如果一个包依赖有其他的包, 在不使用这个包删除的时候不会删除他自己带进来的那个包, 为了解决这个问题, python引入pyproject.toml 配置文件进行管理

这个新的配置文件引入一个推荐的文件架构, 假设我们软件包的名字是 npts ，那么整个项目的目录结构在推荐的风格下看起来应该像这样。

````bash
tree ./ ./ 
├── LICENSE 
├── README.md 
├── pyproject.toml 
├── src 
│ └── npts # src 下面是包名，包下面是业务代码 
│      ├── __init__.py 
|      └── core.py 
└── tests 3 directories, 5 files
````

对应的配置文件如下

```python
[project] 
name = "npts"
version = "0.0.1" 

[build-system] 
requires = ["hatchling"] 
build-backend = "hatchling.build"
```

可以使用工具对整个项目进行打包

```bash
# 安装依赖
python3 -m pip install --upgrade build

# 打包
python3 -m build
# ...
#... ... Successfully built npts-0.0.1.tar.gz and npts-0.0.1-py2.py3-none-any.whl
```

## pyproject.toml文件

```toml
# pyproject.toml

# 1. 构建系统声明 (必需)
# 告诉 pip 等工具，这个项目需要用什么来构建 (这里是 setuptools)
# 是 Python 生态中最核心的包构建、分发和安装工具
[build-system]
requires = ["setuptools>=61.0"]
build-backend = "setuptools.build_meta"

# 2. 项目核心元数据 (必需)
# 这部分取代了 setup.py 中的大部分参数
[project]
name = "my-awesome-tool"
version = "0.1.0"
authors = [
  { name="你的名字", email="你的邮箱@example.com" },
]
description = "一个功能强大的现代工具"
readme = "README.md" # 指定 README 文件
requires-python = ">=3.9"
license = { text = "MIT" }
classifiers = [
    "Programming Language :: Python :: 3",
    "License :: OSI Approved :: MIT License",
    "Operating System :: OS Independent",
]

# 3. 依赖项 (核心)使用的各种包
# 这取代了 setup.py 中的 install_requires
dependencies = [
    "requests>=2.20",
    "numpy",
    "click",
]

# 4. 命令行工具 (可选)
# 这取代了 setup.py 中的 entry_points
[project.scripts]
awesome_tool = "my_awesome_tool.main:cli"

# 5. 可选依赖 (可选)
# 允许用户安装额外功能，例如 pip install "my-awesome-tool[extra]"
[project.optional-dependencies]
extra = ["pandas"]

# 6. 项目链接 (可选)
[project.urls]
Homepage = "https://github.com/your_username/my_modern_project"
"Bug Tracker" = "https://github.com/your_username/my_modern_project/issues"
```

可以使用`pip install -e .`自动识别这个文件进行安装

###  uv管理

+   创建环境, 传统

```bash
# 创建名为 .venv 的虚拟环境（默认）
uv venv

# 激活环境（macOS/Linux）
source .venv/bin/activate
```

+   创建项目

```bash
uv init my_project
uv init --name my_uv_project --version 0.1.0 --python 3.11
cd my_project
uv sync # 创建虚拟环境, 安装配置文件里面的依赖
source .venv/bin/activate
uv add <pkg> # 添加新依赖并更新 pyproject.toml
uv remove <pkg>
```

![image-20251208110801294](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/mac-picture/image-20251208110801294.png)

## 项目打包

`python -m build` 是 Python 官方推荐的**标准化包构建工具**（基于 `build` 库），核心作用是依据 `pyproject.toml`（PEP 621 标准）或传统 `setup.py`/`setup.cfg`，一键构建符合 PyPI 规范的 Python 包分发文件（`.whl` 二进制包 + `.tar.gz` 源码包），替代了老旧的 `python setup.py sdist/bdist_wheel` 方式。

需要安装build包, 可以使用`uv add build`

![image-20251208114526881](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/mac-picture/image-20251208114526881.png)

可以使用`twine check dist/*`检查build编译出来的包是不是符合规范, `uv add twine`即可下载, 符合规范的包可以上传PyPI, 这里的whl是编译好的文件, 下载比较快, tar.gz是没有编译的文件, 使用的时候需要编译但是兼容更多的操作系统
