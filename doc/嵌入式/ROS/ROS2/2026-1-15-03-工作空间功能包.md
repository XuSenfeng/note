# 工作空间功能包

## 工作空间

一个项目

+ src: 代码空间
+ install: 安装空间
+ build: 编译空间
+ log: 日志空间

### 创建空间

我们从社区中下载的各种代码，多少都会有一些依赖，我们可以手动一个一个安装，也可以使用rosdep工具自动安装

```bash
mkdir -p ros/src
cd ros/src
git clone https://gitee.com/guyuehome/ros2_21_tutorials.git
```

创建文件夹以及下载代码文件

### 安装依赖

```bash
$ sudo pip install rosdepc
$ sudo rosdepc init
$ rosdepc update
$ cd ..
# 自动查找src文件夹下面的所有文件, 安装依赖
$ rosdepc install -i --from-path src --rosdistro humble -y
```

### 编译

```bash
sudo apt install python3-colcon-ros
colcon build
# 单个功能包构建
colcon build --packages-select demo_cpp_pkg
```

### 工作区激活

```bash
source install/local_setup.sh # 仅在当前终端生效
```

## 功能包

一个机器人里面的不同功能的源码

### 创建

```bash
ros2 pkg create --build-type <build-type> <package_name> --licence Apache-2.0 --dependencies rclcpp 
```

- **build-type**：表示新创建的功能包是C++还是Python的，如果使用C++或者C，那这里就跟ament_cmake，如果使用Python，就跟ament_python；
- **package_name**：新建功能包的名字。
- **dependencies**: 依赖的功能包

```bash
ros2 pkg create --build-type ament_cmake learing_packagec
ros2 pkg create --build-type ament_python learing_packagepython
```

![image-20260115134654797](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202601151346870.png)

在Cmake文件里面配置C语言的编译, 在setup文件里面配置实际执行的脚本, xml是文件的依赖以及基础信息, 会依照这个文件进行安装zij

![image-20260118120400504](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202601181204572.png)

### xml文件

这个文件是参考, 可以添加依赖vcpb

```xml
<?xml version="1.0"?>
<?xml-model href="http://download.ros.org/schema/package_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?>
<package format="3">
  <name>learning_node</name>
  <version>0.0.0</version>
  <description>TODO: Package description</description>
  <maintainer email="hcx@todo.todo">hcx</maintainer>
  <license>TODO: License declaration</license>
  
  <depend> rclpy </depend>
  <test_depend>ament_copyright</test_depend>
  <test_depend>ament_flake8</test_depend>
  <test_depend>ament_pep257</test_depend>
  <test_depend>python3-pytest</test_depend>

  <export>
    <build_type>ament_python</build_type>
  </export>
</package>
```

可以通过标签控制功能包的依赖, 在一个包里面加上另一个包的`<depend>`可以控制自己写的包的编译顺序

#### cmake文件

```cmake
find_package(rclcpp REQUIRED)

add_executable(node_helloworld_class src/node_helloworld_class.cpp)
ament_target_dependencies(node_helloworld_class rclcpp)
# 文件拷贝, 指定需要复制的文件以及目标文件
install(TARGETS
  node_helloworld_class
  DESTINATION lib/${PROJECT_NAME})

# 这一段代码需要放在ament_package()之前执行, 因为使用了ament工具
```

![image-20260118125428536](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202601181254597.png)

复制以后得文件在install目录的这个位置
