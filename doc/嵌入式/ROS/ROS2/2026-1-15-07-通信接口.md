# 通用接口

几个模块之间的通信交流使用传输的数据, ROS有三种常用的通信机制，分别是**话题、服务、动作**，通过每一种通信种定义的接口，各种节点才能有机的联系到一起

为了保证每一个节点可以使用不同语言编程，ROS将这些接口的设计做成了和**语言无关**的，比如这里看到的int32表示32位的整型数，int64表示64位的整型数，bool表示布尔值，还可以定义数组、结构体，这些定义在编译过程中，会自动生成对应到C++、Python等语言里的数据结构

![image-20260115165105822](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202601151651897.png)

- 话题通信接口的定义使用的是.msg文件，由于是单向传输，只需要描述传输的每一帧数据是什么就行，比如在这个定义里，会传输两个32位的整型数，x、y，我们可以用来传输二维坐标的数值。
- 服务通信接口的定义使用的是.srv文件，包含请求和应答两部分定义，通过中间的“---”区分，比如之前我们学习的加法求和功能，请求数据是两个64位整型数a和b，应答是求和的结果sum。
- 动作是另外一种通信机制，用来描述机器人的一个运动过程，使用.action文件定义，比如我们让小海龟转90度，一边转一边**周期反馈**当前的状态，此时接口的定义分成了三个部分，分别是动作的目标，比如是开始运动，运动的结果，**最终旋转的90度是否完成**，还有一个周期反馈，比如每隔1s反馈一下当前转到第10度、20度还是30度了，让我们知道运动的进度。

## 常用的通信接口

### Topic的msg

```bash
jiao@jiao-virtual-machine:~/ros/dev_ws$ ls /opt/ros/humble/share/ | grep msg
actionlib_msgs
action_msgs
diagnostic_msgs
geometry_msgs
lifecycle_msgs
map_msgs
nav_msgs
pcl_msgs
pendulum_msgs
rosgraph_msgs
rqt_msg
sensor_msgs
sensor_msgs_py
shape_msgs
statistics_msgs
std_msgs
stereo_msgs
tf2_geometry_msgs
tf2_msgs
tf2_sensor_msgs
trajectory_msgs
unique_identifier_msgs
visualization_msgs
# 传感器的数据类型
jiao@jiao-virtual-machine:~/ros/dev_ws$ ls /opt/ros/humble/share/sensor_msgs/msg/
BatteryState.idl     FluidPressure.msg  JoyFeedbackArray.idl  LaserScan.msg           NavSatStatus.idl  Range.msg
BatteryState.msg     Illuminance.idl    JoyFeedbackArray.msg  MagneticField.idl       NavSatStatus.msg  RegionOfInterest.idl
CameraInfo.idl       Illuminance.msg    JoyFeedback.idl       MagneticField.msg       PointCloud2.idl   RegionOfInterest.msg
CameraInfo.msg       Image.idl          JoyFeedback.msg       MultiDOFJointState.idl  PointCloud2.msg   RelativeHumidity.idl
ChannelFloat32.idl   Image.msg          Joy.idl               MultiDOFJointState.msg  PointCloud.idl    RelativeHumidity.msg
ChannelFloat32.msg   Imu.idl            Joy.msg               MultiEchoLaserScan.idl  PointCloud.msg    Temperature.idl
CompressedImage.idl  Imu.msg            LaserEcho.idl         MultiEchoLaserScan.msg  PointField.idl    Temperature.msg
CompressedImage.msg  JointState.idl     LaserEcho.msg         NavSatFix.idl           PointField.msg    TimeReference.idl
FluidPressure.idl    JointState.msg     LaserScan.idl         NavSatFix.msg           Range.idl         TimeReference.msg
```

### Srv类型

```bash
jiao@jiao-virtual-machine:~/ros/dev_ws$ ls /opt/ros/humble/share/ | grep srv
rqt_srv
std_srvs
# 标准的服务
jiao@jiao-virtual-machine:~/ros/dev_ws$ ls /opt/ros/humble/share/std_srvs/srv/
Empty.idl          Empty_Response.msg  SetBool.idl          SetBool_Response.msg  Trigger.idl          Trigger_Response.msg
Empty_Request.msg  Empty.srv           SetBool_Request.msg  SetBool.srv           Trigger_Request.msg  Trigger.srv
```

### 查询命令

```bash
jiao@jiao-virtual-machine:~/ros/dev_ws$ ros2 interface list
jiao@jiao-virtual-machine:~/ros/dev_ws$ ros2 interface show sensor_msgs/msg/Joy
# Reports the state of a joystick's axes and buttons.

# The timestamp is the time at which data is received from the joystick.
std_msgs/Header header
        builtin_interfaces/Time stamp
                int32 sec
                uint32 nanosec
        string frame_id

# The axes measurements from a joystick.
float32[] axes

# The buttons measurements from a joystick.
int32[] buttons
# 查看一个工具包里面的具体情况
jiao@jiao-virtual-machine:~/ros/dev_ws$ ros2 interface package learning_interface 
learning_interface/msg/ObjectPosition
learning_interface/action/MoveCircle
learning_interface/srv/AddTwoInts
learning_interface/srv/GetObjectPosition
```

## 自定义

### cmake

```cmake
cmake_minimum_required(VERSION 3.5)
project(learning_interface)

# Default to C99
if(NOT CMAKE_C_STANDARD)
  set(CMAKE_C_STANDARD 99)
endif()

# Default to C++14
if(NOT CMAKE_CXX_STANDARD)
  set(CMAKE_CXX_STANDARD 14)
endif()

if(CMAKE_COMPILER_IS_GNUCXX OR CMAKE_CXX_COMPILER_ID MATCHES "Clang")
  add_compile_options(-Wall -Wextra -Wpedantic)
endif()

# find dependencies
find_package(ament_cmake REQUIRED)
# uncomment the following section in order to fill in
# further dependencies manually.
# find_package(<dependency> REQUIRED)
find_package(rosidl_default_generators REQUIRED)

# 实际的配置文件
rosidl_generate_interfaces(${PROJECT_NAME}
  "msg/ObjectPosition.msg"
  "srv/AddTwoInts.srv"
  "srv/GetObjectPosition.srv"
  "action/MoveCircle.action"
 )
 
if(BUILD_TESTING)
  find_package(ament_lint_auto REQUIRED)
  # the following line skips the linter which checks for copyrights
  # uncomment the line when a copyright and license is not present in all source files
  #set(ament_cmake_copyright_FOUND TRUE)
  # the following line skips cpplint (only works in a git repo)
  # uncomment the line when this package is not in a git repo
  #set(ament_cmake_cpplint_FOUND TRUE)
  ament_lint_auto_find_test_dependencies()
endif()

ament_package()
```

### 数据示例

#### msg

```xml
# 使用功能包里面的数据类型
builtin_interfaces/Time stamp # 时间戳

# 自带的数据类型
string host_name
float32 cpu_percent
float32 memory_percent # 内存
float32 memory_total
float32 memory_available
float64 net_sent # 网络
float32 net_recv
```

#### server

```xml
sensor_msgs/Image image
---
int16 number
float32 use_time
int32[] top
int32[] left
int32[] bottom
int32[] right
```

可以定义常量

```xml
int8 SUCESS=1
int8 FAIL=0
```

使用的时候直接引用

```cpp
Partol::Response::SUCESS
```

