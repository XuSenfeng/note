# Navigation

自主导航框架

![image-20260124151703012](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202601241517097.png)

```bash
sudo apt-get install ros-$ROS_DISTRO-navigation2
sudo apt-get install ros-$ROS_DISTRO-nav2-bringup
```

复制一份默认的配置文件`/opt/ros/humble/share/nav2_bringup/params/nav2_params.yaml`

默认只需要配置一下`robot_radius: 0.12`

为了方便使用可以launch文件引用navigation2里面的默认启动文件

```python
import os
import launch
import launch_ros
from ament_index_python.packages import get_package_share_directory
from launch.launch_description_sources import PythonLaunchDescriptionSource


def generate_launch_description():
    # 获取与拼接默认路径
    fishbot_navigation2_dir = get_package_share_directory(
        'fishbot_navigation2')
    # 找到这个库的默认的配置文件
    nav2_bringup_dir = get_package_share_directory('nav2_bringup')
    rviz_config_dir = os.path.join(
        nav2_bringup_dir, 'rviz', 'nav2_default_view.rviz')
    
    # 创建 Launch 配置
    use_sim_time = launch.substitutions.LaunchConfiguration(
        'use_sim_time', default='true') # 使用仿真时间
    map_yaml_path = launch.substitutions.LaunchConfiguration(
        'map', default=os.path.join(fishbot_navigation2_dir, 'maps', 'room.yaml')) # 地图文件路径
    nav2_param_path = launch.substitutions.LaunchConfiguration(
        'params_file', default=os.path.join(fishbot_navigation2_dir, 'config', 'nav2_params.yaml')) # 导航参数文件路径

    return launch.LaunchDescription([
        # 声明新的 Launch 参数
        launch.actions.DeclareLaunchArgument('use_sim_time', default_value=use_sim_time,
                                             description='Use simulation (Gazebo) clock if true'),
        launch.actions.DeclareLaunchArgument('map', default_value=map_yaml_path,
                                             description='Full path to map file to load'),
        launch.actions.DeclareLaunchArgument('params_file', default_value=nav2_param_path,
                                             description='Full path to param file to load'),
        # 使用navagation2的launch文件, 传递参数
        launch.actions.IncludeLaunchDescription(
            PythonLaunchDescriptionSource(
                [nav2_bringup_dir, '/launch', '/bringup_launch.py']),
            # 使用 Launch 参数替换原有参数
            launch_arguments={
                'map': map_yaml_path,
                'use_sim_time': use_sim_time,
                'params_file': nav2_param_path}.items(),
        ),
        launch_ros.actions.Node(
            package='rviz2',
            executable='rviz2',
            name='rviz2',
            arguments=['-d', rviz_config_dir],
            parameters=[{'use_sim_time': use_sim_time}],
            output='screen'),
    ])
```

```cmake
install(DIRECTORY launch maps config
  DESTINATION share/${PROJECT_NAME}
)
```

```bash
ros2 launch fishbot_navigation2 navigation2.launch.py 
```

![image-20260124153623570](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202601241536699.png)

![image-20260124153658842](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202601241536935.png)

![image-20260124153854515](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202601241538616.png)

## 优化

###优化导航的速度/膨胀半径

控制器服务器根据全局的路径输出机器人的控制命令, 所以这里需要改变的是控制器服务器的参数

位于`controller_server`节点下面的`controller_server`可以控制最小最大的速度等

这个地图里面在门的位置有一个膨胀半径, 这里面的默认膨胀是比较大的, 可以改为比较小的膨胀半径, 一般是机器人的半径`local_costmap->inflation_radius`以及`global_costmap->inflation_radius`

### 优化到点精度

之前配置的时候机器人并未完全到达目标点, 可以配置精度

`controller_server->general_goal_checker`