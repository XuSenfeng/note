# 里程计计算

通过运动学的正解, 可以计算出机器人的实时速度, 通过线速度以及角速度的积分, 可以计算出来机器人的实时位置

<img src="https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202601261949047.png" alt="image-20260126194906989" style="zoom:150%;" />

```cpp
void Kinematics::update_odom(uint16_t dt)
{
    float dt_s = float(dt)/1000.0; // ms -> s
    // 获取实时的角速度和线速度呢？我们拿左右轮实时的速度，进行运动学正解
    this->kinematics_forward(motor_param[0].motor_speed,motor_param[1].motor_speed,&odom.linear_speed,&odom.angular_speed);
    // 计算里程计信息
    odom.linear_speed = odom.linear_speed/1000.0; // 转换成米每秒

    // 角度积分
    odom.angle += odom.angular_speed*dt_s; 
    TransAngleInPI(odom.angle,odom.angle);
    // 计算机器人行走的距离（沿自身前进方向的）
    float delta_distance = odom.linear_speed * dt_s;
    // 分解到X轴和Y轴
    odom.x += delta_distance * std::cos(odom.angle);
    odom.y += delta_distance * std::sin(odom.angle);
}
```

