# 电脑信息实例

## 创建工作区

### 数据类型

```bash
ros2 pkg create status_interface --dependencies builtin_interfaces rosidl_default_generators
```

![image-20260119120229846](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202601191202047.png)

### 发布文件

```bash
ros2 pkg create status_publisher --dependencies status_interface rclpy --build-type ament_python
```

### Qt界面

```bash
 ros2 pkg create status_display --dependencies rclcpp status_interface
```

## 数据类型

### 数据文件

```bash
# 使用功能包里面的数据类型
builtin_interfaces/Time stamp # 时间戳

# 自带的数据类型
string host_name
float32 cpu_percent
float32 memory_percent # 内存
float32 memory_total
float32 memory_available
float64 net_sent # 网络
float32 net_recv
```

```cmake
# 使用find_package里面的rosidl_generators_interfaces
rosidl_generate_interfaces (
  ${PROJECT_NAME}
  "msg/SystemStatus.msg"
  DEPENDENCIES builtin_interfaces
)
```

配置文件里面添加

```xml
<member_of_group> rosidl_interface_packages </member_of_group>
```

查看添加

```bash
cat@lubancat:~/ros$ ros2 interface show  status_interface/msg/SystemStatus
# 使用功能包里面的数据类型
builtin_interfaces/Time stamp # 时间戳

# 自带的数据类型
string host_name
float32 cpu_percent
float32 memory_percent # 内存
float32 memory_total
float32 memory_available
float64 net_sent # 网络
float32 net_recv
```

### 发布类型

```python
import rclpy
from rclpy.node import Node
from status_interface.msg import SystemStatus

import psutil
import platform

class SysStatusPub(Node):
    def __init__(self, node_name):
        super().__init__(node_name)
        self.publisher_ = self.create_publisher(SystemStatus, 'sys_status', 10)
        timer_period = 1.0  # seconds
        self.timer = self.create_timer(timer_period, self.timer_callback)


    def timer_callback(self):
        """
        # 使用功能包里面的数据类型
        builtin_interfaces/Time stamp # 时间戳

        # 自带的数据类型
        string host_name
        float32 cpu_percent
        float32 memory_percent # 内存
        float32 memory_total
        float32 memory_available
        float64 net_sent # 网络
        float32 net_recv
            """
        msg = SystemStatus()
        msg.stamp = self.get_clock().now().to_msg()
        msg.host_name = platform.node()
        msg.cpu_percent = psutil.cpu_percent()
        msg.memory_percent = psutil.virtual_memory().percent
        msg.memory_total = float(psutil.virtual_memory().total) / (1024 * 1024)
        msg.memory_available = float(psutil.virtual_memory().available) / (1024 * 1024)
        net_io = psutil.net_io_counters()
        msg.net_sent = float(net_io.bytes_sent) / (1024 * 1024)
        msg.net_recv = float(net_io.bytes_recv) / (1024 * 1024)

        self.get_logger().info(f'Publishing SystemStatus: CPU {msg.cpu_percent}%, Memory {msg.memory_percent}%, Platform {msg.host_name}')
        self.publisher_.publish(msg)

def main(args=None):
    rclpy.init(args=args)

    sys_status_pub = SysStatusPub('sys_status_publisher')

    rclpy.spin(sys_status_pub)

    sys_status_pub.destroy_node()
    rclpy.shutdown()
```

### Qt

#### 基础界面

```cpp
#include <QApplication>
#include <QLabel>
#include <QString>

int main(int argc, char *argv[]) {
    QApplication app(argc, argv);

    QLabel label("Hello, HalloQt!");
    label.resize(200, 100);
    label.show();

    return app.exec();
}
```

```cmake
find_package(Qt5 REQUIRED COMPONENTS Widgets)

add_executable(hello_qt src/hello_qt.cpp)
target_link_libraries(hello_qt Qt5::Widgets)

install(
  TARGETS hello_qt
  DESTINATION lib/${PROJECT_NAME}
)
```



