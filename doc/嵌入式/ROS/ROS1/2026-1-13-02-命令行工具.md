# 命令行工具

![image-20260113112526792](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202601131125919.png)

## 小海龟

```bash
#测试
# 基础服务
roscore
# 仿真器, rosrun用于运行一个包, 一个包名, 以及里面的节点
rosrun turtlesim turtlesim_node
# 控制节点
rosrun turtlesim turtle_teleop_key
```

### 信息获取

#### 图形架构

可以通过rqt_graph获取整个系统的架构

![image-20260113112918288](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202601131129326.png)

两个节点, 中间使用一个话题进行通信

#### 命令行节点信息

也可以使用命令行工具进行查看节点的信息, 使用命令`rosnode`

```bash
(base) jiao@jiao:~$ rosnode list
/rosout # 默认启动的时候自动创建的一个
/teleop_turtle
/turtlesim
(base) jiao@jiao:~$ rosnode info /turtlesim
--------------------------------------------------------------------------------
Node [/turtlesim]
Publications: # 发布的话题
 * /rosout [rosgraph_msgs/Log]
 * /turtle1/color_sensor [turtlesim/Color]
 * /turtle1/pose [turtlesim/Pose] # 位置

Subscriptions: # 订阅的话题
 * /turtle1/cmd_vel [geometry_msgs/Twist]

Services: # 提供的服务可以用于配置
 * /clear
 * /kill
 * /reset
 * /spawn
 * /turtle1/set_pen
 * /turtle1/teleport_absolute
 * /turtle1/teleport_relative
 * /turtlesim/get_loggers
 * /turtlesim/set_logger_level


contacting node http://jiao:44890/ ...
Pid: 120888
Connections:
 * topic: /rosout
    * to: /rosout
    * direction: outbound (44774 - 127.0.0.1:48359) [15]
    * transport: TCPROS
 * topic: /turtle1/cmd_vel
    * to: /teleop_turtle (http://jiao:44828/)
    * direction: inbound (48579 - jiao:45572) [23]
    * transport: TCPROS
```

#### topic相关

使用命令`rostopic`

```bash
(base) jiao@jiao:~$ rostopic list
/rosout
/rosout_agg
/turtle1/cmd_vel # 运动控制的节点
/turtle1/color_sensor
/turtle1/pose
# 发布信息, /turtle1/cmd_vel是节点, geometry_msgs/Twist是数据类型
(base) jiao@jiao:~$ rostopic pub /turtle1/cmd_vel geometry_msgs/Twist "linear:
  x: 1.0
  y: 0.0
  z: 0.0
angular:
  x: 0.0
  y: 0.0
  z: 0.0" 
publishing and latching message. Press ctrl-C to terminate
(base) jiao@jiao:~$ rostopic pub -r 10 /turtle1/cmd_vel geometry_msgs/Twist "linear:
  x: 1.0
  y: 0.0
  z: 0.0
angular:
  x: 0.0
  y: 0.0
  z: 0.0"
```

> ```bash
> (base) jiao@jiao:~$ rostopic pub -h
> Usage: rostopic pub /topic type [args...]
> 
> Options:
>   -h, --help            show this help message and exit
>   -v                    print verbose output
>   -r RATE, --rate=RATE  publishing rate (hz).  For -f and stdin input, this
>                         defaults to 10.  Otherwise it is not set.
>   -1, --once            publish one message and exit
>   -f FILE, --file=FILE  read args from YAML file (Bagy)
>   -l, --latch           enable latching for -f, -r and piped input.  This
>                         latches the first message.
>   -s, --substitute-keywords
>                         When publishing with a rate, performs keyword ('now'
>                         or 'auto') substitution for each message
>   --use-rostime         use rostime for time stamps, else walltime is used
> ```

#### 查看数据格式

```bash
(base) jiao@jiao:~$ rosmsg show geometry_msgs/Twist
geometry_msgs/Vector3 linear
  float64 x
  float64 y
  float64 z
geometry_msgs/Vector3 angular
  float64 x
  float64 y
  float64 z
```

> 默认距离单位是m, 角度单位是弧度

#### 服务server

 ```bash
 (base) jiao@jiao:~$ rosservice list
 /clear
 /kill
 /reset
 /rosout/get_loggers
 /rosout/set_logger_level
 /spawn # 产生新的海龟
 /teleop_turtle/get_loggers
 /teleop_turtle/set_logger_level
 /turtle1/set_pen
 /turtle1/teleport_absolute
 /turtle1/teleport_relative
 /turtlesim/get_loggers
 /turtlesim/set_logger_level
 (base) jiao@jiao:~$ rosservice call /spawn "x: 2.0
 y: 0.0
 theta: 0.0
 name: 'jiao'" 
 name: "jiao" # 反馈数据
 ```

![image-20260113114910586](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202601131149639.png)

> 默认的坐标在左下角

创建的海龟自动订阅了一些topic

```bash
(base) jiao@jiao:~$ rostopic list
/jiao/cmd_vel
/jiao/color_sensor
/jiao/pose
/rosout
/rosout_agg
/turtle1/cmd_vel
/turtle1/color_sensor
/turtle1/pose
```

#### 话题复现

可以使用rosbag记录一次数据, 用于之后的复现

```bash
(base) jiao@jiao:~$ rosbag record -a -O cmd_record
[INFO] [1768276539.364019106]: Recording to 'cmd_record.bag'.
[INFO] [1768276539.365862266]: Subscribing to /rosout_agg
[INFO] [1768276539.368921951]: Subscribing to /rosout
[INFO] [1768276539.371992650]: Subscribing to /turtle1/cmd_vel
[INFO] [1768276539.375071107]: Subscribing to /turtle1/pose
[INFO] [1768276539.377982403]: Subscribing to /turtle1/color_sensor
^C(base) jiao@jiao:~$ ls
JHY  cmd_record.bag  maix  miniconda3  rknn-toolkit2-1.6.0
(base) jiao@jiao:~$ rosbag play cmd_record.bag  # 复现之前的工作, 使用有时间的复现
[INFO] [1768276676.710743428]: Opening cmd_record.bag

Waiting 0.2 seconds after advertising topics... done.

Hit space to toggle paused, or 's' to step.
 [RUNNING]  Bag Time: 1768276573.531749   Duration: 34.150425 / 49.574965  
```

显示一些自动订阅的主题

### 参数

查看以及控制ROS Master里面的的参数服务器

````bash
(base) jiao@jiao:~/JHY/ros/catkin_ws$ rosparam list
/rosdistro
/roslaunch/uris/host_jiao__46634
/rosversion
/run_id
/turtlesim/background_b
/turtlesim/background_g
/turtlesim/background_r
(base) jiao@jiao:~/JHY/ros/catkin_ws$ rosparam get /turtlesim/background_r
69
(base) jiao@jiao:~/JHY/ros/catkin_ws$ rosparam set /turtlesim/background_r 255
(base) jiao@jiao:~/JHY/ros/catkin_ws$ rosparam get /turtlesim/background_r
255
# 需要使用命令进行更新
(base) jiao@jiao:~/JHY/ros/catkin_ws$ rosservice call /clear "{}" 
[INFO] [1768362643.776969794]: Clearing turtlesim.
# 记录信息在文件里面
(base) jiao@jiao:~/JHY/ros/catkin_ws$ rosparam dump param.yaml
# 加载文件
(base) jiao@jiao:~/JHY/ros/catkin_ws$ rosparam load param.yaml
(base) jiao@jiao:~/JHY/ros/catkin_ws$ rosparam get /turtlesim/background_r
128
````

> ```bash
> rosparam is a command-line tool for getting, setting, and deleting parameters from the ROS Parameter Server.
> 
> Commands:
>         rosparam set    set parameter
>         rosparam get    get parameter
>         rosparam load   load parameters from file
>         rosparam dump   dump parameters to file
>         rosparam delete delete parameter
>         rosparam list   list parameter names
> ```

### 执行脚本

用于一次性启动很多个服务

`roslaunch turtle_tf turtle_tf_demo.launch`

可以使用launch文件进行配置启动, 实际就是一个xml文件, 一般放在launch文件夹下面

#### 基础语法

[文档](https://wiki.ros.org/roslunch/XML)

![image-20260114195132939](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202601141951003.png)

> + output: 输出的位置
> + respawn: 启动失败是不是重试
> + required: 是不是必须得
> + ns: 命名空间
> + args: 使用的参数

![image-20260114195219124](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202601141952187.png)

> 参数服务器以及launch文件里面的参数设置

![image-20260114195623904](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202601141956968.png)

![image-20260114200448269](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202601142004333.png)

