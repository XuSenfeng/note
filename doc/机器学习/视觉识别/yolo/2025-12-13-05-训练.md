# 训练

https://docs.ultralytics.com/zh/modes/train/#augmentation-settings-and-hyperparameters

## 数据准备

+   images: 存放使用的图片
+   +   train: 训练集的图片
    +   val: 验证集的图片
+   labels: 标签
+   +   train: 训练集的标签, 和训练集的图片一一对应
    +   val: 验证集的标签

![image-20251213113717556](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/mac-picture/image-20251213113717556.png)

需要放在datasets文件夹下面

![image-20251213115145922](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/mac-picture/image-20251213115145922.png)

还需要一个配置文件可以参考ultralytics/ultralytics/cfg/datasets下面的文件

```yaml
# Train/val/test sets as 1) dir: path/to/imgs, 2) file: path/to/imgs.txt, or 3) list: [path/to/imgs1, path/to/imgs2, ..]
path: bvn # dataset root dir
train: images/train # train images (relative to 'path') 训练集
val: images/val # val images (relative to 'path') 验证集
test: # test images (relative to 'path') 测试集可选

# Classes
names:
  0: man
  1: girl
  2: carbvn
```

之后即可使用命令行进行训练

```bash
yolo task=detect mode=train model=./yolov8n.pt data=./bvn.yaml epochs=30 workers=1 batch=16
```

也可以使用代码进行

```python
from ultralytics import YOLO
module = YOLO('yolov8n.pt')  # load a pretrained model (recommended for training)
module.train(data='bvn.yaml', epochs=100, imgsz=640, batch=16, , device="mps") # 使用Apple的mps进行训练
```

### 基本参数

>   默认参数记录在文件`ultralytics/ultralytics/cfg/default.yaml`里面

YOLO 模型的训练设置包括训练过程中使用的各种超参数和配置。这些设置会影响模型的性能、速度和[准确性](https://www.ultralytics.com/glossary/accuracy)。关键训练设置包括批量大小、学习率、动量和权重衰减。此外，优化器的选择、[损失函数](https://www.ultralytics.com/glossary/loss-function)和训练数据集组成会影响训练过程

| 参数              | 类型                     | 默认值   | 描述                                                         |
| :---------------- | :----------------------- | :------- | :----------------------------------------------------------- |
| `model`           | `str`                    | `None`   | 指定用于训练的模型文件。接受指向 `.pt` 预训练模型或 `.yaml` 配置文件的路径。对于定义模型结构或初始化权重至关重要。 |
| `data`            | `str`                    | `None`   | 数据集配置文件的路径（例如， `coco8.yaml`）。此文件包含数据集特定的参数，包括训练和 [验证数据的路径](https://www.ultralytics.com/glossary/validation-data)，类别名称和类别数量。 |
| `epochs`          | `int`                    | `100`    | 训练的总轮数。每个[epoch](https://www.ultralytics.com/glossary/epoch)代表对整个数据集的一次完整遍历。调整此值会影响训练时长和模型性能。 |
| `time`            | `float`                  | `None`   | 最长训练时间（以小时为单位）。如果设置此参数，它将覆盖 `epochs` 参数，允许训练在指定时长后自动停止。适用于时间受限的训练场景。 |
| `patience`        | `int`                    | `100`    | 在验证指标没有改善的情况下，等待多少个epoch后提前停止训练。通过在性能停滞时停止训练，有助于防止[过拟合](https://www.ultralytics.com/glossary/overfitting)。 |
| `batch`           | `int` 或 `float`         | `16`     | [批次大小](https://www.ultralytics.com/glossary/batch-size)，具有三种模式：设置为整数（例如， `batch=16`），自动模式，GPU 内存利用率为 60%（`batch=-1`），或具有指定利用率分数的自动模式（`batch=0.70`）。 |
| `imgsz`           | `int`                    | `640`    | 用于训练的目标图像大小。图像被调整为边长等于指定值的正方形（如果 `rect=False`），为 YOLO 模型保留宽高比，但不为 RT-DETR 保留。影响模型 [准确性](https://www.ultralytics.com/glossary/accuracy) 和计算复杂度。 |
| `save`            | `bool`                   | `True`   | 启用保存训练检查点和最终模型权重。可用于恢复训练或[模型部署](https://www.ultralytics.com/glossary/model-deployment)。 |
| `save_period`     | `int`                    | `-1`     | 保存模型检查点的频率，以 epoch 为单位指定。值为 -1 时禁用此功能。适用于在长时间训练期间保存临时模型。 |
| `cache`           | `bool`                   | `False`  | 启用在内存中缓存数据集图像（`True`/`ram`），在磁盘上缓存（`disk`），或禁用缓存（`False`）。通过减少磁盘 I/O 来提高训练速度，但会增加内存使用量。 |
| `device`          | `int` 或 `str` 或 `list` | `None`   | 指定用于训练的计算设备：单个 GPU（`device=0`），多个 GPU（`device=[0,1]`），CPU（`device=cpu`），适用于 Apple 芯片的 MPS（`device=mps`），或自动选择最空闲的 GPU（`device=-1`）或多个空闲 GPU （`device=[-1,-1]`) |
| `workers`         | `int`                    | `8`      | 用于数据加载的工作线程数（每个 `RANK` ，如果是多 GPU 训练）。影响数据预处理和输入模型的速度，在多 GPU 设置中尤其有用。 |
| `project`         | `str`                    | `None`   | 项目目录的名称，训练输出保存在此目录中。允许有组织地存储不同的实验。 |
| `name`            | `str`                    | `None`   | 训练运行的名称。用于在项目文件夹中创建一个子目录，训练日志和输出存储在该子目录中。 |
| `exist_ok`        | `bool`                   | `False`  | 如果为 True，则允许覆盖现有的 project/name 目录。适用于迭代实验，无需手动清除之前的输出。 |
| `pretrained`      | `bool` 或 `str`          | `True`   | 确定是否从预训练模型开始训练。可以是一个布尔值，也可以是加载权重的特定模型的字符串路径。增强训练效率和模型性能。 |
| `optimizer`       | `str`                    | `'auto'` | 训练优化器的选择。选项包括 `SGD`, `Adam`, `AdamW`, `NAdam`, `RAdam`, `RMSProp` 等等，或者 `auto` 用于基于模型配置自动选择。影响收敛速度和稳定性。 |
| `seed`            | `int`                    | `0`      | 设置训练的随机种子，确保在相同配置下运行结果的可重复性。     |
| `deterministic`   | `bool`                   | `True`   | 强制使用确定性算法，确保可重复性，但由于限制了非确定性算法，可能会影响性能和速度。 |
| `single_cls`      | `bool`                   | `False`  | 在多类别数据集中，将所有类别视为单个类别进行训练。适用于二元分类任务或侧重于对象是否存在而非分类时。 |
| `classes`         | `list[int]`              | `None`   | 指定要训练的类 ID 列表。可用于在训练期间过滤掉并仅关注某些类。 |
| `rect`            | `bool`                   | `False`  | 启用最小填充策略——批量中的图像被最小程度地填充以达到一个共同的大小，最长边等于 `imgsz`。可以提高效率和速度，但可能会影响模型精度。 |
| `multi_scale`     | `bool`                   | `False`  | 通过增加/减少来启用多尺度训练 `imgsz` 高达 `0.5` 在训练期间。训练模型，使其在多次迭代中更加准确 `imgsz` 在推理过程中。 |
| `cos_lr`          | `bool`                   | `False`  | 使用余弦[学习率](https://www.ultralytics.com/glossary/learning-rate)调度器，在 epochs 上按照余弦曲线调整学习率。有助于管理学习率，从而实现更好的收敛。 |
| `close_mosaic`    | `int`                    | `10`     | 在最后 N 个 epochs 中禁用 mosaic [数据增强](https://www.ultralytics.com/glossary/data-augmentation)，以在完成前稳定训练。设置为 0 可禁用此功能。 |
| `resume`          | `bool`                   | `False`  | 从上次保存的检查点恢复训练。自动加载模型权重、优化器状态和 epoch 计数，无缝继续训练。 |
| `amp`             | `bool`                   | `True`   | 启用自动[混合精度](https://www.ultralytics.com/glossary/mixed-precision)（AMP）训练，减少内存使用，并可能在对准确性影响最小的情况下加快训练速度。 |
| `fraction`        | `float`                  | `1.0`    | 指定用于训练的数据集比例。允许在完整数据集的子集上进行训练，这在实验或资源有限时非常有用。 |
| `profile`         | `bool`                   | `False`  | 在训练期间启用 ONNX 和 TensorRT 速度的分析，有助于优化模型部署。 |
| `freeze`          | `int` 或 `list`          | `None`   | 冻结模型的前 N 层或按索引指定的层，从而减少可训练参数的数量。适用于微调或[迁移学习](https://www.ultralytics.com/glossary/transfer-learning)。 |
| `lr0`             | `float`                  | `0.01`   | 初始学习率（即 `SGD=1E-2`, `Adam=1E-3`)。调整此值对于优化过程至关重要，它会影响模型权重更新的速度。 |
| `lrf`             | `float`                  | `0.01`   | 最终学习率作为初始速率的一部分 = (`lr0 * lrf`），与调度器结合使用以随时间调整学习率。 |
| `momentum`        | `float`                  | `0.937`  | 用于SGD 的动量因子，或用于[Adam 优化器](https://www.ultralytics.com/glossary/adam-optimizer)的 beta1，用于将过去的梯度纳入当前更新。 |
| `weight_decay`    | `float`                  | `0.0005` | L2 [正则化](https://www.ultralytics.com/glossary/regularization)项，惩罚大权重以防止过拟合。 |
| `warmup_epochs`   | `float`                  | `3.0`    | 学习率预热的 epochs 数，将学习率从低值逐渐增加到初始学习率，以在早期稳定训练。 |
| `warmup_momentum` | `float`                  | `0.8`    | 预热阶段的初始动量，在预热期间逐渐调整到设定的动量。         |
| `warmup_bias_lr`  | `float`                  | `0.1`    | 预热阶段偏差参数的学习率，有助于稳定初始 epochs 中的模型训练。 |
| `box`             | `float`                  | `7.5`    | [损失函数](https://www.ultralytics.com/glossary/loss-function)中框损失分量的权重，影响对准确预测[边界框](https://www.ultralytics.com/glossary/bounding-box)坐标的重视程度。 |
| `cls`             | `float`                  | `0.5`    | 分类损失在总损失函数中的权重，影响正确类别预测相对于其他成分的重要性。 |
| `dfl`             | `float`                  | `1.5`    | 分布焦点损失的权重，在某些 YOLO 版本中用于细粒度分类。       |
| `pose`            | `float`                  | `12.0`   | 在为姿势估计训练的模型中，姿势损失的权重会影响对准确预测姿势关键点的强调。 |
| `kobj`            | `float`                  | `2.0`    | 姿势估计模型中关键点对象性损失的权重，用于平衡检测置信度和姿势准确性。 |
| `nbs`             | `int`                    | `64`     | 用于损失归一化的标称批量大小。                               |
| `overlap_mask`    | `bool`                   | `True`   | 确定是否应将对象掩码合并为单个掩码以进行训练，还是为每个对象保持分离。如果发生重叠，则在合并期间，较小的掩码会覆盖在较大的掩码之上。 |
| `mask_ratio`      | `int`                    | `4`      | 分割掩码的下采样率，影响训练期间使用的掩码分辨率。           |
| `dropout`         | `float`                  | `0.0`    | 分类任务中用于正则化的 Dropout 率，通过在训练期间随机省略单元来防止过拟合。 |
| `val`             | `bool`                   | `True`   | 在训练期间启用验证，从而可以定期评估模型在单独数据集上的性能。 |
| `plots`           | `bool`                   | `False`  | 生成并保存训练和验证指标的图表，以及预测示例，从而提供对模型性能和学习进度的可视化见解。 |
| `compile`         | `bool` 或 `str`          | `False`  | 启用 PyTorch 2.x `torch.compile` 使用以下方式进行图形编译 `backend='inductor'`。接受 `True` → `"default"`, `False` → 禁用，或字符串模式，例如 `"default"`, `"reduce-overhead"`, `"max-autotune-no-cudagraphs"`。如果不支持，则会发出警告并回退到 Eager 模式。 |

### 增强参数

数据增强技术对于提高 YOLO 模型的鲁棒性和性能至关重要，它通过在[训练数据](https://www.ultralytics.com/glossary/training-data)中引入变异性，帮助模型更好地泛化到未见过的数据。下表概述了每个数据增强参数的目的和效果

| 参数                                                         | 类型    | 默认值        | 支持的任务                                     | 范围          | 描述                                                         |
| :----------------------------------------------------------- | :------ | :------------ | :--------------------------------------------- | :------------ | :----------------------------------------------------------- |
| [`translate`](https://docs.ultralytics.com/zh/guides/yolo-data-augmentation//#translation-translate) | `float` | `0.1`         | `detect`, `segment`, `pose`, `obb`             | `0.0 - 1.0`   | 将图像横向和纵向平移一小部分，帮助学习detect 部分可见的物体。 |
| [`shear`](https://docs.ultralytics.com/zh/guides/yolo-data-augmentation//#shear-shear) | `float` | `0.0`         | `detect`, `segment`, `pose`, `obb`             | `-180 - +180` | 按指定的角度错切图像，模仿从不同角度观察物体的效果。         |
| [`scale`](https://docs.ultralytics.com/zh/guides/yolo-data-augmentation//#scale-scale) | `float` | `0.5`         | `detect`, `segment`, `pose`, `obb`, `classify` | `0 - 1`       | 通过增益因子缩放图像，模拟物体与相机的不同距离。             |
| [`perspective`](https://docs.ultralytics.com/zh/guides/yolo-data-augmentation//#perspective-perspective) | `float` | `0.0`         | `detect`, `segment`, `pose`, `obb`             | `0.0 - 0.001` | 对图像应用随机透视变换，增强模型理解 3D 空间中物体的能力。   |
| [`mosaic`](https://docs.ultralytics.com/zh/guides/yolo-data-augmentation//#mosaic-mosaic) | `float` | `1.0`         | `detect`, `segment`, `pose`, `obb`             | `0.0 - 1.0`   | 将四个训练图像组合成一个，模拟不同的场景组成和物体交互。对于复杂的场景理解非常有效。 |
| [`mixup`](https://docs.ultralytics.com/zh/guides/yolo-data-augmentation//#mixup-mixup) | `float` | `0.0`         | `detect`, `segment`, `pose`, `obb`             | `0.0 - 1.0`   | 混合两个图像及其标签，创建一个合成图像。通过引入标签噪声和视觉变化，增强模型的泛化能力。 |
| [`hsv_v`](https://docs.ultralytics.com/zh/guides/yolo-data-augmentation//#brightness-adjustment-hsv_v) | `float` | `0.4`         | `detect`, `segment`, `pose`, `obb`, `classify` | `0.0 - 1.0`   | 通过一小部分修改图像的明度（亮度），帮助模型在各种光照条件下表现良好。 |
| [`hsv_s`](https://docs.ultralytics.com/zh/guides/yolo-data-augmentation//#saturation-adjustment-hsv_s) | `float` | `0.7`         | `detect`, `segment`, `pose`, `obb`, `classify` | `0.0 - 1.0`   | 通过一小部分改变图像的饱和度，从而影响颜色的强度。可用于模拟不同的环境条件。 |
| [`hsv_h`](https://docs.ultralytics.com/zh/guides/yolo-data-augmentation//#hue-adjustment-hsv_h) | `float` | `0.015`       | `detect`, `segment`, `pose`, `obb`, `classify` | `0.0 - 1.0`   | 通过色轮的一小部分调整图像的色调，从而引入颜色变化。帮助模型在不同的光照条件下进行泛化。 |
| [`flipud`](https://docs.ultralytics.com/zh/guides/yolo-data-augmentation//#flip-up-down-flipud) | `float` | `0.0`         | `detect`, `segment`, `pose`, `obb`, `classify` | `0.0 - 1.0`   | 以指定的概率将图像上下翻转，增加数据变化，而不影响物体的特征。 |
| [`fliplr`](https://docs.ultralytics.com/zh/guides/yolo-data-augmentation//#flip-left-right-fliplr) | `float` | `0.5`         | `detect`, `segment`, `pose`, `obb`, `classify` | `0.0 - 1.0`   | 以指定的概率将图像左右翻转，有助于学习对称物体并增加数据集的多样性。 |
| [`erasing`](https://docs.ultralytics.com/zh/guides/yolo-data-augmentation//#random-erasing-erasing) | `float` | `0.4`         | `classify`                                     | `0.0 - 0.9`   | 在训练期间随机擦除图像区域，以鼓励模型关注不太明显的特征。   |
| [`degrees`](https://docs.ultralytics.com/zh/guides/yolo-data-augmentation//#rotation-degrees) | `float` | `0.0`         | `detect`, `segment`, `pose`, `obb`             | `0.0 - 180`   | 在指定的角度范围内随机旋转图像，提高模型识别各种方向物体的能力。 |
| [`cutmix`](https://docs.ultralytics.com/zh/guides/yolo-data-augmentation//#cutmix-cutmix) | `float` | `0.0`         | `detect`, `segment`, `pose`, `obb`             | `0.0 - 1.0`   | 组合两张图像的部分区域，创建局部混合，同时保持清晰的区域。通过创建遮挡场景来增强模型的鲁棒性。 |
| [`copy_paste_mode`](https://docs.ultralytics.com/zh/guides/yolo-data-augmentation//#copy-paste-mode-copy_paste_mode) | `str`   | `flip`        | `segment`                                      | -             | 指定 `copy-paste` 要使用的策略。选项包括 `'flip'` 和 `'mixup'`. |
| [`copy_paste`](https://docs.ultralytics.com/zh/guides/yolo-data-augmentation//#copy-paste-copy_paste) | `float` | `0.0`         | `segment`                                      | `0.0 - 1.0`   | 跨图像复制和粘贴对象以增加对象实例。                         |
| [`bgr`](https://docs.ultralytics.com/zh/guides/yolo-data-augmentation//#bgr-channel-swap-bgr) | `float` | `0.0`         | `detect`, `segment`, `pose`, `obb`             | `0.0 - 1.0`   | 以指定的概率将图像通道从 RGB 翻转到 BGR，有助于提高对不正确通道排序的鲁棒性。 |
| [`auto_augment`](https://docs.ultralytics.com/zh/guides/yolo-data-augmentation//#auto-augment-auto_augment) | `str`   | `randaugment` | `classify`                                     | -             | 应用预定义的增强策略（`'randaugment'`, `'autoaugment'`或 `'augmix'`）通过视觉多样性来增强模型性能。 |
| [`augmentations`](https://docs.ultralytics.com/zh/guides/yolo-data-augmentation//#custom-albumentations-transforms-augmentations) | `list`  | ``            | `detect`, `segment`, `pose`, `obb`             | -             | 用于高级数据增强的自定义 Albumentations 转换Python 仅限Python API）。接受转换对象列表，以满足专门的增强需求。 |

### 自定义默认配置

使用命令`yolo copy-cfg`这个命令会复制一个配置文件到当前的工程目录里面

之后即可使用`yolo cfg=defult_copy.yaml`执行

## 输出结果

![image-20251213130551523](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/mac-picture/image-20251213130551523.png)

## 使用预测

```bash
yolo detect predict model=../ultralytics/runs/detect/train4/weights/best.pt source=./calling20221009.mp4 show=True
```



![image-20251213130907816](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/mac-picture/image-20251213130907816.png)