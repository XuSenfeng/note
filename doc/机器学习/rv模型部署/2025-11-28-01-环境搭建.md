# 环境搭建

## 开发板NPU驱动

需要使用比较新的内核驱动, npu的驱动版本需要大于0.9.6

![image-20251201100126609](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/mac-picture/image-20251201100126609.png)

## 主机环境

### rknn-toolkit2

是一个运行在x86平台上面的套件, 提供模型转换, 量化功能, 模型推理, 性能和内存评估, 量化精度分析, 模型加密

```bash
# 创建一个名为toolkit2_1.6的环境，并指定python版本，
conda create -n toolkit2_1.6 python=3.11
conda activate toolkit2_1.6

# 拉取toolkit2源码
git clone https://github.com/airockchip/rknn-toolkit2

# 配置pip源
pip3 config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple/

# pip安装指定版本的库（教程测试时toolkit2版本是1.6.0，请根据python版本选择文件安装）
cd rknn-toolkit2
pip3 install -r packages/requirements_cp311-1.6.0.txt

# 需要根据python版本和rknn_toolkit2版本选择whl文件，例如这里创建的是python3.8环境，使用带”cp38”的whl文件。
pip3 install packages/rknn_toolkit2-1.6.0+81f21f4d-cp11-cp11-linux_x86_64.whl
```

### RKLLM

```bash
git clone -b release-v1.2.1b1 https://github.com/airockchip/rknn-llm.git && cd rknn-llm
pip3 install ./rkllm-toolkit/rkllm_toolkit-1.2.1b1-cp311-cp311-linux_x86_64.whl
```

## 拓展缓冲区

```c
(rkllm) jiao@jiao:~/JHY/AI/code/script$ free -h
              total        used        free      shared  buff/cache   available
Mem:           15Gi       696Mi        14Gi       2.0Mi        86Mi        14Gi
Swap:         4.0Gi       210Mi       3.8Gi
(rkllm) jiao@jiao:~/JHY/AI/code/script$ sudo swapoff -a
[sudo] password for jiao: 
(rkllm) jiao@jiao:~/JHY/AI/code/script$ sudo rm /swapfile
(rkllm) jiao@jiao:~/JHY/AI/code/script$ sudo dd if=/dev/zero of=/swapfile bs=1G count=20
20+0 records in
20+0 records out
21474836480 bytes (21 GB, 20 GiB) copied, 15.1321 s, 1.4 GB/s
(rkllm) jiao@jiao:~/JHY/AI/code/script$ sudo chmod 600 /swapfile 
(rkllm) jiao@jiao:~/JHY/AI/code/script$ sudo mkswap /swapfile 
Setting up swapspace version 1, size = 20 GiB (21474832384 bytes)
no label, UUID=71a8f340-4366-48aa-a676-226304d53880
(rkllm) jiao@jiao:~/JHY/AI/code/script$ sudo swapon /swapfile 
(rkllm) jiao@jiao:~/JHY/AI/code/script$ free -h
              total        used        free      shared  buff/cache   available
Mem:           15Gi       926Mi       3.4Gi       3.0Mi        11Gi        14Gi
Swap:          19Gi          0B        19Gi
```



## 开发板

安装librkllmrt库, 使用版本1.1.4

还有一个libgomp

```bash
cat@lubancat:~/atk_deepseek_rkllm_demo$ cp lib/libgomp/libgomp.so /usr/lib/libgomp.so.1
cat@lubancat:~/atk_deepseek_rkllm_demo$ cp lib/librkllm_api/librkllmrt.so /usr/lib/

```

