# 查询命令

![image-20251221164705450](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/mac-picture/image-20251221164705450.png)

+   默认使用命令的时候都会把编译使用的参数以及库的版本打印出来, 使用buildconf可以查看详细的编译参数

## 数据类型

### formats

在 FFmpeg 中，**muxers（复用器，也译作 “封装器”）** 是核心组件之一，核心作用是：**将多个独立的媒体流（视频流、音频流、字幕流、元数据等）“打包 / 整合” 成一个完整的容器文件（如 MP4、FLV、MKV 等）**

![image-20251221164955430](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/mac-picture/image-20251221164955430.png)

这里的D和E指的是支持解码还是编码

### codecs

codec 专门负责**单个媒体流**的「编码（压缩）」和「解码（解压缩）」**解码（decoder）**：把容器文件（如 MP4/FLV）里的压缩流（如 H.264 视频、AAC 音频）还原成原始的未压缩数据（如 YUV 视频帧、PCM 音频采样），供 FFmpeg 处理

![image-20251221170516099](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/mac-picture/image-20251221170516099.png)

```bash
DEV.LS h264                 H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10 (encoders: libx264 libx264rgb h264_videotoolbox)
```

### devices

当前支持的设备

![image-20251221165927479](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/mac-picture/image-20251221165927479.png)

| 标注 | 含义                                                         |
| ---- | ------------------------------------------------------------ |
| D.   | Demuxing supported → 支持「解复用」= 该设备可作为**输入源**（抓取流） |
| .E   | Muxing supported → 支持「复用」= 该设备可作为**输出目标**（输出流） |

### bsfs

**bsfs** 是 `Bitstream Filters`（比特流过滤器）的缩写，是介于「编解码器（codec）」和「复用 / 解复用器（muxer/demuxer）」之间的轻量级处理组件 —— 核心作用是**对编码后的媒体比特流（如 H.264 视频流、AAC 音频流）做 “微整形” 修改**

bsfs 只处理「比特流」，不碰「原始流」—— 做的是 “格式适配、数据裁剪、信息补充” 等轻量操作，而非重新编码

不同的容器格式（如 MP4、FLV、TS）对「比特流的封装格式」有严格要求：比如同样是 H.264 视频流，MP4 要求用「AVCC 格式」存储，而 FLV/TS 要求用「AnnexB 格式」；如果直接打包，会导致播放器无法识别、画面花屏或无声音。

bsfs 就是用来解决这种「比特流格式不兼容」的问题，常见场景：

1.  **格式转换**：把 H.264 流从 MP4 兼容的 AVCC 格式转成 FLV 兼容的 AnnexB 格式（`h264_mp4toannexb` 滤镜）；
2.  **提取 / 补充元数据**：从比特流中提取编码参数（如 H.264 的 SPS/PPS 信息），或给流补充必要的头部数据；
3.  **裁剪 / 过滤**：去掉比特流中的冗余数据（如字幕流的无效帧）、提取关键信息；
4.  **格式适配**：把 AAC 流的 ADTS 头部转换成 ASC 格式（`aac_adtstoasc` 滤镜），适配 MP4 容器。

```bash
ffmpeg -i test -acodec copy -vcodec libx264 -bsf:v h264_mp4toannexb -s 1280x720 test_1280x720.flv
```

-   `-bsf` = 调用比特流过滤器；
-   `:v` = 针对视频流（`:a` 针对音频流）；
-   `h264_mp4toannexb` = 具体的过滤器名称，把 H.264 流从 MP4 格式转成 FLV 兼容的 AnnexB 格式。

### protocols

**protocols（协议）** 是 FFmpeg 与「本地 / 网络数据源」之间的**数据传输 / 访问通道**—— 简单说，它负责回答「FFmpeg 如何读取 / 写入数据」（比如从本地文件读、从网络直播流拉取、向 RTMP 服务器推流），和你之前问的 `codec`（处理数据内容）、`muxer`（打包数据）、`bsfs`（微调数据格式）、`devices`（对接硬件）是完全不同的维度

#### 本地协议

| 协议名 | 标注 | 核心用途                                    | 示例（FFmpeg 命令）                                        |                                                  |
| ------ | ---- | ------------------------------------------- | ---------------------------------------------------------- | ------------------------------------------------ |
| `file` | I/O  | 访问本地文件 / 文件夹（默认协议，可省略）   | `-i file:///Users/test.mp4`（等价于 `-i /Users/test.mp4`） |                                                  |
| `pipe` | I/O  | 与其他程序通过管道（pipe）交互（Linux/Mac） | `cat test.mp4                                              | ffmpeg -i pipe:0 -c copy output.mp4`（从管道读） |
| `fd`   | I/O  | 通过文件描述符（fd）访问文件（高级用法）    | `-i fd:3`（读取文件描述符 3 对应的数据流）                 |                                                  |

#### 网络协议

| 协议名         | 标注 | 核心用途                                       | 示例（FFmpeg 命令）                                          |
| -------------- | ---- | ---------------------------------------------- | ------------------------------------------------------------ |
| `rtmp`         | I/O  | 直播推流 / 拉流（主流直播协议，如抖音 / 快手） | 推流：`ffmpeg -i test.flv -c copy rtmp://server/live/stream` |
| `http`/`https` | I/O  | 拉取 / 推送 HTTP 流（在线视频、HLS 索引）      | 拉流：`ffmpeg -i https://example.com/test.mp4 -c copy local.mp4` |
| `hls`          | I/O  | 处理 HLS 直播 / 点播流（m3u8 格式）            | 转 HLS：`ffmpeg -i test.mp4 -c copy output.m3u8`             |
| `rtsp`         | I    | 拉取监控摄像头 / IP 相机流（安防常用）         | `ffmpeg -i rtsp://admin:123456@192.168.1.100/stream`         |
| `tcp`/`udp`    | I/O  | 基于 TCP/UDP 传输裸流（自定义网络传输）        | `ffmpeg -i udp://239.0.0.1:1234 -c copy output.mp4`          |

### filters

**filters（滤镜）** 是处理「原始未压缩音视频数据」的核心模块化工具 —— 它介于「解码器（codec）解码后」和「编码器（codec）编码前」，负责对原始视频帧（YUV 格式）、原始音频采样（PCM 格式）做**编辑、特效、格式调整**（比如缩放、加水印、调音量、画中画）

| 分类     | 标识              | 作用                          | 常用示例                 |
| -------- | ----------------- | ----------------------------- | ------------------------ |
| 视频滤镜 | `-vf`/`-filter:v` | 处理原始视频帧                | 缩放、裁剪、加水印、字幕 |
| 音频滤镜 | `-af`/`-filter:a` | 处理原始音频采样              | 调音量、重采样、淡入淡出 |
| 复杂滤镜 | `-filter_complex` | 处理多输入 / 多输出、跨流操作 | 画中画、分屏、音视频混流 |

#### 视频滤镜

| 滤镜名      | 作用               | 示例（替代 / 增强你的 `-s`）                                 |
| ----------- | ------------------ | ------------------------------------------------------------ |
| `scale`     | 分辨率缩放（核心） | 👉 保持比例缩放（避免拉伸）：`-vf scale=1280:-1`（`-1` 自动计算高度，匹配 16:9）等价于你之前的 `-s 1280x720`（但更智能） |
| `crop`      | 画面裁剪           | 裁剪成 1080x720（去掉上下黑边）：`-vf crop=1080:720:100:50`（宽：高: 起始 X: 起始 Y） |
| `overlay`   | 画中画 / 加水印    | 右下角加水印：`-vf "scale=1280:-1,overlay=W-w-10:H-h-10:watermark.png"`（W/H 是视频分辨率，w/h 是水印分辨率） |
| `fade`      | 淡入淡出           | 5 秒淡入、最后 5 秒淡出：`-vf "fade=in:0:30,fade=out:end_frame-30:30"`（30 帧 = 1 秒，按帧率算） |
| `subtitles` | 加字幕             | 加载 srt 字幕：`-vf subtitles=test.srt`                      |

#### 音频滤镜

| 滤镜名      | 作用                           | 示例                                                  |      |      |
| ----------- | ------------------------------ | ----------------------------------------------------- | ---- | ---- |
| `volume`    | 调整音量                       | 音量放大 2 倍：`-af volume=2.0`；静音：`-af volume=0` |      |      |
| `afade`     | 音频淡入淡出                   | 3 秒淡入：`-af afade=in:0:90`（90 帧 = 3 秒）         |      |      |
| `aresample` | 音频重采样                     | 转成 44100Hz 采样率：`-af aresample=44100`            |      |      |
| `pan`       | 声道映射（比如单声道转立体声） | 单声道转立体声：`-af pan=stereo                       |      |      |

### pix_fmts

**pix_fmts** 是 `pixel formats`（像素格式）的缩写，核心描述「原始视频帧中像素数据的存储方式」—— 包括颜色空间（如 YUV/RGB）、色度采样格式（如 4:2:0/4:4:4）、位深（如 8bit/10bit）等，是连接「解码器输出」「滤镜处理」「编码器输入」的关键底层属性，直接影响视频的画质、体积和兼容性

![image-20251221172447899](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/mac-picture/image-20251221172447899.png)

| 像素格式    | 含义                      | 适用场景                        |
| ----------- | ------------------------- | ------------------------------- |
| yuv420p     | 8bit YUV 4:2:0，平面存储  | 通用视频编码（MP4/FLV/AVI）     |
| yuv420p10le | 10bit YUV 4:2:0，小端存储 | HDR/4K 视频编码                 |
| yuv444p     | 8bit YUV 4:4:4，平面存储  | 影视后期 / 无损视频             |
| rgb24       | 8bit RGB，24 位（R8G8B8） | 屏幕抓取 / 图像处理             |
| nv12        | YUV 4:2:0，半平面存储     | 硬件加速编码（如 NVIDIA/Intel） |

### Layout

**layout** 核心指「音频声道布局（Audio Channel Layout）」—— 描述音频流中「声道数量」和「每个声道的物理位置」（比如左声道、右声道、环绕声道）的规则，是音频处理中定义 “声音空间分布” 的关键属性，和视频的 `pix_fmts`（像素格式）类似，属于音频的 “底层数据组织方式”

| 布局名称         | 声道数量 | 声道位置（物理含义）                                         | 常见场景                 | FFmpeg 标识  |
| ---------------- | -------- | ------------------------------------------------------------ | ------------------------ | ------------ |
| Mono（单声道）   | 1        | 单声道（无方向，居中）                                       | 语音、收音机、老视频     | `mono`/`1`   |
| Stereo（立体声） | 2        | 左（FL）+ 右（FR）                                           | 绝大多数视频、音乐、直播 | `stereo`/`2` |
| 2.1 声道         | 3        | 左（FL）+ 右（FR）+ 低音炮（LFE）                            | 桌面音响、小型影院       | `2.1`        |
| 5.1 声道         | 6        | 左（FL）+ 右（FR）+ 中置（FC）+ 左后（BL）+ 右后（BR）+ 低音炮（LFE） | 电影、游戏、家庭影院     | `5.1`/`6`    |
| 7.1 声道         | 8        | 5.1 基础 + 左环绕（SL）+ 右环绕（SR）                        | 高端影院、4K HDR 视频    | `7.1`/`8`    |

![image-20251221172932121](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/mac-picture/image-20251221172932121.png)

### sample_fmts

**sample_fmts** 是 `sample formats`（音频采样格式）的缩写，核心描述「原始音频 PCM 采样数据的存储方式」—— 包括数据类型（整数 / 浮点）、位深（8bit/16bit/32bit）、符号类型（有符号 / 无符号）、字节序（大端 / 小端），是音频处理中连接「解码器输出」「滤镜处理」「编码器输入」的底层关键属性，直接影响音频的音质、体积和设备兼容性

![image-20251221173031033](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/mac-picture/image-20251221173031033.png)

| 采样格式 | 含义（数据类型 + 位深 + 符号 + 字节序） | 核心优势                 | 适用场景                            |
| -------- | --------------------------------------- | ------------------------ | ----------------------------------- |
| u8       | 8bit 无符号整数                         | 体积最小、兼容性极强     | 低端设备、语音文件                  |
| s16le    | 16bit 有符号整数，小端字节序            | 平衡音质与体积，主流首选 | 日常编码（AAC/MP3）、视频音频、直播 |
| s32le    | 32bit 有符号整数，小端字节序            | 高精度、低失真           | 无损音频、专业录制                  |
| flt      | 32bit 单精度浮点，小端字节序            | 动态范围大、无量化失真   | 音频滤镜处理、后期混音              |
| dbl      | 64bit 双精度浮点，小端字节序            | 超高精度                 | 专业音频编辑（极少用）              |

### colors

**`colors` 是「颜色相关属性的统称」**，核心围绕「如何定义和处理视频中的颜色」，包括颜色表示格式、颜色空间（与 `pix_fmts` 强关联）、色域、Gamma 校正等，是视频滤镜（如调色、加水印）、编码适配（如跨设备播放）的关键基础 —— 简单说，`colors` 决定了视频中 “颜色如何被存储、显示和转换”

会输出支持的标准颜色

## 查询使用

```bash
ffmpeg -h type=name # type是上面的这些数据, name是实际查询的类型

ffmpeg -h muxer=flv

```

