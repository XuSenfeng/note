# toodoc

æ˜¯ä¸€ä¸ªå¯ä»¥æ ¹æ®æ–‡æ¡£ä»¥åŠjsonæ–‡ä»¶è‡ªåŠ¨ç®¡ç†æ–‡æ¡£åˆ›å»ºé™æ€ç½‘é¡µçš„å·¥å…·

```bash
pip install teedoc
cd note
teedoc install
teedoc build
teedoc serve
```

## é…ç½®æ–‡ä»¶

### åŸºç¡€é…ç½®æ–‡ä»¶

åœ¨æ ¹ç›®å½•ä¸‹é¢æœ‰ä¸€ä¸ªsite_config.jsonæ–‡ä»¶, é‡Œé¢è®°å½•ä½¿ç”¨ç›®å½•ç”Ÿæˆçš„ç½‘é¡µåœ°å€, ä»¥åŠæ’ä»¶githubåœ°å€ç­‰

éœ€è¦å…³æ³¨çš„ç›®å½•æ˜¯

```json
"route": {
    "docs": {
        "/get_started/zh/": "docs/get_started/zh",
        "/Linux/": "doc/Linux",
        "/ai/": "doc/ai",
        "/ä»£ç åˆ†æ/": "doc/ä»£ç åˆ†æ",
        "/ä½¿ç”¨è½¯ä»¶/": "doc/ä½¿ç”¨è½¯ä»¶",
        "/åŸºç¡€è½¯ä»¶å‘½ä»¤è¯­æ³•/": "doc/åŸºç¡€è½¯ä»¶å‘½ä»¤è¯­æ³•",
        "/åµŒå…¥å¼/": "doc/åµŒå…¥å¼",
        "/æ‰‹æœºå®‰å“/": "doc/æ‰‹æœºå®‰å“",
        "/æœºå™¨å­¦ä¹ /": "doc/æœºå™¨å­¦ä¹ ",
        "/ç®—æ³•åŸºç¡€/": "doc/ç®—æ³•åŸºç¡€",
        "/ç¼–ç¨‹åŸºç¡€/": "doc/ç¼–ç¨‹åŸºç¡€",
        "/ç½‘ç»œ/": "doc/ç½‘ç»œ"
    },
    "pages": {
        "/": "pages/index/zh"
    },
    "assets": {
        "/static/": "static",
        "/get_started/assets/": "docs/get_started/assets"
    },
    "blog": {
        "/blog/": "blog"
    }
}
```

è¿™ä¸ªé‡Œé¢çš„docsä¼šç”Ÿæˆæ–‡æ¡£ç•Œé¢, blogç”Ÿæˆæ—¥ç›´ç•Œé¢, æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„, åœ¨å¯¹åº”çš„å®é™…æ–‡ä»¶ç›®å½•ä¸‹é¢éœ€è¦æœ‰ç›®å½•é‡Œé¢æ–‡ä»¶çš„é…ç½®æ–‡ä»¶

æˆ‘å†™äº†ä¸€ä¸ªè‡ªåŠ¨æ ¹æ®æˆ‘çš„æ–‡æ¡£ç›®å½•å¡«å……çš„è„šæœ¬

```json
"translate": {
    "docs": {
        "/get_started/zh/": [
            {
                "url": "/get_started/en/",
                "src": "docs/get_started/en"
            }
        ]
    },
    "pages": {
        "/": [
            {
                "url": "/en/",
                "src": "pages/index/en"
            }
        ]
    }
}
```

å’Œä¸Šé¢çš„é…ç½®æ˜¯å¯¹åº”çš„, ä¸­è‹±æ–‡ä¹‹é—´å¯ä»¥è½¬æ¢çš„ç•Œé¢, å®é™…è¿™ä¸ªä½ç½®æœ‰ä¸€ä¸ªè‡ªåŠ¨ç½‘é¡µç¿»è¯‘çš„åŠŸèƒ½

### é¡µé¢ç›®å½•

#### ä½¿ç”¨çš„é…ç½®

```json
{
    "import": "config_zh",
    "name": "ç½‘ç»œ"
}
```

å¯¼å…¥config_zhçš„é…ç½®æ–‡ä»¶, è¿™é‡Œé¢ä¼šé…ç½®å„ä¸ªé¡µé¢çš„logoä»¥åŠé¡¶æ å’Œåº•æ çš„é…ç½®

```json
{
    "locale": "zh_CN",
    "navbar": {
        "title": "XvSenfeng",
        "logo": {
            "alt": "XvSenfeng logo",
            "src": "/static/image/logo.png"
        },
        "home_url": "/",
        "items": [
            {
                "url": "/get_started/zh/",
                "label": "å®‰è£…ä½¿ç”¨",
                "position": "left"
            },
            {
                "url": "/blog/",
                "label": "åšå®¢",
                "position": "left"
            },
            {
                "url": "https://github.com/XuSenfeng/note/",
                "label": "github",
                "target": "_blank",
                "position": "right"
            },
            {
                "id": "language",
                "label": "Language: ",
                "position": "right",
                "type": "language"
            },
            {
                "url": "/Linux/",
                "label": "Linux",
                "position": "left"
            },
            {
                "url": "/ai/",
                "label": "ai",
                "position": "left"
            },
            {
                "url": "/ä»£ç åˆ†æ/",
                "label": "ä»£ç åˆ†æ",
                "position": "left"
            },
            {
                "url": "/ä½¿ç”¨è½¯ä»¶/",
                "label": "ä½¿ç”¨è½¯ä»¶",
                "position": "left"
            },
            {
                "url": "/åŸºç¡€è½¯ä»¶å‘½ä»¤è¯­æ³•/",
                "label": "åŸºç¡€è½¯ä»¶å‘½ä»¤è¯­æ³•",
                "position": "left"
            },
            {
                "url": "/åµŒå…¥å¼/",
                "label": "åµŒå…¥å¼",
                "position": "left"
            },
            {
                "url": "/æ‰‹æœºå®‰å“/",
                "label": "æ‰‹æœºå®‰å“",
                "position": "left"
            },
            {
                "url": "/æœºå™¨å­¦ä¹ /",
                "label": "æœºå™¨å­¦ä¹ ",
                "position": "left"
            },
            {
                "url": "/ç®—æ³•åŸºç¡€/",
                "label": "ç®—æ³•åŸºç¡€",
                "position": "left"
            },
            {
                "url": "/ç¼–ç¨‹åŸºç¡€/",
                "label": "ç¼–ç¨‹åŸºç¡€",
                "position": "left"
            },
            {
                "url": "/ç½‘ç»œ/",
                "label": "ç½‘ç»œ",
                "position": "left"
            }
        ]
    },
    "footer": {
        "top": [
            {
                "label": "é“¾æ¥",
                "items": [
                    {
                        "label": "ç½‘ç«™ä½¿ç”¨ teedoc ç”Ÿæˆ",
                        "url": "https://teedoc.neucrack.com",
                        "target": "_blank"
                    },
                    {
                        "label": "Copyright Â© 2021 Neucrack",
                        "url": "https://neucrack.com",
                        "target": "_blank"
                    },
                    {
                        "label": "ç½‘ç«™åœ°å›¾",
                        "url": "/sitemap.xml"
                    }
                ]
            },
            {
                "label": "æºç ",
                "items": [
                    {
                        "label": "github",
                        "url": "https://github.com/XuSenfeng/note/",
                        "target": "_blank"
                    },
                    {
                        "label": "æœ¬ç½‘ç«™æºæ–‡ä»¶",
                        "url": "https://github.com/teedoc/teedoc",
                        "target": "_blank"
                    }
                ]
            }
        ],
        "bottom": [
            {
                "label": "æ¸ICPå¤‡19015320å·",
                "url": "https://beian.miit.gov.cn",
                "target": "_blank"
            },
            {
                "label": "ç²¤å…¬ç½‘å®‰å¤‡44030602004109å·",
                "url": "http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44030602004109",
                "target": "_blank"
            }
        ]
    },
    "plugins": {
        "teedoc-plugin-ad-hint": {
            "config": {
                "label": "â˜†",
                "content": "è¿™æ˜¯ä¸€ä¸ªæ”¯æŒå›½é™…åŒ–çš„æ¶ˆæ¯ç¤ºä¾‹</br>å–œæ¬¢é¡¹ç›®è¯·<a target=\"_blank\" href=\"https://github.com/teedoc/teedoc\">ç‚¹ä¸‹ â˜† star </a>å“¦~ğŸ¦€ğŸ¦€"
            }
        }
    },
    "show_source": "ç¼–è¾‘æœ¬é¡µ"
}
```

#### ä¾§è¾¹æ é…ç½®

ä¾æ®ç›®å½•é…ç½®æ˜¾ç¤ºçš„ä¾§è¾¹æ 

```json
{
    "items": [
        {
            "label": "README",
            "file": "README.md"
        },
        {
            "label": "åè®®",
            "items": [
                {
                    "label": "2025-3-13-websocket",
                    "file": "åè®®\\2025-3-13-websocket.md"
                }
            ]
        },
        {
            "label": "çˆ¬è™«",
            "items": [
                {
                    "label": "2022-10-2-ç¯å¢ƒæ­å»º",
                    "file": "çˆ¬è™«\\2022-10-2-ç¯å¢ƒæ­å»º.md"
                },
                {
                    "label": "2022-9-20-pythonç›¸å…³çŸ¥è¯†",
                    "file": "çˆ¬è™«\\2022-9-20-pythonç›¸å…³çŸ¥è¯†.md"
                }
            ]
        }
    ]
}
```

## è„šæœ¬

ä¼šä¾æ®docä¸‹é¢çš„ç›®å½•æ›´æ–°ä¸Šé¢çš„é…ç½®æ–‡ä»¶, ä¸ºæ¯ä¸€ä¸ªç¬¬ä¸€å±‚çš„ç›®å½•åˆ›å»ºä¸€ä¸ªREADEMEæ–‡ä»¶ä»¥åŠä¸¤ä¸ªé…ç½®æ–‡ä»¶, åŒæ—¶è·Ÿæ–°æ ¹ç›®å½•ä¸‹é¢çš„é…ç½®æ–‡ä»¶ä»¥åŠé¡µé¢çš„é…ç½®æ–‡ä»¶

```python
import os
import json

# é€’å½’ç”Ÿæˆç›®å½•ç»“æ„
def make_item_for_dir(folder, root):
    items = []
    # å…ˆæ”¶é›†æœ¬ç›®å½•ä¸‹çš„ .md æ–‡ä»¶
    for name in sorted(os.listdir(folder)):
        full = os.path.join(folder, name)
        if os.path.isfile(full) and name.lower().endswith(".md"):
            items.append({
                "label": os.path.splitext(name)[0],
                "file": os.path.relpath(full, root)  # ä» root å¼€å§‹çš„ç›¸å¯¹è·¯å¾„
            })
    # å†æ”¶é›†å­ç›®å½•ï¼Œé€’å½’ç”Ÿæˆ
    for name in sorted(os.listdir(folder)):
        full = os.path.join(folder, name)
        if os.path.isdir(full):
            sub = make_item_for_dir(full, root)
            if sub:  # ä»…åœ¨å­ç›®å½•å†…æœ‰å†…å®¹æ—¶åŠ å…¥
                items.append({
                    "label": name,
                    "items": sub
                })
    return items

# ç¡®ä¿æ ¹ç›®å½•ä¸‹æœ‰ config.json å’Œ README.md
def ensure_root_files(root):
    dir_name = os.path.basename(root)
    # ç¡®ä¿ config.json å­˜åœ¨
    config_path = os.path.join(root, "config.json")
    if not os.path.exists(config_path):
        with open(config_path, "w", encoding="utf-8") as f:
            json.dump({"import": "config_zh", "name": dir_name}, f, ensure_ascii=False, indent=4)
        print(f"created: {config_path}")

    # ç¡®ä¿ README.md å­˜åœ¨ï¼ˆå†…å®¹ä¸ºå½“å‰ç›®å½•åï¼‰
    readme_path = os.path.join(root, "README.md")
    if not os.path.exists(readme_path):
        with open(readme_path, "w", encoding="utf-8") as f:
            f.write(f"# {dir_name}\n")
        print(f"created: {readme_path}")

# ç”Ÿæˆ sidebar.json
def create_new_teedoc_sub_dir(file_path=None):
    if file_path == None:
        root = os.path.dirname(__file__)
    else:
        root = file_path
    print(f"processing: {root}")
    ensure_root_files(root)
    data = {"items": make_item_for_dir(root, root)}  # ä¼ å…¥ root
    out_path = os.path.join(root, "sidebar.json")
    with open(out_path, "w", encoding="utf-8") as f:
        json.dump(data, f, ensure_ascii=False, indent=4)
    print(f"updated: {out_path}")

# ä»æ”¯æŒæ³¨é‡Šçš„ JSON æ–‡ä»¶åŠ è½½æ•°æ®
def _load_json_with_comments(path):
    # ä»…ç§»é™¤ä¸åœ¨å­—ç¬¦ä¸²ä¸­çš„ // æ³¨é‡Š
    with open(path, "r", encoding="utf-8") as f:
        cleaned_lines = []
        for raw in f:
            line = raw.rstrip("\n")
            in_string = False
            escape = False
            i = 0
            out = []
            while i < len(line):
                ch = line[i]
                if escape:
                    out.append(ch)
                    escape = False
                else:
                    if ch == "\\":
                        out.append(ch)
                        escape = True
                    elif ch == '"':
                        in_string = not in_string
                        out.append(ch)
                    elif not in_string and ch == "/" and i + 1 < len(line) and line[i+1] == "/":
                        # æ³¨é‡Šå¼€å§‹ï¼Œä¸¢å¼ƒæœ¬è¡Œåç»­
                        break
                    else:
                        out.append(ch)
                i += 1
            cleaned_lines.append("".join(out))
    return json.loads("\n".join(cleaned_lines))

def _dump_json(path, data):
    with open(path, "w", encoding="utf-8") as f:
        json.dump(data, f, ensure_ascii=False, indent=4)

# æ›´æ–° site_config.json é‡Œé¢çš„ route.docs, æ·»åŠ æ–°çš„æ–‡æ¡£ç›®å½•
def update_site_config_routes(doc_dir, site_config_path):
    if not os.path.isdir(doc_dir):
        print(f"doc dir not found: {doc_dir}")
        return
    if not os.path.isfile(site_config_path):
        print(f"site_config not found: {site_config_path}")
        return

    site_cfg = _load_json_with_comments(site_config_path)
    route = site_cfg.setdefault("route", {})
    docs = route.setdefault("docs", {})

    # æ”¶é›† doc ç›®å½•ä¸‹çš„ä¸€çº§å­ç›®å½•
    for name in sorted(os.listdir(doc_dir)):
        full = os.path.join(doc_dir, name)
        if os.path.isdir(full):
            key = f"/{name}/"
            val = f"doc/{name}"
            if docs.get(key) != val:
                docs[key] = val
                print(f"route.docs added/updated: {key} -> {val}")

    _dump_json(site_config_path, site_cfg)
    print(f"updated: {site_config_path}")

# æ›´æ–° config_zh.jsoné‡Œé¢çš„locale(navbar.items)
def update_locale_nav_items(doc_dir, config_template_dir, config_file="config_zh.json"):
    # ç›®æ ‡ï¼šæ›´æ–° config/config_zh.json çš„ navbar.items
    cfg_path = os.path.join(config_template_dir, config_file)
    if not os.path.isfile(cfg_path):
        print(f"locale config not found: {cfg_path}")
        return
    cfg = _load_json_with_comments(cfg_path)

    navbar = cfg.setdefault("navbar", {})
    items = navbar.setdefault("items", [])

    # å·²æœ‰ URL é›†åˆï¼Œé¿å…é‡å¤
    existing_urls = set()
    for it in items:
        url = it.get("url")
        if isinstance(url, str):
            existing_urls.add(url)

    # ä¸º doc ä¸‹çš„ä¸€çº§ç›®å½•æ·»åŠ èœå•é¡¹
    added = 0
    for name in sorted(os.listdir(doc_dir)):
        full = os.path.join(doc_dir, name)
        if os.path.isdir(full):
            url = f"/{name}/"
            if url not in existing_urls:
                items.append({
                    "url": url,
                    "label": name,
                    "position": "left"
                })
                added += 1
                print(f"navbar.items added: {url}")

    if added:
        _dump_json(cfg_path, cfg)
        print(f"updated: {cfg_path}")
    else:
        print("no navbar items changes")

def main():
    doc_dir = os.path.dirname(__file__) + "\\doc"
    for name in os.listdir(doc_dir):
        full = os.path.join(doc_dir, name)
        if os.path.isdir(full):
            create_new_teedoc_sub_dir(full)
    site_config_path = os.path.join(os.path.dirname(__file__), "site_config.json")
    update_site_config_routes(doc_dir, site_config_path)

    # æ–°å¢ï¼šæ›´æ–° locale(navbar.items)
    config_template_dir = os.path.join(os.path.dirname(__file__), "config")
    update_locale_nav_items(doc_dir, config_template_dir)
    update_locale_nav_items(doc_dir, config_template_dir, config_file="config_en.json")

if __name__ == "__main__":
    main()
```

