---
layout: post
title: "概览" 
date:   2024-1-16 15:39:08 +0800
tags: Cotex-M3
---

# 概览

![image-20240116162640097](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/image/202401161626141.png)

## 寄存器

拥有R0-R15, R13为SP指针(两个)

![image-20240116162740180](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/image/202401161627215.png)

+ R0-R12通用寄存器
+ R13:两个堆栈指针, 任一时刻只能使用一个, 主堆栈指针用于操作系统以及异常处理, 这个指针最低两位永远是0(4字节对齐)
+ R14: 储存返回地址(减少访问内存, 加速)
+ R15: 程序计数器

![image-20240116163214802](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/image/202401161632839.png)

![image-20240116163257738](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/image/202401161632771.png)

## 特权模式

在CM3运行主应用程序时（线程模式），既可以使用特权级，也可以使用用户级；但是异常服务例程必须在特权级下执行。

用户级的程序不能简简单单地试图改写CONTROL寄存器就回到特权级，它必须先“申诉”：执行一条系统调用指令(SVC)。这会触发SVC异常，然后由异常服务例程（通常是操作系统的一部分）接管，如果批准了进入，则异常服务例程修改CONTROL寄存器，才能在用户级的线程模式下重新进入特权级。

![image-20240116163635677](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/image/202401161636707.png)

## 优先级嵌套

在状态寄存器里面保存有当前的中断优先级, 当有优先级更高的中断来的时候会直接进行跳转

使用中断向量表进行跳转

中断调整自己的优先级不会使自己被重入

## 存储器

![image-20240116164735968](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/image/202401161647015.png)

![image-20240116165126115](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/image/202401161651218.png)

## 总线

有若干个总线接口, 用于加速

指令存储区总线(两个), 系统总线, 私有外设总线

> 代码存储区总线负责对代码存储区的访问，分别是I-Code总线和D-Code总线。前者用于取指，后者用于查表等操作
>
> 系统总线用于访问内存和外设，覆盖的区域包括SRAM，片上外设，片外RAM，片外扩展设备，以及系统级存储区的部分空间
>
> 私有外设总线负责一部分私有外设的访问，主要就是访问调试组件。它们也在系统级存储区

## 存储器保护单元MCU

对特权级访问和用户级访问分别施加不同的访问限制。当检测到犯规（violated）时，MPU就会产生一个fault异常，可以由fa ult异常的服务例程来分析该错误

## 指令集

Thumb-2指令集

32位和16位指令共存

## 中断和异常

支持16 -4-1=11种系统异常（保留了4+1个档位），外加240个外部中断输入。

虽然CM3是支持240个外中断的，但具体使用了多少个是由芯片生产商决定。CM3还有一个NMI（不可屏蔽中断）输入脚。当它被置为有效（assert）时，NMI服务例程会无条件地执行。

## 调试

在内核水平上搭载了若干种调试相关的特性。最主要的就是程序执行控制，包括停机(halting)、单步执行(stepping)、指令断点、数据观察点、寄存器和存储器访问、性能速写（profiling）以及各种跟踪机制

本身不再含有JTAG接口。取而代之的，是CPU提供称为   “调试访问接口(DAP)”的总线接口

是由一个调试端口(DP)设备完成的。DPs不属于CM3内核，但它们是在芯片的内部实现的。

目前可用的DPs包括SWJ  -DP(既支持传统的JTAG调试，也支持新的串行线调试协议)，另一个SW -DP则去掉了对JTAG的支持。另外，也可以使用ARM CoreSignt产品家族的JTAG   -DP模块。这下就有3个DPs可以选了，芯片制造商可以从中选择一个，以提供具体的调试接口（通常都是选SWJ  -DP）。





