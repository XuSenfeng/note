---
layout: post
title: "指令实现" 
date:   2024-8-5 15:39:08 +0800
tags: RISC-V
---

# 指令实现

## 实现思路

![image-20240823225502441](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/image/202408232255495.png)

+ 首先，要创建模拟器对像riscv，后续模拟器的任何组件都要添加到其中
+ 接下来，创建用于存储程序的Flash，并将二进制文件加载到Flash中
+ 其次，在执行程序前，先复位整个riscv，让整个模拟器处于初始运行状态
+ 最后，控制模拟器执行Flash中的程序

模拟器需要实现对指令的解析, ebreak是中断的断点指令, CPU遇到以后会在这里停顿

这一个指令通常的用途是用于调试, 

在这里，之所以选用ebreak指令的运行作为第一项工作，是因为该指令的执行不需要访问任务的寄存器、存储器，但是仍然需要实现程序的加载、取指、运行工作。通过实现ebreak指令，我们可以将risc-v模拟器的基本运行流程跑通。

## 设备初始化

初始化一个设备, 在里面开辟一块空间, 这一块空间会作为之后的Flash, 同时还有初始化出来的寄存器

之后把加载的程序复制到这个开辟出来的flash里面

### 实际的指令实现

读取一条指令, 之后根据这一条指令的含义, 对对应的寄存器进行操作

