# 模版

![image-20250726154405193](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202507261544286.png)

1. 在工作中为了更好的展示数据给用户，所以都会使用html+css+js实现网页排版效果，但是很多开发人员并不能做到既擅长服务端开发又擅长前端开发的，当然，即便有，那这个开发人员的工资也不会低，而且同等条件下，1个人干活是怎么也比不过2个人的。所以，怎么让服务端的数据更好的展示到客户端，这就成为问题了。

2. **模板引擎是一种可以让开发者把服务端数据填充到html网页中完成渲染效果的技术**。它实现了把前端代码和服务端代码分离的作用，让项目中的**业务逻辑代码和数据表现代码分离**，让**前端开发者和服务端开发者可以更好的完成协同开发**。

3. Django框架中内置了web开发领域非常出名的一个DjangoTemplate模板引擎（简称：DTL）。

4. DTL官方文档: https://docs.djangoproject.com/zh-hans/4.2/topics/templates/

5. 要在django框架中使用模板引擎把视图中的数据更好的展示给客户端，需要完成3个步骤：

6. 1. 在项目配置文件settings.py中**指定保存**模板文件的模板**目录**。同时添加使用的子项目

        一般模板目录都是设置在项目根目录或者主应用目录下。

7. ![image-20250726154805991](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202507261548064.png)

8. ![image-20250726155152761](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202507261551826.png)

9. 2. 在**视图中**基于django提供的渲染函数**绑定模板文件和需要展示的数据变量**

10. ![image-20250726155428518](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202507261554573.png)

11. ```python
    from django.shortcuts import render
    
    
    def index(request):
        """在index中调用模板引擎，渲染index.html页面, 实现前后端分离"""
        return render(request, 'index.html')
    ```

12. 3. 在模板目录下创建对应的模板文件，并根据模板引擎内置的**模板语法**，填写输出视图传递过来的数据。

![image-20250726155540249](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202507261555319.png)

## 模板语法

Django的DTL或jinja2模板引擎提供的语法无非4种格式不同的语法，分别是变量，注释，标签，过滤器

```python
"""变量"""
{{ 变量 }}

"""注释"""
{# 单行注释 #}
{% comment %}
    多行注释
{% endcomment %}
    
"""标签"""
{% 标签名 %}   # 单标签
{% 开始标签 %} {% 结束标签 %}  # 双标签

"""过滤器"""
# 本质就是函数[可以是python函数，也可以是开发者自定义函数]，常用语在变量或者标签
# 单个无参数过滤器，变量默认作为过滤器的第1个参数，过滤器中return的内容作为结果被输出
{{ 变量 | 过滤器 }}
# 单个有参数过滤器，参数1是变量，英文冒号后面跟着的参数按顺序依次使用英文逗号排列
{{ 变量 | 过滤器:参数2 }}
# 多个无参数过滤器，每个 | (竖杠) 左边的内容作为右边过滤器的默认第1个参数
{{ 变量 | 过滤器1 | 过滤器2 | 过滤器3 | .....  }}
# 多个有参数过滤器，每个过滤器的参数1是 竖杠作为结果。最后一个过滤器返回的结果被输出
{{ 变量 | 过滤器1:参数2  | 过滤器2:参数2  | .... }}
```

### 使用参数

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>Hello World</h1>
    <h2>{{ title }}</h2>
    <p>{{ content }}</p>
</body>
</html>
```

```python
from django.shortcuts import render


def index(request):
    """在index中调用模板引擎，渲染index.html页面, 实现前后端分离"""
    data = {
        "title": "首页",
        "content": "这是首页的内容",
    }
    return render(request, 'index.html', context=data)
```

```python
from turtle import title
from django.shortcuts import render


def index(request):
    """在index中调用模板引擎，渲染index.html页面, 实现前后端分离"""
    title = "首页"
    content = "这是首页的内容"
    return render(request, 'index.html', locals())
```

![image-20250726205449633](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202507262055030.png)

> 模版中可以使用`变量.pop`获取复合变量的第一个, 也可以使用`变量.数字`获取其中的指定位置
>
> 也可以输出python的对象和自定义的对象
>
> 方法的话不需要小括号, 直接输入到方法即可

### 判断

```python

def index4(request):
    """标签[判断和循环]"""
    name = "xiaoming"
    lve = ["游泳", "收快递","OB"]
    user_lve = "www"
    return render(request, "index4.html", locals())
```

```html
<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>
    {% if request.GET.name %}
       <p>{{ request.GET.name }}，欢迎，欢迎！</p>
    {% endif %}
 
    {% if name == "root" %}
        <p>超级用户，欢迎回家！</p>
    {% else %}
        <p>{{ name }},你好，欢迎来到xx网站！</p>
    {% endif %}
 
    {% if user_lve == lve.0 %}
        <p>那么巧，你喜欢游泳，海里也能见到你~</p>
    {% elif user_lve == lve.1 %}
        <p>那么巧，你也来收快递呀？~</p>
    {% elif user_lve == lve.2 %}
        <p>那么巧，你也在老男孩？</p>
    {% else %}
        <p>看来我们没有缘分~</p>
    {% endif %}
 
</body>
</html>
```

### 循环

```html

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    {% for name, value in book_dict.items %}
       <p>{{ name }}={{ value }}</p>
    {% endfor %}
 
    <hr>
 
    <table border="1" width="600">
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>price</th>
        </tr>
        {% for book in book_list1 %}
        <tr>
            <td>{{ book.id }}</td>
            <td>{{ book.name}} </td>
            <td>{{ book.price}}</td>
        </tr>
        {% endfor %}
    </table>
 
</body>
</html>
```

循环标签中, 模板引擎还提供的forloop对象，用于给开发者获取循环次数或者判断循环过程的.

| 属性                | 描述                                         |
| ------------------- | -------------------------------------------- |
| forloop.counter     | 显示循环的次数,从1开始                       |
| forloop.counter0    | 显示循环的次数,从0开始                       |
| forloop.revcounter0 | 倒数显示循环的次数,从0开始                   |
| forloop.revcounter  | 倒数显示循环的次数,从1开始                   |
| forloop.first       | 判断如果本次是循环的第一次,则结果为True      |
| forloop.last        | 判断如果本次是循环的最后一次,则结果为True    |
| forloop.parentloop  | 在多层嵌套循环中，指向当前循环的上级循环对象 |

### 过滤器

过滤器（filter）本质就是一个函数，这种函数允许我们直接在模板中使用（python函数无法直接在模板中基于参数调用）。使用过滤器的情况一般就是希望在模板中对数据进行格式化处理或对数据进行规范输出和调整。

> 多个参数的时候使用`:`进行分割

| 过滤器               | 用法                                     | 代码                                  |
| -------------------- | ---------------------------------------- | ------------------------------------- |
| **last**             | 获取列表/元组的最后一个成员              | {{list \| last}}                      |
| first                | 获取列表/元组的第一个成员                | {{list\|first}}，也可以使用{{list.0}} |
| **length**           | 获取数据的长度                           | {{list \| length}}                    |
| **defualt**          | 当变量没有值的情况下, 系统输出默认值,    | {{str\|default="默认值"}}             |
| **safe**             | 让系统不要对内容中的html代码进行实体转义 | {{htmlcontent\| safe}}                |
| upper                | 字母转换成大写                           | {{str \| upper}}                      |
| lower                | 字母转换成小写                           | {{str \| lower}}                      |
| title                | 每个单词首字母转换成大写                 | {{str \| title}}                      |
| **date**             | 日期时间格式转换                         | `{{ value| date:"D d M Y" }}`         |
| `cut`                | 从内容中截取掉同样字符的内容             | {{content \| cut:"hello"}}            |
| `escape`             | 把内容中的HTML特殊符号转换成实体字符     | {{content \| escape }}                |
| filesizeformat       | 把文件大小的数值转换成单位表示           | {{filesize \| filesizeformat}}        |
| **join**             | 按指定字符拼接内容                       | {{list\| join:"-"}}                   |
| `random`             | 随机提取某个成员                         | {list \| random}}                     |
| `slice`              | 按切片提取成员                           | {{list \| slice:":-2"}}               |
| **truncatechars**    | 按字符长度截取内容                       | {{content \| truncatechars:30}}       |
| `truncatechars_html` | 按字符长度截取内容，保留HTML标签的完整性 | 同上                                  |
| `truncatewords`      | 按单词长度截取内容                       | 同上                                  |
| `truncatewords_html` | 按单词长度截取内容，保留HTML标签的完整性 | 同上                                  |

#### safe避免转义/默认值避免空值

```python
def index6(request):
    """过滤器"""
    title = "我的标题"
    content = '我的个人主页：<a href="http://www.baidu.com">点击查看</a>'
    return render(request, "index6.html", locals())
```

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    <p>{{ content }}</p>
    {# 无参数过滤器 #}
    <p>{{ content | safe }}</p>  {# safe 过滤器的作用是告诉django，当前输出内容中的HTML内容属于可信任的安全内容，不要对内容中的html代码进行实体转义#}
    {# 有参数过滤器 #}
    <p>title={{ title | default:"无标题" }}</p> {# default 过滤器的作用是当变量不存在时，使用当前默认值实现 #}
</body>
</html>
```

#### 自定义

customer filter

要声明自定义过滤器并且能在模板中正常使用,需要完成3个步骤。

1. 确保当前需要使用过滤器的子应用已经注册到了INSTALLED_APPS中。

```python
# Application definition
# django注册的子应用列表[用于数据库操作，缓存，日志，admin管理]
INSTALLED_APPS = [
    'django.contrib.admin',  # admin站点的子应用
    'django.contrib.auth',   # django内置的登录认证功能
    'django.contrib.contenttypes',  # 内容类型管理
    'django.contrib.sessions',      # session功能
    'django.contrib.messages',      # 信号、消息功能的实现
    'django.contrib.staticfiles',   # 静态文件浏览服务
 
    'tem',   # 开发者创建的子应用，这填写就是子应用的导包路径
]
```

2. 编写过滤器，过滤器必须在子应用目录下的templatetags包里面创建对应的python文件中。`tem/templatetags/my_filters.py`代码:

```python
from django import template
# 实例化一个类库
register = template.Library()
 
 
# register.filter("过滤器别名")
@register.filter("mobile")
def mobile_filter(content, flag="****"):
    # 务必有返回值，否则模板中没有内容显示
    return content[:3] + flag + content[-3:]
 
 
@register.filter("sex")
def sex(content): # 过滤器必须有一个以上的参数，提供给模板调用
    if bool(content):
        return "男"
    return "女"
```

3. 在HTML模板中通过load标签加载当前子应用已经声明的过滤器函数，load标签的使用最好写在HTML模板文件的第一行。

视图代码：

```python
def index7(request):
    """自定义过滤器"""
    content1 = "13312345678"
    return render(request, "index7.html", locals())
```

```python
{% load my_filters %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    <p>{{ content1 | mobile }}</p>
    <p>{{ 1 | sex }}</p>
</body>
</html>
```

## 模板复用

### 模板分离

多个页面有相同的部分的时候不需要多次写

![image-20250727230424611](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202507272304703.png)

django中提供了`{% include "模板文件名" %}`标签模板分离技术。

视图，`tem/views.py`，代码：

公共模板，`templates/common/footer.html`，代码：

```
<div>footer.html公共脚部</div>
```

公共模板，`templates/common/slide.html`，代码：

```
<div>slide.html的侧栏内容</div>
```

视图对应的模板，`templates/12.html`，代码：

```html
{% include "common/head.html" %}
    <div>
        <div>index12.html的主体内容</div>
        {% include "common/slide.html" %}
    </div>
    {% include "common/footer.html" %}
</body>
</html>
```

### 模板继承

![image-20250728102045007](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202507281020107.png)

显示子模板的时候,继承父模板的公共内容

> `{% extends "base.html" %}`

```html
父模板, templates/common/base.html

<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    {% block style %}
    {% endblock style %}
</head>
<body>
    {% block header %}
    <div>公共头部</div>
    {% endblock header %}
    <div>
        {% block content %}
        <div>公共base.html->主体代码</div>
        {% endblock content %}
        <div>侧栏效果</div>
    </div>
    <div>公共脚部</div>
</body>
</html>
```

子模板代码:

```html
{% extends "common/base.html" %}
{% block style %}
    <style>
 body{
        background-color: rosybrown;
    }
    </style>
{% endblock style %}
{% block content %}
    <div>index15的主体代码</div>
{% endblock %}

{% block header %}
    <div>15的公共头部</div>
{% endblock header %}
```

> 会把这部分代码覆盖到父模版里面
