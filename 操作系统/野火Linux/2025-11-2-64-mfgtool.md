# mfgtool烧录

![d4fdb59021efd8dac5a4285e8530f34d_720](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/mac-picture/d4fdb59021efd8dac5a4285e8530f34d_720.png)

需要关心的文件夹是Profiles文件夹里面的文件, 这个文件夹里面记录的文件是实际下载使用的文件

MfgTool2.exe 就是烧写软件，但是我们不会直接打开这个软件烧写, 而是使用下面的脚本进行使用

> 这个工具的原理是首先向DDR里面烧录一个系统, 之后使用这个系统进行进一步的下载烧录

mfgtool/Profiles/Linux/OS Firmware目录里面有两个子目录, 分别对应之前说的两个步骤, files是我们自己使用的系统, firmware文件夹里面是烧录使用的系统

```bash
wfjmSet wshShell = CreateObject("WScript.shell")
wshShell.run "mfgtool2.exe -c ""linux"" -l ""eMMC"" -s ""ddr=512"" -s ""board=emmc"" -s ""boot=""  "
Set wshShell = Nothing
```

这个vbs文件里面主要运行的是这个命令

### ucl2.xml

这个文件适用于配置实际下载到板子里面的文件

ucl2.xml以`<UCL>`开始，以`</UCL>`结束。`<CFG>`和`</CFG>`之间是配置相关内容，主要是判断当前是给I.MX系列的哪个芯片烧写系统。`<LIST>`和`</LIST>`之间的是针对不同存储芯片的烧写命令

```xml
  <CFG>
	  <STATE name="BootStrap" dev="MX6UL" vid="15A2" pid="007D"/>
    <STATE name="BootStrap" dev="MX6ULL" vid="15A2" pid="0080"/>
    <STATE name="Updater"   dev="MSC" vid="066F" pid="37FF"/>
  </CFG>
```

> 不同芯片的芯片ID记录一下

```xml
<LIST name="SDCard" desc="Choose SD Card as media">
	<CMD state="BootStrap" type="boot" body="BootStrap" file ="firmware/u-boot-imx6ull-14x14-sd.imx" ifdev="MX6ULL">Loading U-boot</CMD>
		
	<CMD state="BootStrap" type="load" file="firmware/zImage" address="0x80800000"
		loadSection="OTH" setSection="OTH" HasFlashHeader="FALSE" ifdev="MX6ULL">Loading Kernel.</CMD>

	<CMD state="BootStrap" type="load" file="firmware/fsl-image-mfgtool-initramfs-imx_mfgtools.cpio.gz.u-boot" address="0x83800000"
		loadSection="OTH" setSection="OTH" HasFlashHeader="FALSE" ifdev="MX6ULL">Loading Initramfs.</CMD>

	<CMD state="BootStrap" type="load" file="firmware/imx6ull-14x14-sd.dtb" address="0x83000000"
		loadSection="OTH" setSection="OTH" HasFlashHeader="FALSE" ifdev="MX6ULL">Loading device tree.</CMD>


	<CMD state="BootStrap" type="jump" > Jumping to OS image. </CMD>


	<!-- create partition -->
	<CMD state="Updater" type="push" body="send" file="mksdcard.sh.tar">Sending partition shell</CMD>
	<CMD state="Updater" type="push" body="$ tar -xf $FILE "> Partitioning...</CMD>
	<CMD state="Updater" type="push" body="$ sh mksdcard.sh /dev/mmcblk0"> Partitioning...</CMD>

	<!-- burn uboot -->
	<CMD state="Updater" type="push" body="$ dd if=/dev/zero of=/dev/mmcblk0 bs=1k seek=768 conv=fsync count=8">clear u-boot env</CMD>
	<CMD state="Updater" type="push" body="send" file="files/boot/u-boot-imx6ull-14x14-ddr%ddr%-%board%%boot%.imx" ifdev="MX6ULL">Sending u-boot.bin</CMD>
	<CMD state="Updater" type="push" body="$ dd if=$FILE of=/dev/mmcblk0 bs=1k seek=1 conv=fsync">write u-boot.bin to sd card</CMD>

	<!-- format and mount boot partition 制作一下SD卡分区 -->
	<CMD state="Updater" type="push" body="$ while [ ! -e /dev/mmcblk0p1 ]; do sleep 1; echo \"waiting...\"; done ">Waiting for the partition ready</CMD>
	<CMD state="Updater" type="push" body="$ mkfs.vfat -F 32 -n \"boot\" /dev/mmcblk0p1">Formatting rootfs partition</CMD>
	<CMD state="Updater" type="push" body="$ mkdir -p /mnt/mmcblk0p1"/>
	<CMD state="Updater" type="push" body="$ mount -t vfat /dev/mmcblk0p1 /mnt/mmcblk0p1"/>

	<!-- burn logo -->
	<!--<CMD state="Updater" type="push" body="send" file="files/alientek.bmp">Sending logo</CMD>
	<CMD state="Updater" type="push" body="$ cp $FILE /mnt/mmcblk0p1/alientek.bmp">write boot logo to sd card</CMD> >

	<!-- burn zImage -->
	<CMD state="Updater" type="push" body="send" file="files/boot/zImage">Sending kernel</CMD>
	<CMD state="Updater" type="push" body="$ cp $FILE /mnt/mmcblk0p1/zImage">write kernel image to sd card</CMD>

	<!-- burn dtb 烧写一下设备树文件 -->
	<CMD state="Updater" type="push" body="send" file="files/boot/imx6ull-14x14-%board%-4.3-480x272-c.dtb" ifdev="MX6ULL">Sending Device Tree file</CMD>
	<CMD state="Updater" type="push" body="$ cp $FILE /mnt/mmcblk0p1/imx6ull-14x14-%board%-4.3-480x272-c.dtb" ifdev="MX6ULL">write device tree to sd card</CMD>
	
	<CMD state="Updater" type="push" body="send" file="files/boot/imx6ull-14x14-%board%-4.3-800x480-c.dtb" ifdev="MX6ULL">Sending Device Tree file</CMD>
	<CMD state="Updater" type="push" body="$ cp $FILE /mnt/mmcblk0p1/imx6ull-14x14-%board%-4.3-800x480-c.dtb" ifdev="MX6ULL">write device tree to sd card</CMD>

	<CMD state="Updater" type="push" body="send" file="files/boot/imx6ull-14x14-%board%-7-800x480-c.dtb" ifdev="MX6ULL">Sending Device Tree file</CMD>
	<CMD state="Updater" type="push" body="$ cp $FILE /mnt/mmcblk0p1/imx6ull-14x14-%board%-7-800x480-c.dtb" ifdev="MX6ULL">write device tree to sd card</CMD>

	<CMD state="Updater" type="push" body="send" file="files/boot/imx6ull-14x14-%board%-7-1024x600-c.dtb" ifdev="MX6ULL">Sending Device Tree file</CMD>
	<CMD state="Updater" type="push" body="$ cp $FILE /mnt/mmcblk0p1/imx6ull-14x14-%board%-7-1024x600-c.dtb" ifdev="MX6ULL">write device tree to sd card</CMD>

	<CMD state="Updater" type="push" body="send" file="files/boot/imx6ull-14x14-%board%-10.1-1280x800-c.dtb" ifdev="MX6ULL">Sending Device Tree file</CMD>
	<CMD state="Updater" type="push" body="$ cp $FILE /mnt/mmcblk0p1/imx6ull-14x14-%board%-10.1-1280x800-c.dtb" ifdev="MX6ULL">write device tree to sd card</CMD>
	
	<CMD state="Updater" type="push" body="send" file="files/boot/imx6ull-14x14-%board%-hdmi.dtb" ifdev="MX6ULL">Sending Device Tree file</CMD>
	<CMD state="Updater" type="push" body="$ cp $FILE /mnt/mmcblk0p1/imx6ull-14x14-%board%-hdmi.dtb" ifdev="MX6ULL">write device tree to sd card</CMD>
	
	<CMD state="Updater" type="push" body="send" file="files/boot/imx6ull-14x14-%board%-vga.dtb" ifdev="MX6ULL">Sending Device Tree file</CMD>
	<CMD state="Updater" type="push" body="$ cp $FILE /mnt/mmcblk0p1/imx6ull-14x14-%board%-vga.dtb" ifdev="MX6ULL">write device tree to sd card</CMD>
	<CMD state="Updater" type="push" body="$ sleep 1">delay</CMD>
	<CMD state="Updater" type="push" body="$ sync">Sync...</CMD>
	<CMD state="Updater" type="push" body="$ umount /mnt/mmcblk0p1">Unmounting vfat partition</CMD>

	<!-- format and mount rootfs partition 挂载第二个分区 -->
	<CMD state="Updater" type="push" body="$ mkfs.ext3 -F -j -L \"rootfs\" /dev/mmcblk0p2">Formatting rootfs partition</CMD>
	<CMD state="Updater" type="push" body="$ mkdir -p /mnt/mmcblk0p2"/>
	<CMD state="Updater" type="push" body="$ mount -t ext3 /dev/mmcblk0p2 /mnt/mmcblk0p2"/>

	<!-- burn rootfs -->
	<CMD state="Updater" type="push" body="pipe tar -jxv -C /mnt/mmcblk0p2" file="files/filesystem/rootfs.tar.bz2" ifdev="MX6ULL">Sending and writting rootfs</CMD>
	<CMD state="Updater" type="push" body="frf">Finishing rootfs write</CMD>
	<CMD state="Updater" type="push" body="$ mkdir -p /mnt/mmcblk0p2/lib/modules">Mkdir -p /mnt/mmcblk0p2/lib/modules</CMD>
	<CMD state="Updater" type="push" body="send" file="files/modules/modules.tar.bz2" ifdev="MX6ULL">Sending Modules file</CMD>
	<CMD state="Updater" type="push" body="$ tar jxf $FILE -C /mnt/mmcblk0p2/lib/modules/" ifdev="MX6ULL">tar Modules file</CMD>
	<CMD state="Updater" type="push" body="$ sleep 1">delay</CMD>
	<CMD state="Updater" type="push" body="$ sync">Sync...</CMD>
	<CMD state="Updater" type="push" body="$ umount /mnt/mmcblk0p2">Unmounting rootfs partition</CMD>
	<CMD state="Updater" type="push" body="$ echo Update Complete!">Done</CMD>
</LIST>
```

> 向SD卡里面烧录Linux系统, 可以在这里配置实际烧录的文件以及烧录执行的, 烧录使用的镜像会使用Initramfs这个文件
>
> 
>
> 
>
> Initramfs是Linux启动过程中的一个临时根文件系统，主要用于在内核完全启动并挂载真正的根文件系统之前，提供必要的设备驱动和启动环境



