# 总结

1. 驱动设备模型（总线-设备-驱动）

- **角色**：设备管理的底层框架，通过**总线**（Bus）管理**设备**（Device）和**驱动**（Driver）。
- **工作流程**：
    - 设备注册时，总线将其加入设备链表。
    - 驱动注册时，总线将其加入驱动链表。
    - 总线通过 `match()` 函数匹配设备与驱动，匹配成功则调用驱动的 `probe()` 初始化设备710。
- **典型代表**：
    - 物理总线（如 I2C、USB）。
    - 虚拟总线（如 `platform_bus`，用于管理片内外设）110。

2. **xbus（自定义总线）**

- **角色**：驱动设备模型的扩展，用于实现自定义总线（如专有硬件接口）。

- **作用**：

    - 通过 `bus_register()` 注册新总线类型（如 `xbus`），在 `/sys/bus` 下生成目录。
    - 管理自定义设备的匹配规则（如通过名称匹配）49。

- **代码示例**：

    ```c
    struct bus_type xbus = {
        .name = "xbus",
        .match = xbus_match,  // 自定义匹配函数
    };
    bus_register(&xbus);      // 注册总线
    ```

3. **class（设备类）**

- **角色**：高层功能抽象，按设备功能（而非硬件连接）分类管理设备（如所有输入设备归为 `input` 类）。
- **作用**：
    - 在 `/sys/class` 下创建统一视图（如 `/sys/class/leds` 管理所有LED）。
    - 支持 `udev` 自动创建设备节点（如 `/dev/led1`）68。

| 维度         | 驱动设备模型                             | xbus               | class                               |
| :----------- | :--------------------------------------- | :----------------- | :---------------------------------- |
| 核心目标     | 硬件-驱动匹配与资源管理                  | 扩展自定义总线规则 | 设备功能抽象与用户接口              |
| SysFS位置    | `/sys/bus`、`/sys/devices`               | `/sys/bus/xbus`    | `/sys/class`                        |
| 用户空间影响 | 间接（需驱动支持）                       | 间接               | 直接（生成 `/dev` 节点）            |
| 典型API      | `device_register()`, `driver_register()` | `bus_register()`   | `class_create()`, `device_create()` |

### 实际使用

通过kset建立的bus里面的一种为=>platform建立一个device和一个driver进行匹配

匹配实现以后建立cdev, 通过class实现自动注册