# BuildRoot

安装使用的软件

```
sudo apt-get install zlib1g-dev unzip gcc g++ aptitude lib32stdc++6-4.8-dbg make build-essential libncurses5 libncurses5-dev u-boot-tools traceroute -y
```

[Buildroot - Making Embedded Linux Easy](https://buildroot.org/)

下载一下`tar-vxf buildroot-2021.02.3.tar.gz`

`tar xvf gcc-arm-8.3-2019.03-x86_64-arm-linux-gnueabihf.tar.xz`解压一个使用的交叉编译器

使用`make menuconfig`打开配置页面

```c
Target options
    -> Target Architecture = ARM (little endian)
    -> Target Binary Format = ELF
    -> Target Architecture Variant = cortex-A7
    -> Target ABI = EABIhf
    -> Floating point strategy = NEON/VFPv4
    -> ARM instruction set = ARM
Toolchain
    -> Toolchain type = External toolchain
    -> Toolchain = Custom toolchain //选择用户的交叉编译器
    -> Toolchain origin = Pre-installed toolchain
    -> Toolchain path = $(TOPDIR)/gcc-arm-8.3-2019.03-x86_64-arm-linux-gnueabihf //这里填入交叉编译器路径，$(TOPDIR)是 buildroot 源码根目录
    -> Toolchain prefix = arm-linux-gnueabihf //交叉编译链前缀
    -> External toolchain gcc version = 8.x //交叉编译链版本
    -> External toolchain kernel headers series = 4.19.x //交叉编译链 LINUX_VERSION_CODE 版本
    -> External toolchain C library = glibc/eglibc
    -> [*] Toolchain has SSP support? (NEW) //选中
    -> [*] Toolchain has RPC support? (NEW) //选中
    -> [*] Toolchain has C++ support? //选中
    -> [*] Enable MMU support (NEW) //选中
 
System configuration
    -> (buildroot) System hostname = buildroot //主机名字
    -> (Welcome to Buildroot) System banner = Welcome to Buildroot //欢迎语
    -> Init system (BusyBox) = BusyBox //使用 busybox
Filesystem images
    -> [*] ext2/3/4 root filesystem //EMMC 或 SD 卡使用 ext3/ext4 格式
    -> ext2/3/4 variant = ext4 //选择 ext4 格式
    -> (300M)exact size //设置文件系统大小
    -> [*] ubi image containing an ubifs root filesystem //NAND 使用 ubi 格式
Kernel
    -> [ ] Linux Kernel
Bootloaders
    -> [ ] U-Boot
```

因为Buildroot编译时会拉取软件包源码存放到dl/目录下，如果访问外网困难则拉取的时间将会 十分漫长，因此可以使用编译时拉取好的

```bash
# 根据.config 生成 defconfig 精简配置
make savedefconfig
 # 保存到 configs 目录下
cp -f defconfig configs/imx6ullfire_defconfig
# 加载配置文件
make imx6ullfire_defconfig
 # 编译，使用 16 线程，根据自己的电脑性能而定
make -j16
```



```bash
# 进入源码根目录
cd buildroot-2021.02.3
 # 解压
tar xvf dl.tar.gz
 # 查看源码包
ls dl/
```

## 默认启动配置

```bash
ls /etc/init.d/
 S01syslogd S02sysctl S20urandom rcK 
 S02klogd S10mdev S40network rcS
```

+ S01syslogd：用于启动系统日志服务，负责将系统中的各种日志信息记录到指定的日志文件 中
+ S02sysctl：用于在系统启动时设置内核参数，如内存管理、进程调度等
+ S02klogd：用于处理内核日志，负责从内核获取日志消息，并将其传递给系统日志机制进 行记录或显示
+ S10mdev：用于管理和创建设备节点，负责在系统启动时根据内核检测到的设备信息，动态地创建和删除相应的设备节点
+ S20urandom：用于初始化系统的随机数生成器，为系统提供随机数源
+ S40network：用于配置和启动网络服务，包括设置网络接口的IP地址、子网掩码、网关等参数
+ **rcS**：是系统启动时，用于按顺序执行/etc/init.d目录下以S开头的初始化脚本，从而启动系 统所需的各项服务, 循环遍历/etc/init.d 目录下以**S开头且后面跟着两位字符**的所有文件和目录, 使用case语句根据脚本的文件名是否以.sh结尾来决定执行方式

> 调用脚本的时候使用的参数是start

+ rcK：是系统关闭或重启等需要停止服务的场景时，用于按逆序来停止/etc/init.d目录下以S 开头的初始化脚本

> 电泳脚本使用的参数是stop

## 定制内容

Buildroot 源码的overlay目录存放在buildroot源码/board/xxx厂商/xxx型号/overlay目录

```bash
mkdir -p buildroot-2021.02.3/board/freescale/imx6ullfire/overlay
```

之后这个目录就是文件系统的根文件

```bash
 # 加载自己的配置文件
make imx6ullfire_defconfig
 # 打开界面
make menuconfig
```

在菜单中找到Systemconfiguration-> Root filesystem overlay directories，或者在图像界面输入”/”， 打开搜索框，输入BR2_ROOTFS_OVERLAY的配置项可以快速找到对应位置

设置为覆盖使用的文件夹

```bash
$(TOPDIR)/board/freescale/imx6ullfire/overlay
```

